import{r as u,g as W,a as D,d as q,_ as L,b as v,j as r,s as O,f as B,i as V,h as A,k as U,y as He,z as Ie,D as Ee,E as Pe,o as Ue,aD as Ae,p as $,aE as We,ae as w,I as K,ag as De,N as qe,m as Q,F as ge,af as fe,S as me,M as P,aF as be,t as ve,H as F,v as he,aG as Z,aH as Le,n as X}from"./index-B7UqGdPd.js";import{G as x}from"./Grid-Bq28EWbL.js";const ke=u.createContext();function Oe(a){return W("MuiTable",a)}D("MuiTable",["root","stickyHeader"]);const Be=["className","component","padding","size","stickyHeader"],Ve=a=>{const{classes:l,stickyHeader:t}=a;return V({root:["root",t&&"stickyHeader"]},Oe,l)},Ge=O("table",{name:"MuiTable",slot:"Root",overridesResolver:(a,l)=>{const{ownerState:t}=a;return[l.root,t.stickyHeader&&l.stickyHeader]}})(({theme:a,ownerState:l})=>v({display:"table",width:"100%",borderCollapse:"collapse",borderSpacing:0,"& caption":v({},a.typography.body2,{padding:a.spacing(2),color:(a.vars||a).palette.text.secondary,textAlign:"left",captionSide:"bottom"})},l.stickyHeader&&{borderCollapse:"separate"})),xe="table",_a=u.forwardRef(function(l,t){const n=q({props:l,name:"MuiTable"}),{className:g,component:s=xe,padding:e="normal",size:c="medium",stickyHeader:m=!1}=n,h=L(n,Be),j=v({},n,{component:s,padding:e,size:c,stickyHeader:m}),p=Ve(j),G=u.useMemo(()=>({padding:e,size:c,stickyHeader:m}),[e,c,m]);return r.jsx(ke.Provider,{value:G,children:r.jsx(Ge,v({as:s,role:s===xe?null:"table",ref:t,className:B(p.root,g),ownerState:j},h))})}),ae=u.createContext();function Je(a){return W("MuiTableBody",a)}D("MuiTableBody",["root"]);const Xe=["className","component"],Ye=a=>{const{classes:l}=a;return V({root:["root"]},Je,l)},Ke=O("tbody",{name:"MuiTableBody",slot:"Root",overridesResolver:(a,l)=>l.root})({display:"table-row-group"}),Qe={variant:"body"},ye="tbody",Ca=u.forwardRef(function(l,t){const n=q({props:l,name:"MuiTableBody"}),{className:g,component:s=ye}=n,e=L(n,Xe),c=v({},n,{component:s}),m=Ye(c);return r.jsx(ae.Provider,{value:Qe,children:r.jsx(Ke,v({className:B(m.root,g),as:s,ref:t,role:s===ye?null:"rowgroup",ownerState:c},e))})});function Ze(a){return W("MuiTableCell",a)}const ea=D("MuiTableCell",["root","head","body","footer","sizeSmall","sizeMedium","paddingCheckbox","paddingNone","alignLeft","alignCenter","alignRight","alignJustify","stickyHeader"]),aa=["align","className","component","padding","scope","size","sortDirection","variant"],ra=a=>{const{classes:l,variant:t,align:n,padding:g,size:s,stickyHeader:e}=a,c={root:["root",t,e&&"stickyHeader",n!=="inherit"&&`align${A(n)}`,g!=="normal"&&`padding${A(g)}`,`size${A(s)}`]};return V(c,Ze,l)},ta=O("td",{name:"MuiTableCell",slot:"Root",overridesResolver:(a,l)=>{const{ownerState:t}=a;return[l.root,l[t.variant],l[`size${A(t.size)}`],t.padding!=="normal"&&l[`padding${A(t.padding)}`],t.align!=="inherit"&&l[`align${A(t.align)}`],t.stickyHeader&&l.stickyHeader]}})(({theme:a,ownerState:l})=>v({},a.typography.body2,{display:"table-cell",verticalAlign:"inherit",borderBottom:a.vars?`1px solid ${a.vars.palette.TableCell.border}`:`1px solid
    ${a.palette.mode==="light"?U.lighten(U.alpha(a.palette.divider,1),.88):U.darken(U.alpha(a.palette.divider,1),.68)}`,textAlign:"left",padding:16},l.variant==="head"&&{color:(a.vars||a).palette.text.primary,lineHeight:a.typography.pxToRem(24),fontWeight:a.typography.fontWeightMedium},l.variant==="body"&&{color:(a.vars||a).palette.text.primary},l.variant==="footer"&&{color:(a.vars||a).palette.text.secondary,lineHeight:a.typography.pxToRem(21),fontSize:a.typography.pxToRem(12)},l.size==="small"&&{padding:"6px 16px",[`&.${ea.paddingCheckbox}`]:{width:24,padding:"0 12px 0 16px","& > *":{padding:0}}},l.padding==="checkbox"&&{width:48,padding:"0 0 0 4px"},l.padding==="none"&&{padding:0},l.align==="left"&&{textAlign:"left"},l.align==="center"&&{textAlign:"center"},l.align==="right"&&{textAlign:"right",flexDirection:"row-reverse"},l.align==="justify"&&{textAlign:"justify"},l.stickyHeader&&{position:"sticky",top:0,zIndex:2,backgroundColor:(a.vars||a).palette.background.default})),wa=u.forwardRef(function(l,t){const n=q({props:l,name:"MuiTableCell"}),{align:g="inherit",className:s,component:e,padding:c,scope:m,size:h,sortDirection:j,variant:p}=n,G=L(n,aa),f=u.useContext(ke),H=u.useContext(ae),S=H&&H.variant==="head";let M;e?M=e:M=S?"th":"td";let T=m;M==="td"?T=void 0:!T&&S&&(T="col");const y=p||H&&H.variant,I=v({},n,{align:g,component:M,padding:c||(f&&f.padding?f.padding:"normal"),size:h||(f&&f.size?f.size:"medium"),sortDirection:j,stickyHeader:y==="head"&&f&&f.stickyHeader,variant:y}),k=ra(I);let E=null;return j&&(E=j==="asc"?"ascending":"descending"),r.jsx(ta,v({as:M,ref:t,className:B(k.root,s),"aria-sort":E,scope:T,ownerState:I},G))});function la(a){return W("MuiTableContainer",a)}D("MuiTableContainer",["root"]);const oa=["className","component"],sa=a=>{const{classes:l}=a;return V({root:["root"]},la,l)},na=O("div",{name:"MuiTableContainer",slot:"Root",overridesResolver:(a,l)=>l.root})({width:"100%",overflowX:"auto"}),ja=u.forwardRef(function(l,t){const n=q({props:l,name:"MuiTableContainer"}),{className:g,component:s="div"}=n,e=L(n,oa),c=v({},n,{component:s}),m=sa(c);return r.jsx(na,v({ref:t,as:s,className:B(m.root,g),ownerState:c},e))});function ia(a){return W("MuiTableHead",a)}D("MuiTableHead",["root"]);const da=["className","component"],ca=a=>{const{classes:l}=a;return V({root:["root"]},ia,l)},ua=O("thead",{name:"MuiTableHead",slot:"Root",overridesResolver:(a,l)=>l.root})({display:"table-header-group"}),pa={variant:"head"},_e="thead",ka=u.forwardRef(function(l,t){const n=q({props:l,name:"MuiTableHead"}),{className:g,component:s=_e}=n,e=L(n,da),c=v({},n,{component:s}),m=ca(c);return r.jsx(ae.Provider,{value:pa,children:r.jsx(ua,v({as:s,className:B(m.root,g),ref:t,role:s===_e?null:"rowgroup",ownerState:c},e))})});function ga(a){return W("MuiTableRow",a)}const Ce=D("MuiTableRow",["root","selected","hover","head","footer"]),fa=["className","component","hover","selected"],ma=a=>{const{classes:l,selected:t,hover:n,head:g,footer:s}=a;return V({root:["root",t&&"selected",n&&"hover",g&&"head",s&&"footer"]},ga,l)},ba=O("tr",{name:"MuiTableRow",slot:"Root",overridesResolver:(a,l)=>{const{ownerState:t}=a;return[l.root,t.head&&l.head,t.footer&&l.footer]}})(({theme:a})=>({color:"inherit",display:"table-row",verticalAlign:"middle",outline:0,[`&.${Ce.hover}:hover`]:{backgroundColor:(a.vars||a).palette.action.hover},[`&.${Ce.selected}`]:{backgroundColor:a.vars?`rgba(${a.vars.palette.primary.mainChannel} / ${a.vars.palette.action.selectedOpacity})`:U.alpha(a.palette.primary.main,a.palette.action.selectedOpacity),"&:hover":{backgroundColor:a.vars?`rgba(${a.vars.palette.primary.mainChannel} / calc(${a.vars.palette.action.selectedOpacity} + ${a.vars.palette.action.hoverOpacity}))`:U.alpha(a.palette.primary.main,a.palette.action.selectedOpacity+a.palette.action.hoverOpacity)}}})),we="tr",Ta=u.forwardRef(function(l,t){const n=q({props:l,name:"MuiTableRow"}),{className:g,component:s=we,hover:e=!1,selected:c=!1}=n,m=L(n,fa),h=u.useContext(ae),j=v({},n,{component:s,hover:e,selected:c,head:h&&h.variant==="head",footer:h&&h.variant==="footer"}),p=ma(j);return r.jsx(ba,v({as:s,ref:t,className:B(p.root,g),role:s===we?null:"row",ownerState:j},m))});var Y={},je;function va(){if(je)return Y;je=1;var a=He();Object.defineProperty(Y,"__esModule",{value:!0}),Y.default=void 0;var l=a(Ie()),t=Ee();return Y.default=(0,l.default)((0,t.jsx)("path",{d:"M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3z"}),"OpenInNew"),Y}var ha=va();const ee=Pe(ha),Ra=({open:a,onClose:l,suggestion:t,onSaveSuccess:n,onSaveAndApproveSuccess:g,isAdmin:s})=>{const[e,c]=u.useState({}),[m,h]=u.useState(!1),[j,p]=u.useState(null),[G,f]=u.useState(null),[H,S]=u.useState(!1),[M,T]=u.useState(!1),[y,I]=u.useState(""),[k,E]=u.useState(""),[re,oe]=u.useState(!1),[te,se]=u.useState(!1),{currentUser:ne}=Ue(),ie={package_name:{required:!0,rules:[Le.minLength(1,"Package name")]},publication_url:{required:!1,rules:[Z.isValidUrl()]},webserver_url:{required:!1,rules:[Z.isValidUrl()]},repo_url:{required:!1,rules:[Z.isValidUrl()]},link_url:{required:!1,rules:[Z.isValidUrl()]}},{errors:_,validate:Te,validateField:Re,clearErrors:de}=Ae(ie),le=$(o=>o.allAvailableTags),ce=$(o=>o.allAvailableFolders),C=$(o=>o.allAvailableCategories),[ze,z]=u.useState([]);u.useEffect(()=>{if(t){const o={package_name:t.package_name||"",description:t.description||"",publication_url:t.publication_url||"",webserver_url:t.webserver_url||"",repo_url:t.repo_url||"",link_url:t.link_url||"",license:t.license||"",tags:t.tags||[],folder1:t.folder1||"",category1:t.category1||"",suggestion_reason:t.suggestion_reason||"",admin_notes:s?t.admin_notes||"":void 0};if((!t.tags||t.tags.length===0)&&t.description){const d=t.description.toLowerCase().replace(/[^\w\s]/gi,"").split(/\s+/).filter(J=>J.length>2),b=Array.from(new Set(d)).filter(J=>le.includes(J));b.length>0&&(o.tags=b)}c(o),t.folder1&&C[t.folder1]?z(C[t.folder1]):z([])}else c({}),z([]);p(null),f(null),S(!1),T(!1),I(""),E(""),de()},[t,s,a,C,le,de]),u.useEffect(()=>{var o;e.folder1&&C[e.folder1]?z(C[e.folder1]):z([]),e.folder1&&!((o=C[e.folder1])!=null&&o.includes(e.category1||""))&&c(d=>({...d,category1:""}))},[e.folder1,C,e.category1]);const R=o=>{const{name:d,value:i}=o.target;c(b=>({...b,[d]:i})),ie[d]&&Re(d,i),d==="folder1"&&c(b=>({...b,category1:""}))},Se=(o,d)=>{c(i=>({...i,tags:d}))},ue=(o,d)=>{const{value:i}=o.target;if(i==="__add_new__"&&d==="folder1"){S(!0);return}else if(i==="__add_new__"&&d==="category1"){T(!0);return}c(b=>({...b,[d]:i})),d==="folder1"&&(c(b=>({...b,category1:""})),i&&C[i]?z(C[i]):z([]))},pe=async o=>{if(o.preventDefault(),!t){p("No suggestion selected for editing.");return}if(!Te(e)){p("Please correct the validation errors before submitting.");return}h(!0),p(null),f(null);const d={package_name:e.package_name,description:e.description||void 0,publication_url:e.publication_url||void 0,webserver_url:e.webserver_url||void 0,repo_url:e.repo_url||void 0,link_url:e.link_url||void 0,license:e.license||void 0,tags:e.tags&&e.tags.length>0?e.tags:void 0,folder1:e.folder1||void 0,category1:e.category1||void 0,suggestion_reason:e.suggestion_reason||void 0};s&&(d.admin_notes=e.admin_notes||void 0);try{const{error:i}=await X.from("package_suggestions").update(d).eq("id",t.id);if(i)throw console.error("Supabase update error:",i),i;f("Suggestion updated successfully!"),h(!1),n()}catch(i){console.error("Error in handleSubmit:",i),p(i.message||"Failed to update suggestion."),h(!1)}},Me=async()=>{var o;if(!t||!ne||!s||!((o=e.package_name)!=null&&o.trim())){p("Invalid operation.");return}h(!0),p(null),f(null);try{const d={package_name:e.package_name,description:e.description||null,publication_url:e.publication_url||null,webserver_url:e.webserver_url||null,repo_url:e.repo_url||null,link_url:e.link_url||null,license:e.license||null,tags:e.tags&&e.tags.length>0?e.tags:null,folder1:e.folder1||null,category1:e.category1||null,suggestion_reason:e.suggestion_reason||null,admin_notes:e.admin_notes||null},{error:i}=await X.from("package_suggestions").update(d).eq("id",t.id);if(i)throw i;const{error:b}=await X.rpc("approve_suggestion_with_normalized_data",{suggestion_id:t.id,approved_by:ne.id});if(b)throw b;f("Suggestion approved and package created successfully!"),g?g():n(),l()}catch(d){console.error("Error in save and approve:",d),p(`Failed to save and approve: ${d.message}`)}finally{h(!1)}},Ne=async()=>{if(!s){p("You must be an admin to create new folders.");return}if(!y.trim()){p("Please enter a folder name.");return}oe(!0),p(null),f(null);try{const{error:o}=await X.from("folders").insert({name:y.trim()}).select().single();if(o){if(o.code==="23505")p(`Folder "${y.trim()}" already exists.`);else throw o;return}const d=[...ce,y.trim()].sort();$.setState({allAvailableFolders:d,allAvailableCategories:{...C,[y.trim()]:[]}}),c(i=>({...i,folder1:y.trim(),category1:""})),I(""),S(!1),f(`Folder "${y.trim()}" created successfully.`),await $.getState().refreshMetadata()}catch(o){console.error("Error creating folder:",o),p(`Failed to create folder: ${o.message}`)}finally{oe(!1)}},$e=async()=>{if(!s||!e.folder1||!k.trim()){p("Please select a folder and enter a category name.");return}se(!0),p(null),f(null);try{const{error:o}=await X.rpc("ensure_folder_category_exists",{folder_name:e.folder1,category_name:k.trim()});if(o)throw o;const d=C[e.folder1]||[];if(!d.includes(k.trim())){const i={...C,[e.folder1]:[...d,k.trim()].sort()};$.setState({allAvailableCategories:i}),z(i[e.folder1])}c(i=>({...i,category1:k.trim()})),E(""),T(!1),f(`Category "${k.trim()}" created successfully.`),await $.getState().refreshMetadata()}catch(o){console.error("Error creating category:",o),p(`Failed to create category: ${o.message}`)}finally{se(!1)}};return t?r.jsx(We,{open:a,onClose:l,title:"Edit Suggestion",subtitle:t.package_name,loading:m,error:j,success:G,maxWidth:"md",actions:r.jsxs(r.Fragment,{children:[r.jsx(F,{onClick:l,color:"inherit",variant:"outlined",children:"Cancel"}),r.jsx(F,{onClick:pe,variant:"contained",color:"primary",disabled:m||(t==null?void 0:t.status)!=="pending"&&!s||Object.keys(_).length>0,children:"Save Changes"}),s&&(t==null?void 0:t.status)==="pending"&&r.jsx(F,{variant:"contained",color:"success",onClick:Me,disabled:m||Object.keys(_).length>0,sx:{ml:1},children:"Save & Approve & Add to DB"})]}),children:r.jsx("form",{onSubmit:pe,children:r.jsxs(x,{container:!0,spacing:2.5,children:[r.jsx(x,{item:!0,xs:12,sm:6,children:r.jsx(w,{label:"Package Name",name:"package_name",value:e.package_name||"",onChange:R,fullWidth:!0,required:!0,variant:"outlined",size:"small",error:!!_.package_name,helperText:_.package_name})}),r.jsx(x,{item:!0,xs:12,sm:6,children:r.jsx(w,{label:"License",name:"license",value:e.license||"",onChange:R,fullWidth:!0,variant:"outlined",size:"small"})}),r.jsx(x,{item:!0,xs:12,children:r.jsx(w,{label:"Description",name:"description",value:e.description||"",onChange:R,multiline:!0,rows:3,fullWidth:!0,variant:"outlined"})}),r.jsx(x,{item:!0,xs:12,sm:6,children:r.jsx(w,{label:"Publication URL",name:"publication_url",type:"url",value:e.publication_url||"",onChange:R,fullWidth:!0,variant:"outlined",size:"small",error:!!_.publication_url,helperText:_.publication_url,InputProps:{endAdornment:e.publication_url&&r.jsx(K,{"aria-label":"open publication url in new tab",onClick:()=>window.open(e.publication_url,"_blank","noopener,noreferrer"),edge:"end",children:r.jsx(ee,{})})}})}),r.jsx(x,{item:!0,xs:12,sm:6,children:r.jsx(w,{label:"Webserver URL",name:"webserver_url",type:"url",value:e.webserver_url||"",onChange:R,fullWidth:!0,variant:"outlined",size:"small",error:!!_.webserver_url,helperText:_.webserver_url,InputProps:{endAdornment:e.webserver_url&&r.jsx(K,{"aria-label":"open webserver url in new tab",onClick:()=>window.open(e.webserver_url,"_blank","noopener,noreferrer"),edge:"end",children:r.jsx(ee,{})})}})}),r.jsx(x,{item:!0,xs:12,sm:6,children:r.jsx(w,{label:"Repository URL",name:"repo_url",type:"url",value:e.repo_url||"",onChange:R,fullWidth:!0,variant:"outlined",size:"small",error:!!_.repo_url,helperText:_.repo_url,InputProps:{endAdornment:e.repo_url&&r.jsx(K,{"aria-label":"open repository url in new tab",onClick:()=>window.open(e.repo_url,"_blank","noopener,noreferrer"),edge:"end",children:r.jsx(ee,{})})}})}),r.jsx(x,{item:!0,xs:12,sm:6,children:r.jsx(w,{label:"Other Link URL",name:"link_url",type:"url",value:e.link_url||"",onChange:R,fullWidth:!0,variant:"outlined",size:"small",error:!!_.link_url,helperText:_.link_url,InputProps:{endAdornment:e.link_url&&r.jsx(K,{"aria-label":"open other link url in new tab",onClick:()=>window.open(e.link_url,"_blank","noopener,noreferrer"),edge:"end",children:r.jsx(ee,{})})}})}),r.jsx(x,{item:!0,xs:12,children:r.jsx(De,{multiple:!0,id:"tags-edit-suggestion",options:le,value:e.tags||[],onChange:Se,freeSolo:!0,disablePortal:!0,disableCloseOnSelect:!0,limitTags:5,renderTags:(o,d)=>o.map((i,b)=>{const{key:J,...Fe}=d({index:b});return r.jsx(qe,{label:i,...Fe,size:"small",sx:{height:"22px",borderRadius:4,bgcolor:N=>N.palette.mode==="dark"?Q(N.palette.primary.main,.15):Q(N.palette.primary.light,.15),color:"primary.main",fontWeight:500,fontSize:"0.7rem",mr:.5,mb:.5,"&:hover":{bgcolor:N=>N.palette.mode==="dark"?Q(N.palette.primary.main,.25):Q(N.palette.primary.light,.25)}}},J)}),renderInput:o=>r.jsx(w,{...o,variant:"outlined",label:"Tags",placeholder:"Add or select tags",size:"small"})})}),r.jsxs(x,{item:!0,xs:12,sm:6,children:[r.jsxs(ge,{fullWidth:!0,variant:"outlined",size:"small",children:[r.jsx(fe,{id:"folder1-edit-label",children:"Folder"}),r.jsxs(me,{labelId:"folder1-edit-label",id:"folder1-edit",name:"folder1",value:e.folder1||"",onChange:o=>ue(o,"folder1"),label:"Folder",children:[r.jsx(P,{value:"",children:r.jsx("em",{children:"None"})}),ce.map(o=>r.jsx(P,{value:o,children:o},o)),s&&r.jsxs(P,{value:"__add_new__",sx:{color:"primary.main",fontWeight:"bold"},children:[r.jsx(be,{fontSize:"small",sx:{mr:1}})," Add New Folder"]})]})]}),H&&s&&r.jsxs(ve,{sx:{mt:1,display:"flex",alignItems:"center"},children:[r.jsx(w,{size:"small",placeholder:"Enter new folder name",value:y,onChange:o=>I(o.target.value),sx:{flexGrow:1},autoFocus:!0}),r.jsx(F,{size:"small",variant:"contained",onClick:Ne,sx:{ml:1},disabled:re||!y.trim(),children:re?r.jsx(he,{size:20}):"Create"}),r.jsx(F,{size:"small",onClick:()=>S(!1),sx:{ml:1},disabled:re,children:"Cancel"})]})]}),r.jsxs(x,{item:!0,xs:12,sm:6,children:[r.jsxs(ge,{fullWidth:!0,variant:"outlined",size:"small",disabled:!e.folder1,children:[r.jsx(fe,{id:"category1-edit-label",children:"Category"}),r.jsxs(me,{labelId:"category1-edit-label",id:"category1-edit",name:"category1",value:e.category1||"",onChange:o=>ue(o,"category1"),label:"Category",children:[r.jsx(P,{value:"",children:r.jsx("em",{children:"None"})}),ze.map(o=>r.jsx(P,{value:o,children:o},o)),s&&e.folder1&&r.jsxs(P,{value:"__add_new__",sx:{color:"primary.main",fontWeight:"bold"},children:[r.jsx(be,{fontSize:"small",sx:{mr:1}})," Add New Category"]})]})]}),M&&s&&r.jsxs(ve,{sx:{mt:1,display:"flex",alignItems:"center"},children:[r.jsx(w,{size:"small",placeholder:"Enter new category name",value:k,onChange:o=>E(o.target.value),sx:{flexGrow:1},autoFocus:!0}),r.jsx(F,{size:"small",variant:"contained",onClick:$e,sx:{ml:1},disabled:te||!k.trim(),children:te?r.jsx(he,{size:20}):"Create"}),r.jsx(F,{size:"small",onClick:()=>T(!1),sx:{ml:1},disabled:te,children:"Cancel"})]})]}),r.jsx(x,{item:!0,xs:12,children:r.jsx(w,{label:"Reason for Suggestion",name:"suggestion_reason",value:e.suggestion_reason||"",onChange:R,multiline:!0,rows:3,fullWidth:!0,variant:"outlined",disabled:!s&&(t==null?void 0:t.status)!=="pending"})}),s&&r.jsx(x,{item:!0,xs:12,children:r.jsx(w,{label:"Admin Notes",name:"admin_notes",value:e.admin_notes||"",onChange:R,multiline:!0,rows:3,fullWidth:!0,variant:"outlined"})})]})})}):null};export{Ra as E,ja as T,_a as a,ka as b,Ta as c,wa as d,Ca as e};
