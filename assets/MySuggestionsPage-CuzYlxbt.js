import{y as X,z as Z,D as ee,E as te,R as se,o as ae,r as i,n as A,j as e,t as re,v as ne,C as j,A as P,T as z,U as ie,N as oe,ay as u,I as O}from"./index-4SPLIEu2.js";import{D as le}from"./Delete-Br31ATFd.js";import{T as de,a as ce,b as ue,c as W,d as s,e as ge,E as he}from"./EditSuggestionModal-D4Kv-HIE.js";import"./Grid-D_GsxMrC.js";var d={},B;function xe(){if(B)return d;B=1;var c=X();Object.defineProperty(d,"__esModule",{value:!0}),d.default=void 0;var r=c(Z()),l=ee();return d.default=(0,r.default)((0,l.jsx)("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.9959.9959 0 0 0-1.41 0l-1.83 1.83 3.75 3.75z"}),"Edit"),d}var pe=xe();const fe=te(pe),Ee=()=>{const c=se(),{currentUser:r,loading:l,isAdmin:g}=ae(),a=(r==null?void 0:r.id)||null,[y,h]=i.useState([]),[L,v]=i.useState(!0),[S,x]=i.useState(null),[E,p]=i.useState(null),[N,f]=i.useState(!1),m=i.useCallback(async()=>{if(a){v(!0),x(null);try{const{data:t,error:n}=await A.from("package_suggestions").select(`
					*,
					package_suggestion_tags!left(
						tag_id,
						tags!inner(id, name)
					),
					package_suggestion_folder_categories!left(
						folder_category_id,
						folder_categories!inner(
							id,
							folder_id,
							category_id,
							folders!inner(id, name),
							categories!inner(id, name)
						)
					)
				`).eq("suggested_by_user_id",a).order("created_at",{ascending:!1});if(n)throw n;const _=(t||[]).map(o=>{var b,w,k,C,q,D,T,M,I;const V=((b=o.package_suggestion_tags)==null?void 0:b.map(U=>{var R;return(R=U.tags)==null?void 0:R.name}).filter(Boolean))||[],G=((q=(C=(k=(w=o.package_suggestion_folder_categories)==null?void 0:w[0])==null?void 0:k.folder_categories)==null?void 0:C.folders)==null?void 0:q.name)||"",K=((I=(M=(T=(D=o.package_suggestion_folder_categories)==null?void 0:D[0])==null?void 0:T.folder_categories)==null?void 0:M.categories)==null?void 0:I.name)||"",{package_suggestion_tags:me,package_suggestion_folder_categories:_e,...Q}=o;return{...Q,tags:V,folder:G,category:K}});h(_)}catch(t){console.error("Error fetching suggestions:",t.message),x(`Failed to load your suggestions: ${t.message}`),h([])}finally{v(!1)}}},[a]);i.useEffect(()=>{!l&&!r?c("/login"):a&&m()},[a,l,c,m]);const F=async t=>{if(window.confirm("Are you sure you want to delete this pending suggestion? This action cannot be undone.")&&a)try{const{error:n}=await A.from("package_suggestions").delete().eq("id",t).eq("status","pending").eq("suggested_by_user_id",a);if(n)throw n;h(_=>_.filter(o=>o.id!==t))}catch(n){x(`Failed to delete suggestion: ${n.message}`)}},Y=t=>{t.status==="pending"&&t.suggested_by_user_id===a||g?(p(t),f(!0)):alert("You can only edit your own suggestions that are still pending.")},$=()=>{p(null),f(!1)},H=()=>{m(),f(!1),p(null)},J=t=>{switch(t){case"pending":return"warning";case"approved":return"success";case"rejected":return"error";case"added":return"info";default:return"default"}};return l||L?e.jsx(re,{display:"flex",justifyContent:"center",alignItems:"center",height:"50vh",children:e.jsx(ne,{})}):S?e.jsx(j,{maxWidth:"md",sx:{mt:4},children:e.jsx(P,{severity:"error",children:S})}):r?e.jsxs(j,{maxWidth:"lg",sx:{mt:4,mb:4},children:[e.jsx(z,{variant:"h4",gutterBottom:!0,component:"h1",sx:{mb:3,color:t=>(t.palette.mode==="dark",t.palette.text.primary)},children:"My Package Suggestions"}),y.length===0?e.jsx(z,{children:"You haven't submitted any package suggestions yet."}):e.jsx(de,{component:ie,elevation:2,children:e.jsxs(ce,{sx:{minWidth:650},"aria-label":"my suggestions table",children:[e.jsx(ue,{children:e.jsxs(W,{children:[e.jsx(s,{children:"Package Name"}),e.jsx(s,{children:"Status"}),e.jsx(s,{children:"Submitted"}),e.jsx(s,{children:"Reason"}),e.jsx(s,{children:"Admin Notes"}),e.jsx(s,{align:"right",children:"Actions"})]})}),e.jsx(ge,{children:y.map(t=>e.jsxs(W,{hover:!0,children:[e.jsx(s,{component:"th",scope:"row",children:t.package_name}),e.jsx(s,{children:e.jsx(oe,{label:t.status,color:J(t.status),size:"small"})}),e.jsx(s,{children:new Date(t.created_at).toLocaleDateString()}),e.jsx(s,{sx:{maxWidth:200,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.jsx(u,{title:t.suggestion_reason||"",children:e.jsx("span",{children:t.suggestion_reason||"-"})})}),e.jsx(s,{sx:{maxWidth:200,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.jsx(u,{title:t.admin_notes||"",children:e.jsx("span",{children:t.admin_notes||"-"})})}),e.jsxs(s,{align:"right",children:[(t.status==="pending"&&t.suggested_by_user_id===a||g)&&e.jsx(u,{title:"Edit Suggestion",children:e.jsx(O,{size:"small",onClick:()=>Y(t),sx:{color:"primary.main"},children:e.jsx(fe,{})})}),t.status==="pending"&&t.suggested_by_user_id===a&&e.jsx(u,{title:"Delete Suggestion",children:e.jsx(O,{size:"small",onClick:()=>F(t.id),sx:{ml:1,color:"error.main"},children:e.jsx(le,{})})})]})]},t.id))})]})}),E&&e.jsx(he,{open:N,onClose:$,suggestion:E,onSaveSuccess:H,isAdmin:!!g})]}):e.jsx(j,{maxWidth:"md",sx:{mt:4},children:e.jsx(P,{severity:"info",children:"Please log in to view your suggestions."})})};export{Ee as default};
