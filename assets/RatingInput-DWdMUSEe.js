import{c as q,j as n,a as He,g as _e,r,d as Ie,_ as ge,aB as he,u as Pe,e as we,aC as Be,a9 as Oe,b as p,s as Q,f as K,h as pe,i as Te,aD as $e,aE as Ne,aF as qe,x as me,y as ve,z as xe,D as ye,R as De,p as le,ao as Ue,I as ke,q as ce,T as G,ax as We,V as Xe,A as Ye,H as Je}from"./index-BYaY9fnE.js";import{D as Ge}from"./Delete-DWUvRHj0.js";import{a as te,R as ne}from"./ratingService-DaIbtx7v.js";const Ke=q(n.jsx("path",{d:"M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"}),"Star"),Qe=q(n.jsx("path",{d:"M22 9.24l-7.19-.62L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21 12 17.27 18.18 21l-1.63-7.03L22 9.24zM12 15.4l-3.76 2.27 1-4.28-3.32-2.88 4.38-.38L12 6.1l1.71 4.04 4.38.38-3.32 2.88 1 4.28L12 15.4z"}),"StarBorder");function Ze(e){return _e("MuiRating",e)}const k=He("MuiRating",["root","sizeSmall","sizeMedium","sizeLarge","readOnly","disabled","focusVisible","visuallyHidden","pristine","label","labelEmptyValueActive","icon","iconEmpty","iconFilled","iconHover","iconFocus","iconActive","decimal"]),et=["value"],tt=["className","defaultValue","disabled","emptyIcon","emptyLabelText","getLabelText","highlightSelectedOnly","icon","IconContainerComponent","max","name","onChange","onChangeActive","onMouseLeave","onMouseMove","precision","readOnly","size","value"];function nt(e){const t=e.toString().split(".")[1];return t?t.length:0}function oe(e,t){if(e==null)return e;const a=Math.round(e/t)*t;return Number(a.toFixed(nt(t)))}const ot=e=>{const{classes:t,size:a,readOnly:c,disabled:V,emptyValueFocused:v,focusVisible:C}=e,x={root:["root",`size${pe(a)}`,V&&"disabled",C&&"focusVisible",c&&"readOnly"],label:["label","pristine"],labelEmptyValue:[v&&"labelEmptyValueActive"],icon:["icon"],iconEmpty:["iconEmpty"],iconFilled:["iconFilled"],iconHover:["iconHover"],iconFocus:["iconFocus"],iconActive:["iconActive"],decimal:["decimal"],visuallyHidden:["visuallyHidden"]};return Te(x,Ze,t)},at=Q("span",{name:"MuiRating",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:a}=e;return[{[`& .${k.visuallyHidden}`]:t.visuallyHidden},t.root,t[`size${pe(a.size)}`],a.readOnly&&t.readOnly]}})(({theme:e,ownerState:t})=>p({display:"inline-flex",position:"relative",fontSize:e.typography.pxToRem(24),color:"#faaf00",cursor:"pointer",textAlign:"left",width:"min-content",WebkitTapHighlightColor:"transparent",[`&.${k.disabled}`]:{opacity:(e.vars||e).palette.action.disabledOpacity,pointerEvents:"none"},[`&.${k.focusVisible} .${k.iconActive}`]:{outline:"1px solid #999"},[`& .${k.visuallyHidden}`]:$e},t.size==="small"&&{fontSize:e.typography.pxToRem(18)},t.size==="large"&&{fontSize:e.typography.pxToRem(30)},t.readOnly&&{pointerEvents:"none"})),Re=Q("label",{name:"MuiRating",slot:"Label",overridesResolver:({ownerState:e},t)=>[t.label,e.emptyValueFocused&&t.labelEmptyValueActive]})(({ownerState:e})=>p({cursor:"inherit"},e.emptyValueFocused&&{top:0,bottom:0,position:"absolute",outline:"1px solid #999",width:"100%"})),it=Q("span",{name:"MuiRating",slot:"Icon",overridesResolver:(e,t)=>{const{ownerState:a}=e;return[t.icon,a.iconEmpty&&t.iconEmpty,a.iconFilled&&t.iconFilled,a.iconHover&&t.iconHover,a.iconFocus&&t.iconFocus,a.iconActive&&t.iconActive]}})(({theme:e,ownerState:t})=>p({display:"flex",transition:e.transitions.create("transform",{duration:e.transitions.duration.shortest}),pointerEvents:"none"},t.iconActive&&{transform:"scale(1.2)"},t.iconEmpty&&{color:(e.vars||e).palette.action.disabled})),st=Q("span",{name:"MuiRating",slot:"Decimal",shouldForwardProp:e=>Ne(e)&&e!=="iconActive",overridesResolver:(e,t)=>{const{iconActive:a}=e;return[t.decimal,a&&t.iconActive]}})(({iconActive:e})=>p({position:"relative"},e&&{transform:"scale(1.2)"}));function rt(e){const t=ge(e,et);return n.jsx("span",p({},t))}function ue(e){const{classes:t,disabled:a,emptyIcon:c,focus:V,getLabelText:v,highlightSelectedOnly:C,hover:x,icon:y,IconContainerComponent:R,isActive:w,itemValue:l,labelProps:A,name:F,onBlur:B,onChange:z,onClick:h,onFocus:M,readOnly:_,ownerState:i,ratingValue:m,ratingValueRounded:u}=e,E=C?l===m:l<=m,O=l<=x,S=l<=V,D=l===u,I=he(),j=n.jsx(it,{as:R,value:l,className:K(t.icon,E?t.iconFilled:t.iconEmpty,O&&t.iconHover,S&&t.iconFocus,w&&t.iconActive),ownerState:p({},i,{iconEmpty:!E,iconFilled:E,iconHover:O,iconFocus:S,iconActive:w}),children:c&&!E?c:y});return _?n.jsx("span",p({},A,{children:j})):n.jsxs(r.Fragment,{children:[n.jsxs(Re,p({ownerState:p({},i,{emptyValueFocused:void 0}),htmlFor:I},A,{children:[j,n.jsx("span",{className:t.visuallyHidden,children:v(l)})]})),n.jsx("input",{className:t.visuallyHidden,onFocus:M,onBlur:B,onChange:z,onClick:h,disabled:a,value:l,id:I,type:"radio",name:F,checked:D})]})}const lt=n.jsx(Ke,{fontSize:"inherit"}),ct=n.jsx(Qe,{fontSize:"inherit"});function ut(e){return`${e} Star${e!==1?"s":""}`}const dt=r.forwardRef(function(t,a){const c=Ie({name:"MuiRating",props:t}),{className:V,defaultValue:v=null,disabled:C=!1,emptyIcon:x=ct,emptyLabelText:y="Empty",getLabelText:R=ut,highlightSelectedOnly:w=!1,icon:l=lt,IconContainerComponent:A=rt,max:F=5,name:B,onChange:z,onChangeActive:h,onMouseLeave:M,onMouseMove:_,precision:i=1,readOnly:m=!1,size:u="medium",value:E}=c,O=ge(c,tt),S=he(B),[D,I]=Pe({controlled:E,default:v,name:"Rating"}),j=oe(D,i),Y=we(),[{hover:o,focus:f},g]=r.useState({hover:-1,focus:-1});let T=j;o!==-1&&(T=o),f!==-1&&(T=f);const{isFocusVisibleRef:ae,onBlur:be,onFocus:Se,ref:je}=Be(),[Ce,Z]=r.useState(!1),ie=r.useRef(),Fe=Oe(je,ie,a),ze=s=>{_&&_(s);const d=ie.current,{right:b,left:J,width:$}=d.getBoundingClientRect();let N;Y?N=(b-s.clientX)/$:N=(s.clientX-J)/$;let L=oe(F*N+i/2,i);L=qe(L,i,F),g(P=>P.hover===L&&P.focus===L?P:{hover:L,focus:L}),Z(!1),h&&o!==L&&h(s,L)},Me=s=>{M&&M(s);const d=-1;g({hover:d,focus:d}),h&&o!==d&&h(s,d)},se=s=>{let d=s.target.value===""?null:parseFloat(s.target.value);o!==-1&&(d=o),I(d),z&&z(s,d)},Ee=s=>{s.clientX===0&&s.clientY===0||(g({hover:-1,focus:-1}),I(null),z&&parseFloat(s.target.value)===j&&z(s,null))},Le=s=>{Se(s),ae.current===!0&&Z(!0);const d=parseFloat(s.target.value);g(b=>({hover:b.hover,focus:d}))},Ve=s=>{if(o!==-1)return;be(s),ae.current===!1&&Z(!1);const d=-1;g(b=>({hover:b.hover,focus:d}))},[Ae,re]=r.useState(!1),U=p({},c,{defaultValue:v,disabled:C,emptyIcon:x,emptyLabelText:y,emptyValueFocused:Ae,focusVisible:Ce,getLabelText:R,icon:l,IconContainerComponent:A,max:F,precision:i,readOnly:m,size:u}),H=ot(U);return n.jsxs(at,p({ref:Fe,onMouseMove:ze,onMouseLeave:Me,className:K(H.root,V,m&&"MuiRating-readOnly"),ownerState:U,role:m?"img":null,"aria-label":m?R(T):null},O,{children:[Array.from(new Array(F)).map((s,d)=>{const b=d+1,J={classes:H,disabled:C,emptyIcon:x,focus:f,getLabelText:R,highlightSelectedOnly:w,hover:o,icon:l,IconContainerComponent:A,name:S,onBlur:Ve,onChange:se,onClick:Ee,onFocus:Le,ratingValue:T,ratingValueRounded:j,readOnly:m,ownerState:U},$=b===Math.ceil(T)&&(o!==-1||f!==-1);if(i<1){const N=Array.from(new Array(1/i));return n.jsx(st,{className:K(H.decimal,$&&H.iconActive),ownerState:U,iconActive:$,children:N.map((L,P)=>{const ee=oe(b-1+(P+1)*i,i);return n.jsx(ue,p({},J,{isActive:!1,itemValue:ee,labelProps:{style:N.length-1===P?{}:{width:ee===T?`${(P+1)*i*100}%`:"0%",overflow:"hidden",position:"absolute"}}}),ee)})},b)}return n.jsx(ue,p({},J,{isActive:$,itemValue:b}),b)}),!m&&!C&&n.jsxs(Re,{className:K(H.label,H.labelEmptyValue),ownerState:U,children:[n.jsx("input",{className:H.visuallyHidden,value:"",id:`${S}-empty`,type:"radio",name:S,checked:j==null,onFocus:()=>re(!0),onBlur:()=>re(!1),onChange:se}),n.jsx("span",{className:H.visuallyHidden,children:y})]})]}))}),bt=q(n.jsx("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m-5 14H7v-2h7zm3-4H7v-2h10zm0-4H7V7h10z"}),"Article"),St=q(n.jsx("path",{d:"M9.4 16.6 4.8 12l4.6-4.6L8 6l-6 6 6 6zm5.2 0 4.6-4.6-4.6-4.6L16 6l6 6-6 6z"}),"Code"),jt=q(n.jsx("path",{d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2m6.93 6h-2.95c-.32-1.25-.78-2.45-1.38-3.56 1.84.63 3.37 1.91 4.33 3.56M12 4.04c.83 1.2 1.48 2.53 1.91 3.96h-3.82c.43-1.43 1.08-2.76 1.91-3.96M4.26 14C4.1 13.36 4 12.69 4 12s.1-1.36.26-2h3.38c-.08.66-.14 1.32-.14 2 0 .68.06 1.34.14 2zm.82 2h2.95c.32 1.25.78 2.45 1.38 3.56-1.84-.63-3.37-1.9-4.33-3.56m2.95-8H5.08c.96-1.66 2.49-2.93 4.33-3.56C8.81 5.55 8.35 6.75 8.03 8M12 19.96c-.83-1.2-1.48-2.53-1.91-3.96h3.82c-.43 1.43-1.08 2.76-1.91 3.96M14.34 14H9.66c-.09-.66-.16-1.32-.16-2 0-.68.07-1.35.16-2h4.68c.09.65.16 1.32.16 2 0 .68-.07 1.34-.16 2m.25 5.56c.6-1.11 1.06-2.31 1.38-3.56h2.95c-.96 1.65-2.49 2.93-4.33 3.56M16.36 14c.08-.66.14-1.32.14-2 0-.68-.06-1.34-.14-2h3.38c.16.64.26 1.31.26 2s-.1 1.36-.26 2z"}),"Language"),Ct=q(n.jsx("path",{d:"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1M8 13h8v-2H8zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5"}),"Link");var W={},de;function ft(){if(de)return W;de=1;var e=me();Object.defineProperty(W,"__esModule",{value:!0}),W.default=void 0;var t=e(ve()),a=xe();return W.default=(0,t.default)((0,a.jsx)("path",{d:"M12 17.27 18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"}),"Star"),W}var gt=ft();const ht=ye(gt);var X={},fe;function pt(){if(fe)return X;fe=1;var e=me();Object.defineProperty(X,"__esModule",{value:!0}),X.default=void 0;var t=e(ve()),a=xe();return X.default=(0,t.default)((0,a.jsx)("path",{d:"m22 9.24-7.19-.62L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21 12 17.27 18.18 21l-1.63-7.03zM12 15.4l-3.76 2.27 1-4.28-3.32-2.88 4.38-.38L12 6.1l1.71 4.04 4.38.38-3.32 2.88 1 4.28z"}),"StarBorder"),X}var mt=pt();const vt=ye(mt),Ft=({packageId:e,initialAverageRating:t=0,initialRatingsCount:a=0})=>{const{currentUser:c}=De(),[V,v]=r.useState(t),[C,x]=r.useState(a),[y,R]=r.useState(null),[w,l]=r.useState(null),[A,F]=r.useState(null),[B,z]=r.useState(!1),[h,M]=r.useState(!1),[_,i]=r.useState(null),m=r.useRef(e),u=r.useRef(!0);r.useEffect(()=>{m.current=e},[e]),r.useEffect(()=>()=>{u.current=!1},[]);const E=r.useCallback(async()=>{if(!c){R(null);return}z(!0),i(null);try{const o=await te.getUserRating(e);u.current&&(R((o==null?void 0:o.rating)||null),l((o==null?void 0:o.rating)||null))}catch(o){console.error("Error fetching initial rating data:",o),u.current&&i("Failed to load rating data")}finally{u.current&&z(!1)}},[c,e]);r.useEffect(()=>ne.subscribe(f=>{f.packageId===m.current&&u.current&&(v(f.averageRating),x(f.ratingsCount),f.userRating!==void 0&&(R(f.userRating),l(f.userRating)))}),[]),r.useEffect(()=>{v(t),x(a)},[t,a]),r.useEffect(()=>{E()},[E]);const O=o=>{c&&(F(o.currentTarget),i(null))},S=()=>{F(null),l(y),i(null)},D=async(o,f)=>{if(!(!c||f===null||h)){M(!0),i(null),l(f);try{const g=await te.upsertRating(e,f);u.current&&(v(g.average_rating),x(g.ratings_count),R(g.user_rating),l(g.user_rating),ne.emit({packageId:e,averageRating:g.average_rating,ratingsCount:g.ratings_count,userRating:g.user_rating}),setTimeout(()=>{u.current&&S()},500))}catch(g){console.error("Error submitting rating:",g),u.current&&(i("Failed to submit rating. Please try again."),l(y))}finally{u.current&&M(!1)}}},I=async()=>{if(!(!c||!y||h)){M(!0),i(null);try{const o=await te.deleteRating(e);u.current&&(v(o.average_rating),x(o.ratings_count),R(null),l(null),ne.emit({packageId:e,averageRating:o.average_rating,ratingsCount:o.ratings_count,userRating:void 0}),S())}catch(o){console.error("Error deleting rating:",o),u.current&&i("Failed to delete rating. Please try again.")}finally{u.current&&M(!1)}}},j=!!A,Y=j?`rating-popover-${e}`:void 0;return n.jsxs(le,{sx:{display:"flex",alignItems:"center",gap:.5},children:[n.jsx(Ue,{title:c?"Rate this package":"Login to rate",children:n.jsx("span",{children:n.jsx(ke,{size:"small",onClick:O,"aria-describedby":Y,disabled:B||h||!c,sx:{p:.5},children:B||h?n.jsx(ce,{size:20}):n.jsx(ht,{fontSize:"inherit",sx:{color:V>0?"warning.main":"action.disabled"}})})})}),n.jsx(G,{variant:"body2",sx:{fontWeight:"medium",minWidth:"2ch"},children:V.toFixed(1)}),n.jsxs(G,{variant:"body2",color:"text.secondary",sx:{minWidth:"3ch"},children:["(",C,")"]}),n.jsx(We,{id:Y,open:j,anchorEl:A,onClose:S,anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"},PaperProps:{sx:{p:2,minWidth:200}},children:n.jsxs(Xe,{spacing:2,alignItems:"center",children:[n.jsx(G,{variant:"subtitle2",color:"text.primary",children:y?"Update Your Rating":"Rate This Package"}),_&&n.jsx(Ye,{severity:"error",sx:{width:"100%",py:.5},children:_}),n.jsx(dt,{name:`rating-${e}`,value:w,onChange:D,precision:1,emptyIcon:n.jsx(vt,{fontSize:"inherit"}),disabled:h,sx:{fontSize:"1.5rem"}}),y&&n.jsx(Je,{variant:"outlined",color:"error",size:"small",startIcon:n.jsx(Ge,{}),onClick:I,disabled:h,sx:{mt:1},children:"Remove Rating"}),h&&n.jsxs(le,{sx:{display:"flex",alignItems:"center",gap:1},children:[n.jsx(ce,{size:16}),n.jsx(G,{variant:"caption",color:"text.secondary",children:y?"Updating...":"Submitting..."})]})]})})]})};export{bt as A,St as C,jt as L,Ft as R,Ct as a};
