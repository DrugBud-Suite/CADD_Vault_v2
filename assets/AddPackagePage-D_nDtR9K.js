import{Q as B,n as M,r as s,o as m,j as e,q as O,t as j,T as y,R as T,G as i,a3 as d,F as I,a4 as L,S as W,M as h,a5 as $,N as F,m as o,a6 as Q,H as Y,a7 as J,a2 as k}from"./index-BuzR7-x9.js";const V=()=>{const x=B(),{isAdmin:g,loading:f}=M(),[a,p]=s.useState({package_name:"",description:"",publication:"",webserver:"",repo_link:"",link:"",license:"",tags:[],folder1:"",category1:""}),[b,_]=s.useState(!1),[C,v]=s.useState(null),R=m(r=>r.allAvailableTags),S=m(r=>r.originalPackages.length>0),[w,A]=s.useState(!0),[N,z]=s.useState([]),[D,P]=s.useState([]);s.useEffect(()=>{!f&&!g&&(console.warn("Access denied: User is not an admin."),x("/"))},[g,f,x]),s.useEffect(()=>{g&&A(!S)},[g,S]),s.useEffect(()=>{const r=m.getState().allAvailableFolders;z(r)},[]),s.useEffect(()=>{if(a.folder1){const r=m.getState().allAvailableCategories[a.folder1]||[];P(r)}else P([])},[a.folder1]);const c=r=>{const{name:l,value:n}=r.target;p(t=>({...t,[l]:n}))},U=(r,l)=>{p(n=>({...n,tags:l}))},E=r=>{const{name:l,value:n}=r.target;p(t=>({...t,[l]:n})),l==="folder1"&&p(t=>({...t,category1:""}))},G=async r=>{if(r.preventDefault(),v(null),!a.package_name){v("Package Name is required.");return}_(!0);try{const l=J(),{error:n}=await k.from("packages").insert({id:l,package_name:a.package_name,description:a.description||null,publication:a.publication||null,webserver:a.webserver||null,repo_link:a.repo_link||null,link:a.link||null,license:a.license||null,last_updated:new Date().toISOString(),tags:a.tags||[],folder1:a.folder1||null,category1:a.category1||null}).select().single();if(n)throw n;if(a.tags&&a.tags.length>0){const{error:t}=await k.rpc("update_package_tags",{package_uuid:l,new_tags:a.tags});t&&console.error("Error updating tags:",t)}if(a.folder1&&a.category1){const{error:t}=await k.rpc("update_package_folder_category",{package_uuid:l,folder_name:a.folder1,category_name:a.category1});t&&console.error("Error updating folder/category:",t)}x(`/package/${encodeURIComponent(l)}`)}catch(l){console.error("Error adding package:",l),v(`Failed to add package: ${l.message}`)}finally{_(!1)}};return f?e.jsx(O,{display:"flex",justifyContent:"center",alignItems:"center",height:"50vh",children:e.jsx(j,{})}):g?e.jsxs(T,{elevation:3,sx:{p:3,m:2},children:[e.jsx(y,{variant:"h4",gutterBottom:!0,component:"div",children:"Add New Package"}),e.jsx("form",{onSubmit:G,children:e.jsxs(i,{container:!0,spacing:3,children:[e.jsx(i,{item:!0,xs:12,children:e.jsx(d,{id:"package_name",label:"Package Name (package_name)",name:"package_name",value:a.package_name,onChange:c,required:!0,fullWidth:!0,variant:"outlined"})}),e.jsx(i,{item:!0,xs:12,children:e.jsx(d,{id:"description",label:"Description",name:"description",value:a.description,onChange:c,multiline:!0,rows:4,fullWidth:!0,variant:"outlined"})}),e.jsx(i,{item:!0,xs:12,sm:6,children:e.jsx(d,{id:"publication",label:"Publication URL",name:"publication",value:a.publication,onChange:c,fullWidth:!0,variant:"outlined",type:"url"})}),e.jsx(i,{item:!0,xs:12,sm:6,children:e.jsx(d,{id:"webserver",label:"Webserver/Homepage URL",name:"webserver",value:a.webserver,onChange:c,fullWidth:!0,variant:"outlined",type:"url"})}),e.jsx(i,{item:!0,xs:12,sm:6,children:e.jsx(d,{id:"repo_link",label:"Code Repository Link (GitHub or other)",name:"repo_link",value:a.repo_link,onChange:c,fullWidth:!0,variant:"outlined",type:"url",helperText:"Enter the URL for the code repository"})}),e.jsx(i,{item:!0,xs:12,sm:6,children:e.jsx(d,{id:"link",label:"General Link",name:"link",value:a.link,onChange:c,fullWidth:!0,variant:"outlined",type:"url",helperText:"Any other relevant link (not publication or webserver)"})}),e.jsx(i,{item:!0,xs:12,sm:6,children:e.jsx(d,{id:"license",label:"License",name:"license",value:a.license,onChange:c,fullWidth:!0,variant:"outlined"})}),e.jsx(i,{item:!0,xs:12,sm:6,children:e.jsxs(I,{fullWidth:!0,variant:"outlined",children:[e.jsx(L,{id:"folder1-label",children:"Folder"}),e.jsxs(W,{labelId:"folder1-label",id:"folder1",name:"folder1",value:a.folder1||"",onChange:E,label:"Folder",children:[e.jsx(h,{value:"",children:e.jsx("em",{children:"None"})}),N.map(r=>e.jsx(h,{value:r,children:r},r))]})]})}),e.jsx(i,{item:!0,xs:12,sm:6,children:e.jsxs(I,{fullWidth:!0,variant:"outlined",children:[e.jsx(L,{id:"category1-label",children:"Category"}),e.jsxs(W,{labelId:"category1-label",id:"category1",name:"category1",value:a.category1||"",onChange:E,label:"Category",disabled:!a.folder1,children:[e.jsx(h,{value:"",children:e.jsx("em",{children:"None"})}),D.map(r=>e.jsx(h,{value:r,children:r},r))]})]})}),e.jsx(i,{item:!0,xs:12,children:e.jsx($,{multiple:!0,id:"tags-standard",options:R,loading:w,value:a.tags||[],onChange:U,freeSolo:!0,renderTags:(r,l)=>r.map((n,t)=>{const{key:H,...q}=l({index:t});return e.jsx(F,{label:n,...q,size:"small",sx:{height:"22px",borderRadius:4,bgcolor:u=>u.palette.mode==="dark"?o(u.palette.primary.main,.15):o(u.palette.primary.light,.15),color:"primary.main",fontWeight:500,fontSize:"0.7rem",mr:.5,mb:.5,"&:hover":{bgcolor:u=>u.palette.mode==="dark"?o(u.palette.primary.main,.25):o(u.palette.primary.light,.25)}}},H)}),renderInput:r=>e.jsx(d,{...r,variant:"outlined",label:"Tags",placeholder:"Add or select tags",helperText:"Type to see suggestions or add new tags",InputProps:{...r.InputProps,endAdornment:e.jsxs(Q.Fragment,{children:[w?e.jsx(j,{color:"inherit",size:20}):null,r.InputProps.endAdornment]})}}),PaperComponent:({children:r,...l})=>e.jsx(T,{...l,sx:{boxShadow:3,maxHeight:"200px",overflow:"auto"},children:r}),ListboxProps:{style:{display:"flex",flexWrap:"wrap",gap:"4px",padding:"4px",margin:0,listStyle:"none"}},renderOption:(r,l,{selected:n})=>e.jsx("li",{...r,style:{margin:0,padding:0,width:"auto",listStyle:"none"},children:e.jsx(F,{label:l,size:"small",variant:n?"filled":"outlined",clickable:!0,sx:{height:"22px",borderRadius:4,bgcolor:t=>n?t.palette.mode==="dark"?o(t.palette.primary.main,.35):o(t.palette.primary.light,.35):t.palette.mode==="dark"?o(t.palette.primary.main,.15):o(t.palette.primary.light,.15),color:"primary.main",fontWeight:500,fontSize:"0.7rem",cursor:"pointer",m:.25,"&:hover":{bgcolor:t=>t.palette.mode==="dark"?o(t.palette.primary.main,.25):o(t.palette.primary.light,.25)},display:"inline-flex"}})})})}),e.jsxs(i,{item:!0,xs:12,children:[C&&e.jsx(y,{color:"error",sx:{mb:2},children:C}),e.jsx(Y,{type:"submit",variant:"contained",color:"primary",disabled:b,startIcon:b?e.jsx(j,{size:20}):null,children:b?"Adding...":"Add Package"})]})]})})]}):e.jsx(y,{color:"error",align:"center",children:"Access Denied. You must be an admin to add packages."})};export{V as default};
