import{P as U,Q as W,R as q,r as l,t as y,j as e,p as F,q as C,T as f,U as G,G as i,a3 as c,a4 as N,a5 as $,N as B,H as _}from"./index-B9BmRKEw.js";const z=()=>{const{packageId:P}=U(),o=P?decodeURIComponent(P):void 0,x=W(),{isAdmin:n,loading:v}=q(),[s,j]=l.useState({}),[p,A]=l.useState(!1),[h,k]=l.useState(!1),[m,d]=l.useState(null),[L,S]=l.useState([]),[E,I]=l.useState(!1),T=l.useCallback(async()=>{if(!(!o||!n)){k(!0),d(null);try{const{data:a,error:t}=await y.from("packages").select("*").eq("id",o).single();if(t)throw t;if(a){const r={...a,repo_link:a.repo_link||a.repository||""};j(r),A(!0)}else d("Package not found.")}catch(a){console.error("Error fetching package for edit:",a.message),d(`Failed to load package data for editing: ${a.message}`)}finally{k(!1)}}},[o,n]);l.useEffect(()=>{if(!v&&!n){console.warn("Access denied: User is not an admin."),x("/");return}n&&o&&!p&&T()},[n,v,x,o,p,T]),l.useEffect(()=>{n&&(async()=>{if(n){I(!0);try{const{data:t,error:r}=await y.from("packages").select("tags");if(r)throw r;const g=new Set;t.forEach(b=>{b.tags&&Array.isArray(b.tags)&&b.tags.forEach(R=>g.add(R))}),S(Array.from(g).sort())}catch(t){console.error("Error fetching existing tags:",t.message)}finally{I(!1)}}})()},[n]);const u=a=>{const{name:t,value:r}=a.target;j(g=>({...g,[t]:r}))},w=(a,t)=>{j(r=>({...r,tags:t}))},D=async a=>{if(a.preventDefault(),d(null),!o){d("Package ID is missing.");return}if(!s.package_name){d("Package Name (package_name) is required.");return}k(!0);try{const t={...s,id:void 0},{error:r}=await y.from("packages").update(t).eq("id",o);if(r)throw r;console.log("Package updated successfully"),x(`/package/${encodeURIComponent(o)}`)}catch(t){console.error("Error updating package: ",t.message),d(`Failed to update package: ${t.message}`)}finally{k(!1)}};return v||n&&!p&&!m?e.jsx(F,{display:"flex",justifyContent:"center",alignItems:"center",height:"50vh",children:e.jsx(C,{})}):n?m&&!p?e.jsx(f,{color:"error",align:"center",children:m}):n&&!p?e.jsx(f,{color:"error",align:"center",children:"Could not load package data."}):e.jsxs(G,{elevation:3,sx:{p:3,m:2},children:[e.jsxs(f,{variant:"h4",gutterBottom:!0,component:"div",children:["Edit Package: ",s.package_name||"..."]}),e.jsx("form",{onSubmit:D,children:e.jsxs(i,{container:!0,spacing:3,children:[e.jsx(i,{item:!0,xs:12,children:e.jsx(c,{id:"package_name",label:"Package Name (package_name)",name:"package_name",value:s.package_name||"",onChange:u,required:!0,fullWidth:!0,variant:"outlined"})}),e.jsx(i,{item:!0,xs:12,children:e.jsx(c,{id:"description",label:"Description",name:"description",value:s.description||"",onChange:u,multiline:!0,rows:4,fullWidth:!0,variant:"outlined"})}),e.jsx(i,{item:!0,xs:12,sm:6,children:e.jsx(c,{id:"publication",label:"Publication URL",name:"publication",value:s.publication||"",onChange:u,fullWidth:!0,variant:"outlined",type:"url"})}),e.jsx(i,{item:!0,xs:12,sm:6,children:e.jsx(c,{id:"webserver",label:"Webserver/Homepage URL",name:"webserver",value:s.webserver||"",onChange:u,fullWidth:!0,variant:"outlined",type:"url"})}),e.jsx(i,{item:!0,xs:12,sm:6,children:e.jsx(c,{id:"repo_link",label:"Code Repository Link (GitHub or other)",name:"repo_link",value:s.repo_link||"",onChange:u,fullWidth:!0,variant:"outlined",type:"url",helperText:"Enter the URL for the code repository"})}),e.jsx(i,{item:!0,xs:12,sm:6,children:e.jsx(c,{id:"link",label:"General Link",name:"link",value:s.link||"",onChange:u,fullWidth:!0,variant:"outlined",type:"url",helperText:"Any other relevant link (not publication or webserver)"})}),e.jsx(i,{item:!0,xs:12,sm:6,children:e.jsx(c,{id:"license",label:"License",name:"license",value:s.license||"",onChange:u,fullWidth:!0,variant:"outlined"})}),e.jsx(i,{item:!0,xs:12,children:e.jsx(N,{multiple:!0,id:"tags-filled",options:L,loading:E,value:s.tags||[],onChange:w,freeSolo:!0,renderTags:(a,t)=>a.map((r,g)=>e.jsx(B,{variant:"outlined",label:r,...t({index:g})})),renderInput:a=>e.jsx(c,{...a,id:"tags-input",name:"tags",variant:"outlined",label:"Tags",placeholder:"Add or select tags",InputProps:{...a.InputProps,endAdornment:e.jsxs($.Fragment,{children:[E?e.jsx(C,{color:"inherit",size:20}):null,a.InputProps.endAdornment]})}})})}),e.jsxs(i,{item:!0,xs:12,children:[m&&!h&&e.jsx(f,{color:"error",sx:{mb:2},children:m}),e.jsx(_,{type:"submit",variant:"contained",color:"primary",disabled:h,startIcon:h?e.jsx(C,{size:20}):null,children:h?"Saving...":"Save Changes"}),e.jsx(_,{variant:"outlined",color:"secondary",onClick:()=>x(`/package/${encodeURIComponent(o||"")}`),sx:{ml:2},disabled:h,children:"Cancel"})]})]})})]}):e.jsx(f,{color:"error",align:"center",children:"Access Denied. You must be an admin to edit packages."})};export{z as default};
