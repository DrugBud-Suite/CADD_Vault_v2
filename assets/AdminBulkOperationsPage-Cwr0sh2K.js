import{c as ue,j as e,n as fa,O as ja,r as i,o as $e,p as ba,a2 as $,C as Z,t as v,A as g,T as c,q as h,G as n,R as B,F as W,a4 as z,S as M,M as j,a5 as ee,N as C,m as f,a3 as N,H as O,au as We,aq as ze,I as Me,al as Ue,am as He,an as De,ao as ae,ap as u,ar as Re}from"./index-BuzR7-x9.js";import{DataService as q}from"./dataService-DS_ZZmmk.js";import{T as ya,a as he}from"./Tabs-CnI27qHK.js";import{F as va,C as Le}from"./FolderOutlined-C7vuIB3C.js";const _e=ue(e.jsx("path",{d:"M13 7h-2v4H7v2h4v4h2v-4h4v-2h-4zm-1-5C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8"}),"AddCircleOutline"),Be=ue(e.jsx("path",{d:"M19 9h-4V3H9v6H5l7 7zM5 18v2h14v-2z"}),"FileDownload"),qe=ue(e.jsx("path",{d:"M20 6h-8l-2-2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2m0 12H4V6h5.17l2 2H20zm-6.92-3.96L12.39 17 15 15.47 17.61 17l-.69-2.96 2.3-1.99-3.03-.26L15 9l-1.19 2.79-3.03.26z"}),"FolderSpecialOutlined"),ka=()=>{var Ie;const{currentUser:Ye,loading:Je,isAdmin:U}=fa(),m=ja(),[S,Ve]=i.useState(0),[r,b]=i.useState({operation:"update",filterOptions:{folder:null,category:null,tags:[]},bulkOperations:{setFolder:null,setCategory:null,addTags:[],removeTags:[]}}),[d,Y]=i.useState({newFolder:"",selectedFolder:"",newCategory:""}),[o,J]=i.useState({oldTag:"",newTag:""}),[te,xe]=i.useState(!1),[H,pe]=i.useState(!1),[me,D]=i.useState(null),[fe,je]=i.useState(null),[be,R]=i.useState(null),[ye,ve]=i.useState(null),[se,re]=i.useState(!1),[Ce,p]=i.useState(null),[Te,le]=i.useState(null),[ne,V]=i.useState(0),[P,G]=i.useState([]),[ie,we]=i.useState(!1),[K,oe]=i.useState(!1),[de,Fe]=i.useState(!1),[ke,T]=i.useState(null),[Oe,Se]=i.useState(null),[L,ce]=i.useState(null),[y,Pe]=i.useState([]),[Q,Ae]=i.useState(!1),[Ge,_]=i.useState(!1),{allAvailableTags:w,allAvailableFolders:A,allAvailableCategories:I}=$e(ba(a=>({allAvailableTags:a.allAvailableTags,allAvailableFolders:a.allAvailableFolders,allAvailableCategories:a.allAvailableCategories}))),Ke=r.filterOptions.folder&&I[r.filterOptions.folder]?I[r.filterOptions.folder]:[],Ee=i.useCallback(async()=>{Ae(!0),_(!0),T(null);try{let a=$.from("packages").select("*");r.filterOptions.folder&&(a=a.eq("folder1",r.filterOptions.folder)),r.filterOptions.folder&&r.filterOptions.category&&(a=a.eq("category1",r.filterOptions.category)),a=q.applyTagFilters(a,r.filterOptions.tags,"AND");const{data:t,error:s}=await a;if(s)throw s;Pe(t||[])}catch(a){console.error("Error fetching matching packages:",a),T(`Failed to load matching packages: ${a.message}`),Pe([])}finally{Ae(!1)}},[r.filterOptions]),Qe=i.useCallback(async()=>{if(!o.oldTag.trim()){p("Please select a tag to preview affected packages.");return}we(!0),oe(!0),p(null);try{const a=await q.fetchPackagesWithTag(o.oldTag.trim());G(a),V(a.length),a.length===0&&p(`No packages found with tag "${o.oldTag.trim()}".`)}catch(a){console.error("Error fetching packages with tag:",a),p(`Failed to load packages with tag: ${a.message}`),G([])}finally{we(!1)}},[o.oldTag]),Xe=a=>{b(t=>({...t,operation:a.target.value})),_(!1)},Ze=a=>{const t=a.target.value==="null"?null:a.target.value;b(s=>({...s,filterOptions:{...s.filterOptions,folder:t,category:null}})),_(!1)},ea=a=>{const t=a.target.value==="null"?null:a.target.value;b(s=>({...s,filterOptions:{...s.filterOptions,category:t}})),_(!1)},aa=(a,t)=>{b(s=>({...s,filterOptions:{...s.filterOptions,tags:t}})),_(!1)},ta=a=>{const t=a.target.value==="null"?null:a.target.value;b(s=>({...s,bulkOperations:{...s.bulkOperations,setFolder:t,setCategory:null}}))},sa=a=>{const t=a.target.value==="null"?null:a.target.value;b(s=>({...s,bulkOperations:{...s.bulkOperations,setCategory:t}}))},ra=(a,t)=>{b(s=>({...s,bulkOperations:{...s.bulkOperations,addTags:t}}))},la=(a,t)=>{b(s=>({...s,bulkOperations:{...s.bulkOperations,removeTags:t}}))},na=(a,t)=>{Ve(t)},Ne=a=>{const{name:t,value:s}=a.target;Y(l=>({...l,[t]:s}))},ia=a=>{const{name:t,value:s}=a.target;J(l=>({...l,[t]:s}))},oa=(a,t)=>{t&&(J(s=>({...s,oldTag:t})),oe(!1),G([]))},da=async()=>{if(!U){p("You must be an admin to perform this operation.");return}if(!o.oldTag.trim()){p("Please select a tag to replace.");return}if(!o.newTag.trim()){p("Please enter a new tag name.");return}re(!0),p(null),le(null),V(0);try{let a=[];if(K&&P.length>0?a=P:a=await q.fetchPackagesWithTag(o.oldTag.trim()),a.length===0){p(`No packages found with tag "${o.oldTag.trim()}".`),re(!1);return}let t=0,s=0;for(const x of a)try{const X=(x.tags||[]).map(k=>k===o.oldTag.trim()?o.newTag.trim():k),{error:F}=await $.from("packages").update({tags:X}).eq("id",x.id);if(F)throw F;t++}catch(E){console.error("Error updating package tags:",E),s++}V(t),le(`Successfully updated tag "${o.oldTag.trim()}" to "${o.newTag.trim()}" in ${t} packages.`),s>0&&p(`Failed to update tags in ${s} packages.`),J({oldTag:"",newTag:""});const l=[...w];if(l.includes(o.newTag.trim())||l.push(o.newTag.trim()),t===a.length){const x=l.indexOf(o.oldTag.trim());x!==-1&&l.splice(x,1)}$e.setState({allAvailableTags:l.sort()})}catch(a){console.error("Error updating tags:",a),p(`Failed to update tags: ${a.message}`)}finally{re(!1)}},ca=a=>{Y(t=>({...t,selectedFolder:a.target.value}))},ga=async()=>{if(!U){D("You must be an admin to create folders.");return}if(!d.newFolder.trim()){D("Please enter a folder name.");return}xe(!0),D(null),je(null);try{const{error:a}=await $.from("folders").insert({name:d.newFolder.trim()}).select().single();if(a){if(a.code==="23505")D(`Folder "${d.newFolder.trim()}" already exists.`);else throw a;return}je(`Folder "${d.newFolder.trim()}" created successfully!`),Y({...d,newFolder:""}),await q.refreshFilterMetadata()}catch(a){console.error("Error creating folder:",a),D(`Failed to create folder: ${a.message}`)}finally{xe(!1)}},ha=async()=>{if(!U){R("You must be an admin to create categories.");return}if(!d.selectedFolder){R("Please select a folder.");return}if(!d.newCategory.trim()){R("Please enter a category name.");return}pe(!0),R(null),ve(null);try{const{error:a}=await $.rpc("ensure_folder_category_exists",{folder_name:d.selectedFolder,category_name:d.newCategory.trim()});if(a)throw a;ve(`Category "${d.newCategory.trim()}" created successfully!`),Y({...d,newCategory:""}),await q.refreshFilterMetadata()}catch(a){console.error("Error creating category:",a),R(`Failed to create category: ${a.message}`)}finally{pe(!1)}},ua=async()=>{if(!U){T("You must be an admin to perform this operation.");return}if(y.length===0){T("No packages match the current filter criteria.");return}if(!(r.bulkOperations.setFolder!==null||r.bulkOperations.setCategory!==null||r.bulkOperations.addTags.length>0||r.bulkOperations.removeTags.length>0)){T("Please specify at least one update option.");return}Fe(!0),T(null),Se(null),ce(null);try{const t=y.map(x=>x.id);let s=0,l=0;for(const x of t)try{const{data:E,error:X}=await $.from("packages").select("*").eq("id",x).single();if(X)throw X;if(!E)continue;const F={};if(r.bulkOperations.setFolder!==null&&(F.folder1=r.bulkOperations.setFolder),r.bulkOperations.setCategory!==null&&(F.category1=r.bulkOperations.setCategory),r.bulkOperations.addTags.length>0||r.bulkOperations.removeTags.length>0){const k=E.tags||[],pa=r.bulkOperations.addTags.filter(ge=>!k.includes(ge)),ma=k.filter(ge=>!r.bulkOperations.removeTags.includes(ge));F.tags=[...ma,...pa]}if(Object.keys(F).length>0){const{error:k}=await $.from("packages").update(F).eq("id",x);if(k)throw k;s++}}catch(E){console.error("Error updating package:",E),l++}ce({status:l>0?s>0?"warning":"error":"success",message:`Operation completed with ${s} packages updated successfully${l>0?` and ${l} errors`:""}.`,affectedPackages:s}),Se(`Successfully updated ${s} packages.`),l>0&&T(`Failed to update ${l} packages.`),await Ee()}catch(t){console.error("Error executing bulk operation:",t),T(`Failed to execute operation: ${t.message}`),ce({status:"error",message:`Operation failed: ${t.message}`,affectedPackages:0})}finally{Fe(!1)}},xa=()=>{if(y.length===0)return;const a=JSON.stringify(y,null,2),t="data:application/json;charset=utf-8,"+encodeURIComponent(a),s=`cadd-vault-packages-${new Date().toISOString()}.json`,l=document.createElement("a");l.setAttribute("href",t),l.setAttribute("download",s),l.click()};return Je?e.jsx(Z,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"80vh"},children:e.jsx(v,{})}):Ye?U?e.jsxs(Z,{sx:{py:4},children:[e.jsx(c,{variant:"h4",component:"h1",gutterBottom:!0,sx:{fontWeight:"bold"},children:"Database Administration"}),e.jsx(c,{variant:"subtitle1",color:"text.secondary",gutterBottom:!0,children:"Manage database entries and structure."}),e.jsx(h,{sx:{borderBottom:1,borderColor:"divider",mb:2},children:e.jsxs(ya,{value:S,onChange:na,"aria-label":"admin operations tabs",children:[e.jsx(he,{label:"Bulk Updates",id:"admin-tab-0","aria-controls":"admin-tabpanel-0"}),e.jsx(he,{label:"Folder & Category Management",id:"admin-tab-1","aria-controls":"admin-tabpanel-1"}),e.jsx(he,{label:"Tag Management",id:"admin-tab-2","aria-controls":"admin-tabpanel-2"})]})}),e.jsx("div",{role:"tabpanel",hidden:S!==0,id:"admin-tabpanel-0","aria-labelledby":"admin-tab-0",children:S===0&&e.jsxs(n,{container:!0,spacing:3,children:[e.jsx(n,{item:!0,xs:12,children:e.jsxs(B,{elevation:3,sx:{p:3,mt:2},children:[e.jsx(c,{variant:"h6",gutterBottom:!0,children:"Operation Settings"}),e.jsxs(W,{fullWidth:!0,sx:{mb:3},children:[e.jsx(z,{children:"Operation Type"}),e.jsx(M,{value:r.operation,onChange:Xe,label:"Operation Type",children:e.jsx(j,{value:"update",children:"Update Packages"})})]}),e.jsxs(h,{sx:{mb:4},children:[e.jsxs(c,{variant:"subtitle1",sx:{mb:2,display:"flex",alignItems:"center"},children:[e.jsx(va,{sx:{mr:1}}),"Filter Criteria"]}),e.jsx(g,{severity:"info",sx:{mb:2},children:"Define which packages will be affected by this operation."}),e.jsxs(n,{container:!0,spacing:2,children:[e.jsx(n,{item:!0,xs:12,sm:6,children:e.jsxs(W,{fullWidth:!0,children:[e.jsx(z,{children:"Folder"}),e.jsxs(M,{value:r.filterOptions.folder||"null",onChange:Ze,label:"Folder",children:[e.jsx(j,{value:"null",children:"Any Folder"}),A.map(a=>e.jsx(j,{value:a,children:a},a))]})]})}),e.jsx(n,{item:!0,xs:12,sm:6,children:e.jsxs(W,{fullWidth:!0,disabled:!r.filterOptions.folder,children:[e.jsx(z,{children:"Category"}),e.jsxs(M,{value:r.filterOptions.category||"null",onChange:ea,label:"Category",children:[e.jsx(j,{value:"null",children:"Any Category"}),Ke.map(a=>e.jsx(j,{value:a,children:a},a))]})]})}),e.jsx(n,{item:!0,xs:12,children:e.jsx(ee,{multiple:!0,id:"filter-tags",options:w,value:r.filterOptions.tags,onChange:aa,renderInput:a=>e.jsx(N,{...a,label:"Has Tags",placeholder:"Select tags to filter by",helperText:"Only packages having ALL selected tags will be affected"}),renderTags:(a,t)=>a.map((s,l)=>e.jsx(C,{variant:"outlined",label:s,...t({index:l}),sx:{bgcolor:f(m.palette.primary.main,.1),borderColor:f(m.palette.primary.main,.3)}}))})})]})]}),e.jsx(O,{variant:"outlined",color:"primary",onClick:Ee,disabled:Q,sx:{mb:4},children:Q?e.jsx(v,{size:24}):"Preview Matching Packages"}),e.jsx(We,{sx:{mb:4}}),e.jsxs(h,{sx:{mb:4},children:[e.jsxs(c,{variant:"subtitle1",sx:{mb:2,display:"flex",alignItems:"center"},children:[e.jsx(Le,{sx:{mr:1}}),"Update Options"]}),e.jsx(g,{severity:"warning",sx:{mb:2},children:"Specify the changes to apply to all matching packages."}),e.jsxs(n,{container:!0,spacing:2,children:[e.jsx(n,{item:!0,xs:12,sm:6,children:e.jsxs(W,{fullWidth:!0,children:[e.jsx(z,{children:"Change Folder To"}),e.jsxs(M,{value:r.bulkOperations.setFolder||"null",onChange:ta,label:"Change Folder To",children:[e.jsx(j,{value:"null",children:"No Change"}),A.map(a=>e.jsx(j,{value:a,children:a},a))]})]})}),e.jsx(n,{item:!0,xs:12,sm:6,children:e.jsxs(W,{fullWidth:!0,children:[e.jsx(z,{children:"Change Category To"}),e.jsxs(M,{value:r.bulkOperations.setCategory||"null",onChange:sa,label:"Change Category To",children:[e.jsx(j,{value:"null",children:"No Change"}),Object.values(I).flat().filter((a,t,s)=>s.indexOf(a)===t).sort().map(a=>e.jsx(j,{value:a,children:a},a))]})]})}),e.jsx(n,{item:!0,xs:12,sm:6,children:e.jsx(ee,{multiple:!0,id:"add-tags",options:w.filter(a=>!r.bulkOperations.addTags.includes(a)),value:r.bulkOperations.addTags,onChange:ra,renderInput:a=>e.jsx(N,{...a,label:"Add Tags",placeholder:"Select tags to add",helperText:"These tags will be added to all matching packages"}),renderTags:(a,t)=>a.map((s,l)=>e.jsx(C,{variant:"outlined",label:s,...t({index:l}),sx:{bgcolor:f(m.palette.success.main,.1),borderColor:f(m.palette.success.main,.3)}}))})}),e.jsx(n,{item:!0,xs:12,sm:6,children:e.jsx(ee,{multiple:!0,id:"remove-tags",options:w.filter(a=>!r.bulkOperations.removeTags.includes(a)),value:r.bulkOperations.removeTags,onChange:la,renderInput:a=>e.jsx(N,{...a,label:"Remove Tags",placeholder:"Select tags to remove",helperText:"These tags will be removed from all matching packages"}),renderTags:(a,t)=>a.map((s,l)=>e.jsx(C,{variant:"outlined",label:s,...t({index:l}),sx:{bgcolor:f(m.palette.error.main,.1),borderColor:f(m.palette.error.main,.3)}}))})})]})]}),ke&&e.jsx(g,{severity:"error",sx:{mb:2},children:ke}),Oe&&e.jsx(g,{severity:"success",sx:{mb:2},children:Oe}),L&&e.jsxs(g,{severity:L.status,sx:{mb:2},children:[L.message,L.details&&e.jsx(c,{variant:"body2",mt:1,children:L.details})]}),e.jsx(O,{variant:"contained",color:"primary",disabled:de||y.length===0,onClick:ua,sx:{mr:2},children:de?e.jsx(v,{size:24}):"Execute Operation"}),e.jsx(O,{variant:"outlined",color:"secondary",onClick:()=>b({operation:"update",filterOptions:{folder:null,category:null,tags:[]},bulkOperations:{setFolder:null,setCategory:null,addTags:[],removeTags:[]}}),disabled:de,children:"Reset Form"})]})}),Ge&&e.jsx(n,{item:!0,xs:12,children:e.jsxs(B,{elevation:3,sx:{p:3,mt:2},children:[e.jsxs(h,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(c,{variant:"h6",children:Q?"Loading Matching Packages...":`Matching Packages (${y.length})`}),y.length>0&&e.jsx(ze,{title:"Download as JSON",children:e.jsx(Me,{onClick:xa,color:"primary",children:e.jsx(Be,{})})})]}),Q?e.jsx(h,{sx:{display:"flex",justifyContent:"center",p:4},children:e.jsx(v,{})}):y.length===0?e.jsx(g,{severity:"info",children:"No packages match the selected filter criteria."}):e.jsx(Ue,{sx:{maxHeight:400},children:e.jsxs(He,{stickyHeader:!0,children:[e.jsx(De,{children:e.jsxs(ae,{children:[e.jsx(u,{sx:{fontWeight:"bold"},children:"Package Name"}),e.jsx(u,{sx:{fontWeight:"bold"},children:"Folder"}),e.jsx(u,{sx:{fontWeight:"bold"},children:"Category"}),e.jsx(u,{sx:{fontWeight:"bold"},children:"Tags"})]})}),e.jsx(Re,{children:y.map(a=>{var t,s,l;return e.jsxs(ae,{hover:!0,children:[e.jsx(u,{children:a.package_name}),e.jsx(u,{children:a.folder1||"—"}),e.jsx(u,{children:a.category1||"—"}),e.jsx(u,{children:e.jsxs(h,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:[(t=a.tags)==null?void 0:t.slice(0,5).map(x=>e.jsx(C,{label:x,size:"small",sx:{fontSize:"0.75rem",height:22}},x)),(((s=a.tags)==null?void 0:s.length)||0)>5&&e.jsx(C,{label:`+${(((l=a.tags)==null?void 0:l.length)||0)-5} more`,size:"small",variant:"outlined",sx:{fontSize:"0.75rem",height:22}}),(!a.tags||a.tags.length===0)&&e.jsx(c,{variant:"body2",color:"text.secondary",children:"No tags"})]})})]},a.id)})})]})})]})})]})}),e.jsx("div",{role:"tabpanel",hidden:S!==2,id:"admin-tabpanel-2","aria-labelledby":"admin-tab-2",children:S===2&&e.jsx(n,{container:!0,spacing:3,children:e.jsx(n,{item:!0,xs:12,children:e.jsxs(B,{elevation:3,sx:{p:3},children:[e.jsxs(c,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center"},children:[e.jsx(qe,{sx:{mr:1}}),"Tag Management"]}),e.jsx(g,{severity:"info",sx:{mb:3},children:"Find and correct tags with typos. Changes will be applied to all packages that have the selected tag."}),Ce&&e.jsx(g,{severity:"error",sx:{mb:2},children:Ce}),Te&&e.jsx(g,{severity:"success",sx:{mb:2},children:Te}),e.jsxs(n,{container:!0,spacing:2,sx:{mb:3},children:[e.jsx(n,{item:!0,xs:12,sm:6,children:e.jsx(ee,{options:w,value:o.oldTag,onChange:(a,t)=>oa(a,t),renderInput:a=>e.jsx(N,{...a,label:"Tag to Replace",name:"oldTag",fullWidth:!0,helperText:"Select the tag that has a typo or needs to be renamed"})})}),e.jsx(n,{item:!0,xs:12,sm:6,children:e.jsx(N,{label:"New Tag Name",name:"newTag",value:o.newTag,onChange:ia,fullWidth:!0,helperText:"Enter the corrected tag name"})})]}),e.jsxs(h,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(O,{variant:"outlined",color:"primary",onClick:Qe,disabled:ie||!o.oldTag,children:ie?e.jsx(v,{size:24}):"Preview Affected Packages"}),!K&&o.oldTag&&e.jsx(c,{variant:"body2",sx:{alignSelf:"center",fontStyle:"italic"},children:"Click to see which packages will be affected"})]}),e.jsxs(h,{sx:{display:"flex",gap:2},children:[e.jsx(O,{variant:"contained",color:"primary",onClick:da,disabled:se||!o.oldTag||!o.newTag||ne===0,sx:{mr:2},children:se?e.jsx(v,{size:24}):"Update Tag"}),e.jsx(O,{variant:"outlined",color:"secondary",onClick:()=>{J({oldTag:"",newTag:""}),p(null),le(null),oe(!1),G([]),V(0)},disabled:se,children:"Reset Form"})]}),ne>0&&!K&&e.jsx(h,{sx:{mt:3},children:e.jsxs(c,{variant:"subtitle2",children:["Tags updated in ",ne," packages"]})}),e.jsx(We,{sx:{my:3}}),e.jsxs(c,{variant:"subtitle1",sx:{mb:2},children:["Available Tags (",w.length,")"]}),e.jsx(h,{sx:{maxHeight:200,overflowY:"auto",border:1,borderColor:"divider",borderRadius:1,p:1},children:w.length>0?e.jsx(h,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:w.map(a=>e.jsx(C,{label:a,size:"small",sx:{bgcolor:f(m.palette.primary.main,.1)}},a))}):e.jsx(c,{variant:"body2",color:"text.secondary",children:"No tags available"})}),K&&e.jsxs(h,{sx:{mt:3},children:[e.jsxs(c,{variant:"subtitle1",sx:{mb:2,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("span",{children:['Packages With Tag "',o.oldTag,'" (',P.length,")"]}),P.length>0&&e.jsx(ze,{title:"Download as JSON",children:e.jsx(Me,{size:"small",onClick:()=>{const a=JSON.stringify(P,null,2),t="data:application/json;charset=utf-8,"+encodeURIComponent(a),s=`packages-with-tag-${o.oldTag}-${new Date().toISOString()}.json`,l=document.createElement("a");l.setAttribute("href",t),l.setAttribute("download",s),l.click()},children:e.jsx(Be,{})})})]}),ie?e.jsx(h,{sx:{display:"flex",justifyContent:"center",p:3},children:e.jsx(v,{})}):P.length===0?e.jsx(g,{severity:"info",children:"No packages found with this tag."}):e.jsx(Ue,{sx:{maxHeight:400},children:e.jsxs(He,{stickyHeader:!0,size:"small",children:[e.jsx(De,{children:e.jsxs(ae,{children:[e.jsx(u,{children:"Package Name"}),e.jsx(u,{children:"Folder"}),e.jsx(u,{children:"Category"}),e.jsx(u,{children:"Tags"})]})}),e.jsx(Re,{children:P.map(a=>e.jsxs(ae,{hover:!0,children:[e.jsx(u,{children:a.package_name}),e.jsx(u,{children:a.folder1||"None"}),e.jsx(u,{children:a.category1||"None"}),e.jsx(u,{children:e.jsxs(h,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:[a.tags&&a.tags.map(t=>e.jsx(C,{label:t,size:"small",sx:{bgcolor:t===o.oldTag?f(m.palette.warning.main,.2):f(m.palette.primary.main,.1),fontWeight:t===o.oldTag?"bold":"normal",height:22}},`${a.id}-${t}`)),(!a.tags||a.tags.length===0)&&e.jsx(c,{variant:"body2",color:"text.secondary",children:"No tags"})]})})]},a.id))})]})})]})]})})})}),e.jsx("div",{role:"tabpanel",hidden:S!==1,id:"admin-tabpanel-1","aria-labelledby":"admin-tab-1",children:S===1&&e.jsxs(n,{container:!0,spacing:3,children:[e.jsx(n,{item:!0,xs:12,md:6,children:e.jsxs(B,{elevation:3,sx:{p:3},children:[e.jsxs(c,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center"},children:[e.jsx(qe,{sx:{mr:1}}),"Create New Folder"]}),e.jsx(g,{severity:"info",sx:{mb:3},children:"Add a new top-level folder to organize packages. Folders are the main classification groups."}),me&&e.jsx(g,{severity:"error",sx:{mb:2},children:me}),fe&&e.jsx(g,{severity:"success",sx:{mb:2},children:fe}),e.jsxs(n,{container:!0,spacing:2,children:[e.jsx(n,{item:!0,xs:12,children:e.jsx(N,{fullWidth:!0,label:"New Folder Name",name:"newFolder",value:d.newFolder,onChange:Ne,placeholder:"Enter folder name",helperText:"This will create a new folder in the database"})}),e.jsx(n,{item:!0,xs:12,children:e.jsx(O,{variant:"contained",color:"primary",onClick:ga,disabled:te||!d.newFolder.trim(),startIcon:te?e.jsx(v,{size:20}):e.jsx(_e,{}),fullWidth:!0,children:te?"Creating...":"Create Folder"})})]}),e.jsxs(c,{variant:"subtitle2",sx:{mt:3,mb:1},children:["Existing Folders (",A.length,")"]}),e.jsx(h,{sx:{maxHeight:200,overflowY:"auto",border:1,borderColor:"divider",borderRadius:1,p:1},children:A.length>0?e.jsx(h,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:A.map(a=>e.jsx(C,{label:a,variant:"outlined",size:"small",sx:{bgcolor:f(m.palette.primary.main,.05)}},a))}):e.jsx(c,{variant:"body2",color:"text.secondary",children:"No folders defined yet."})})]})}),e.jsx(n,{item:!0,xs:12,md:6,children:e.jsxs(B,{elevation:3,sx:{p:3},children:[e.jsxs(c,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center"},children:[e.jsx(Le,{sx:{mr:1}}),"Create New Category"]}),e.jsx(g,{severity:"info",sx:{mb:3},children:"Add a new category within an existing folder. Categories are subgroups of folders."}),be&&e.jsx(g,{severity:"error",sx:{mb:2},children:be}),ye&&e.jsx(g,{severity:"success",sx:{mb:2},children:ye}),e.jsxs(n,{container:!0,spacing:2,children:[e.jsx(n,{item:!0,xs:12,children:e.jsxs(W,{fullWidth:!0,children:[e.jsx(z,{children:"Select Folder"}),e.jsx(M,{value:d.selectedFolder,onChange:ca,label:"Select Folder",disabled:H||A.length===0,children:A.map(a=>e.jsx(j,{value:a,children:a},a))})]})}),e.jsx(n,{item:!0,xs:12,children:e.jsx(N,{fullWidth:!0,label:"New Category Name",name:"newCategory",value:d.newCategory,onChange:Ne,placeholder:"Enter category name",helperText:"This will create a new category within the selected folder",disabled:!d.selectedFolder||H})}),e.jsx(n,{item:!0,xs:12,children:e.jsx(O,{variant:"contained",color:"primary",onClick:ha,disabled:H||!d.selectedFolder||!d.newCategory.trim(),startIcon:H?e.jsx(v,{size:20}):e.jsx(_e,{}),fullWidth:!0,children:H?"Creating...":"Create Category"})})]}),d.selectedFolder&&e.jsxs(e.Fragment,{children:[e.jsxs(c,{variant:"subtitle2",sx:{mt:3,mb:1},children:['Existing Categories in "',d.selectedFolder,'" (',(I[d.selectedFolder]||[]).length,")"]}),e.jsx(h,{sx:{maxHeight:200,overflowY:"auto",border:1,borderColor:"divider",borderRadius:1,p:1},children:((Ie=I[d.selectedFolder])==null?void 0:Ie.length)>0?e.jsx(h,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:I[d.selectedFolder].map(a=>e.jsx(C,{label:a,variant:"outlined",size:"small",sx:{bgcolor:f(m.palette.secondary.main,.05)}},a))}):e.jsx(c,{variant:"body2",color:"text.secondary",children:"No categories defined in this folder yet."})})]})]})})]})})]}):e.jsx(Z,{sx:{py:4},children:e.jsx(g,{severity:"error",children:"Access Denied. This page is for administrators only."})}):e.jsx(Z,{sx:{py:4},children:e.jsx(g,{severity:"error",children:"You must be logged in to access this page."})})};export{ka as default};
