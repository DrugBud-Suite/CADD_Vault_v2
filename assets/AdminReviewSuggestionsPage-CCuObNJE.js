import{r as i,a7 as qe,a8 as He,a9 as de,aa as le,j as e,ab as Fe,b as E,ac as he,g as De,a as Me,d as Le,_ as ue,s as Y,f as Ue,i as Oe,U as Pe,k as Be,O as $e,ad as We,ae as Ne,h as J,x as M,y as L,z as O,D as P,Q as Ve,R as Qe,t as A,p as ce,q as fe,C as me,A as ve,T as xe,af as Ge,ag as Xe,ah as Ke,ai as ge,aj as g,ak as Je,N as Ye,al as H,I as F,am as Ze,$ as et,a0 as tt,a1 as rt,a3 as nt,a2 as at,H as je}from"./index-Cq7ylKjH.js";import{E as ot}from"./Edit-DVMTPvis.js";import{T as st,a as X}from"./Tabs-B-NwkQH0.js";import{D as it}from"./DialogContentText-2jpNmSeu.js";function be(n){return n.substring(2).toLowerCase()}function lt(n,r){return r.documentElement.clientWidth<n.clientX||r.documentElement.clientHeight<n.clientY}function ct(n){const{children:r,disableReactTree:a=!1,mouseEvent:o="onClick",onClickAway:m,touchEvent:v="onTouchEnd"}=n,b=i.useRef(!1),j=i.useRef(null),p=i.useRef(!1),u=i.useRef(!1);i.useEffect(()=>(setTimeout(()=>{p.current=!0},0),()=>{p.current=!1}),[]);const x=qe(He(r),j),c=de(d=>{const h=u.current;u.current=!1;const _=le(j.current);if(!p.current||!j.current||"clientX"in d&&lt(d,_))return;if(b.current){b.current=!1;return}let s;d.composedPath?s=d.composedPath().indexOf(j.current)>-1:s=!_.documentElement.contains(d.target)||j.current.contains(d.target),!s&&(a||!h)&&m(d)}),w=d=>h=>{u.current=!0;const _=r.props[d];_&&_(h)},C={ref:x};return v!==!1&&(C[v]=w(v)),i.useEffect(()=>{if(v!==!1){const d=be(v),h=le(j.current),_=()=>{b.current=!0};return h.addEventListener(d,c),h.addEventListener("touchmove",_),()=>{h.removeEventListener(d,c),h.removeEventListener("touchmove",_)}}},[c,v]),o!==!1&&(C[o]=w(o)),i.useEffect(()=>{if(o!==!1){const d=be(o),h=le(j.current);return h.addEventListener(d,c),()=>{h.removeEventListener(d,c)}}},[c,o]),e.jsx(i.Fragment,{children:i.cloneElement(r,C)})}function dt(n={}){const{autoHideDuration:r=null,disableWindowBlurListener:a=!1,onClose:o,open:m,resumeHideDuration:v}=n,b=Fe();i.useEffect(()=>{if(!m)return;function s(l){l.defaultPrevented||(l.key==="Escape"||l.key==="Esc")&&(o==null||o(l,"escapeKeyDown"))}return document.addEventListener("keydown",s),()=>{document.removeEventListener("keydown",s)}},[m,o]);const j=de((s,l)=>{o==null||o(s,l)}),p=de(s=>{!o||s==null||b.start(s,()=>{j(null,"timeout")})});i.useEffect(()=>(m&&p(r),b.clear),[m,r,p,b]);const u=s=>{o==null||o(s,"clickaway")},x=b.clear,c=i.useCallback(()=>{r!=null&&p(v??r*.5)},[r,v,p]),w=s=>l=>{const f=s.onBlur;f==null||f(l),c()},C=s=>l=>{const f=s.onFocus;f==null||f(l),x()},d=s=>l=>{const f=s.onMouseEnter;f==null||f(l),x()},h=s=>l=>{const f=s.onMouseLeave;f==null||f(l),c()};return i.useEffect(()=>{if(!a&&m)return window.addEventListener("focus",c),window.addEventListener("blur",x),()=>{window.removeEventListener("focus",c),window.removeEventListener("blur",x)}},[a,m,c,x]),{getRootProps:(s={})=>{const l=E({},he(n),he(s));return E({role:"presentation"},s,l,{onBlur:w(l),onFocus:C(l),onMouseEnter:d(l),onMouseLeave:h(l)})},onClickAway:u}}function ut(n){return De("MuiSnackbarContent",n)}Me("MuiSnackbarContent",["root","message","action"]);const pt=["action","className","message","role"],ht=n=>{const{classes:r}=n;return Oe({root:["root"],action:["action"],message:["message"]},ut,r)},ft=Y(Pe,{name:"MuiSnackbarContent",slot:"Root",overridesResolver:(n,r)=>r.root})(({theme:n})=>{const r=n.palette.mode==="light"?.8:.98,a=Be.emphasize(n.palette.background.default,r);return E({},n.typography.body2,{color:n.vars?n.vars.palette.SnackbarContent.color:n.palette.getContrastText(a),backgroundColor:n.vars?n.vars.palette.SnackbarContent.bg:a,display:"flex",alignItems:"center",flexWrap:"wrap",padding:"6px 16px",borderRadius:(n.vars||n).shape.borderRadius,flexGrow:1,[n.breakpoints.up("sm")]:{flexGrow:"initial",minWidth:288}})}),mt=Y("div",{name:"MuiSnackbarContent",slot:"Message",overridesResolver:(n,r)=>r.message})({padding:"8px 0"}),vt=Y("div",{name:"MuiSnackbarContent",slot:"Action",overridesResolver:(n,r)=>r.action})({display:"flex",alignItems:"center",marginLeft:"auto",paddingLeft:16,marginRight:-8}),xt=i.forwardRef(function(r,a){const o=Le({props:r,name:"MuiSnackbarContent"}),{action:m,className:v,message:b,role:j="alert"}=o,p=ue(o,pt),u=o,x=ht(u);return e.jsxs(ft,E({role:j,square:!0,elevation:6,className:Ue(x.root,v),ownerState:u,ref:a},p,{children:[e.jsx(mt,{className:x.message,ownerState:u,children:b}),m?e.jsx(vt,{className:x.action,ownerState:u,children:m}):null]}))});function gt(n){return De("MuiSnackbar",n)}Me("MuiSnackbar",["root","anchorOriginTopCenter","anchorOriginBottomCenter","anchorOriginTopRight","anchorOriginBottomRight","anchorOriginTopLeft","anchorOriginBottomLeft"]);const jt=["onEnter","onExited"],bt=["action","anchorOrigin","autoHideDuration","children","className","ClickAwayListenerProps","ContentProps","disableWindowBlurListener","message","onBlur","onClose","onFocus","onMouseEnter","onMouseLeave","open","resumeHideDuration","TransitionComponent","transitionDuration","TransitionProps"],Ct=n=>{const{classes:r,anchorOrigin:a}=n,o={root:["root",`anchorOrigin${J(a.vertical)}${J(a.horizontal)}`]};return Oe(o,gt,r)},Ce=Y("div",{name:"MuiSnackbar",slot:"Root",overridesResolver:(n,r)=>{const{ownerState:a}=n;return[r.root,r[`anchorOrigin${J(a.anchorOrigin.vertical)}${J(a.anchorOrigin.horizontal)}`]]}})(({theme:n,ownerState:r})=>{const a={left:"50%",right:"auto",transform:"translateX(-50%)"};return E({zIndex:(n.vars||n).zIndex.snackbar,position:"fixed",display:"flex",left:8,right:8,justifyContent:"center",alignItems:"center"},r.anchorOrigin.vertical==="top"?{top:8}:{bottom:8},r.anchorOrigin.horizontal==="left"&&{justifyContent:"flex-start"},r.anchorOrigin.horizontal==="right"&&{justifyContent:"flex-end"},{[n.breakpoints.up("sm")]:E({},r.anchorOrigin.vertical==="top"?{top:24}:{bottom:24},r.anchorOrigin.horizontal==="center"&&a,r.anchorOrigin.horizontal==="left"&&{left:24,right:"auto"},r.anchorOrigin.horizontal==="right"&&{right:24,left:"auto"})})}),kt=i.forwardRef(function(r,a){const o=Le({props:r,name:"MuiSnackbar"}),m=$e(),v={enter:m.transitions.duration.enteringScreen,exit:m.transitions.duration.leavingScreen},{action:b,anchorOrigin:{vertical:j,horizontal:p}={vertical:"bottom",horizontal:"left"},autoHideDuration:u=null,children:x,className:c,ClickAwayListenerProps:w,ContentProps:C,disableWindowBlurListener:d=!1,message:h,open:_,TransitionComponent:s=We,transitionDuration:l=v,TransitionProps:{onEnter:f,onExited:z}={}}=o,I=ue(o.TransitionProps,jt),Z=ue(o,bt),D=E({},o,{anchorOrigin:{vertical:j,horizontal:p},autoHideDuration:u,disableWindowBlurListener:d,TransitionComponent:s,transitionDuration:l}),R=Ct(D),{getRootProps:ee,onClickAway:T}=dt(E({},D)),[te,G]=i.useState(!0),re=Ne({elementType:Ce,getSlotProps:ee,externalForwardedProps:Z,ownerState:D,additionalProps:{ref:a},className:[R.root,c]}),ne=q=>{G(!0),z&&z(q)},ae=(q,oe)=>{G(!1),f&&f(q,oe)};return!_&&te?null:e.jsx(ct,E({onClickAway:T},w,{children:e.jsx(Ce,E({},re,{children:e.jsx(s,E({appear:!0,in:_,timeout:l,direction:j==="top"?"down":"up",onEnter:ae,onExited:ne},I,{children:x||e.jsx(xt,E({message:h,action:b},C))}))}))}))});var U={},ke;function yt(){if(ke)return U;ke=1;var n=M();Object.defineProperty(U,"__esModule",{value:!0}),U.default=void 0;var r=n(L()),a=O();return U.default=(0,r.default)((0,a.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m-2 15-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8z"}),"CheckCircle"),U}var _t=yt();const St=P(_t);var B={},ye;function Et(){if(ye)return B;ye=1;var n=M();Object.defineProperty(B,"__esModule",{value:!0}),B.default=void 0;var r=n(L()),a=O();return B.default=(0,r.default)((0,a.jsx)("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2m5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12z"}),"Cancel"),B}var Rt=Et();const _e=P(Rt);var $={},Se;function wt(){if(Se)return $;Se=1;var n=M();Object.defineProperty($,"__esModule",{value:!0}),$.default=void 0;var r=n(L()),a=O();return $.default=(0,r.default)((0,a.jsx)("path",{d:"M11 18h2v-2h-2zm1-16C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8m0-14c-2.21 0-4 1.79-4 4h2c0-1.1.9-2 2-2s2 .9 2 2c0 2-3 1.75-3 5h2c0-2.25 3-2.5 3-5 0-2.21-1.79-4-4-4"}),"HelpOutline"),$}var Tt=wt();const Dt=P(Tt);var W={},Ee;function Mt(){if(Ee)return W;Ee=1;var n=M();Object.defineProperty(W,"__esModule",{value:!0}),W.default=void 0;var r=n(L()),a=O();return W.default=(0,r.default)((0,a.jsx)("path",{d:"M1 21h4V9H1zm22-11c0-1.1-.9-2-2-2h-6.31l.95-4.57.03-.32c0-.41-.17-.79-.44-1.06L14.17 1 7.59 7.59C7.22 7.95 7 8.45 7 9v10c0 1.1.9 2 2 2h9c.83 0 1.54-.5 1.84-1.22l3.02-7.05c.09-.23.14-.47.14-.73z"}),"ThumbUp"),W}var Lt=Mt();const Ot=P(Lt);var N={},Re;function Pt(){if(Re)return N;Re=1;var n=M();Object.defineProperty(N,"__esModule",{value:!0}),N.default=void 0;var r=n(L()),a=O();return N.default=(0,r.default)((0,a.jsx)("path",{d:"M15 3H6c-.83 0-1.54.5-1.84 1.22l-3.02 7.05c-.09.23-.14.47-.14.73v2c0 1.1.9 2 2 2h6.31l-.95 4.57-.03.32c0 .41.17.79.44 1.06L9.83 23l6.59-6.59c.36-.36.58-.86.58-1.41V5c0-1.1-.9-2-2-2m4 0v12h4V3z"}),"ThumbDown"),N}var At=Pt();const zt=P(At);var V={},we;function It(){if(we)return V;we=1;var n=M();Object.defineProperty(V,"__esModule",{value:!0}),V.default=void 0;var r=n(L()),a=O();return V.default=(0,r.default)((0,a.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zm2.46-7.12 1.41-1.41L12 12.59l2.12-2.12 1.41 1.41L13.41 14l2.12 2.12-1.41 1.41L12 15.41l-2.12 2.12-1.41-1.41L10.59 14zM15.5 4l-1-1h-5l-1 1H5v2h14V4z"}),"DeleteForever"),V}var qt=It();const Ht=P(qt);var Q={},Te;function Ft(){if(Te)return Q;Te=1;var n=M();Object.defineProperty(Q,"__esModule",{value:!0}),Q.default=void 0;var r=n(L()),a=O();return Q.default=(0,r.default)((0,a.jsx)("path",{d:"M21 3H3c-1.11 0-2 .89-2 2v12c0 1.1.89 2 2 2h5v2h8v-2h5c1.1 0 1.99-.9 1.99-2L23 5c0-1.11-.9-2-2-2m0 14H3V5h18zm-5-7v2h-3v3h-2v-3H8v-2h3V7h2v3z"}),"AddToQueue"),Q}var Ut=Ft();const Bt=P(Ut),$t=n=>{if(!n)return!1;try{const r=new URL(n);return r.protocol==="http:"||r.protocol==="https:"}catch{return!1}},K=({url:n,isRequired:r=!1})=>!n&&!r?e.jsx(Dt,{color:"disabled",fontSize:"small"}):!n&&r?e.jsx(_e,{color:"error",fontSize:"small"}):$t(n)?e.jsx(St,{color:"success",fontSize:"small"}):e.jsx(_e,{color:"error",fontSize:"small"}),Gt=()=>{const n=Ve(),{isAdmin:r,loading:a,currentUser:o}=Qe(),[m,v]=i.useState([]),[b,j]=i.useState(!0),[p,u]=i.useState(null),[x,c]=i.useState(null),[w,C]=i.useState(null),[d,h]=i.useState(null),[_,s]=i.useState(!1),[l,f]=i.useState(""),[z,I]=i.useState(null),[Z,D]=i.useState(!1),[R,ee]=i.useState("pending"),T=i.useCallback(async t=>{var k;j(!0),c(null);try{const{data:S,error:y}=await A.rpc("get_suggestions_with_user_email",{filter_status:t});if(y){console.error("Supabase RPC fetch error:",y),y.code==="42804"&&((k=y.details)!=null&&k.includes("character varying(255)"))?c(`Database function error: Email column type mismatch. Ensure 'u.email::text' is used. Original: ${y.message}`):c(`Failed to load suggestions: ${y.message}`),v([]);return}v(S||[])}catch(S){console.error("Error fetching suggestions:",S.message),c(`Failed to load suggestions: ${S.message}`),v([])}finally{j(!1)}},[]);i.useEffect(()=>{!a&&!r?n("/"):r&&T(R)},[r,a,n,T,R]);const te=async t=>{if(o){u(t);try{const{error:k}=await A.from("package_suggestions").update({status:"approved",reviewed_at:new Date().toISOString(),reviewed_by_admin_id:o.id}).eq("id",t);if(k)throw k;C("Suggestion approved!"),T(R)}catch(k){c(`Failed to approve suggestion: ${k.message}`)}finally{u(null)}}},G=async(t,k,S)=>{if(o){u(t);try{const{error:y}=await A.from("package_suggestions").update({status:k,admin_notes:S,reviewed_at:new Date().toISOString(),reviewed_by_admin_id:o.id}).eq("id",t);if(y)throw y;C(`Suggestion status updated to ${k}.`),T(R),s(!1),h(null),f("")}catch(y){c(`Failed to update suggestion status: ${y.message}`)}finally{u(null)}}},re=async t=>{if(!o)return;u(t.id),c(null),C(null);const S={id:crypto.randomUUID(),package_name:t.package_name,description:t.description||void 0,publication:t.publication_url||void 0,webserver:t.webserver_url||void 0,repo_link:t.repo_url||void 0,link:t.link_url||void 0,license:t.license||void 0,tags:t.tags||void 0,folder1:t.folder1||void 0,category1:t.category1||void 0};try{const{data:y,error:se}=await A.from("packages").insert(S).select().single();if(se)throw console.error("Error inserting into packages table:",se),se;if(y){const{error:ie}=await A.from("package_suggestions").update({status:"added",reviewed_at:new Date().toISOString(),reviewed_by_admin_id:o.id,admin_notes:t.admin_notes?`${t.admin_notes}; Added to DB.`:"Added to DB."}).eq("id",t.id);ie?(console.error("Error updating suggestion status to 'added':",ie),c(`Package added, but failed to update suggestion status: ${ie.message}`)):C(`Package "${t.package_name}" added to database and suggestion marked as 'Added'.`)}T(R)}catch(y){c(`Failed to add package directly: ${y.message}`)}finally{u(null)}},ne=async(t,k)=>{if(window.confirm(`Are you sure you want to permanently delete the suggestion for "${k}"? This action cannot be undone.`)){u(t),c(null),C(null);try{const{error:S}=await A.from("package_suggestions").delete().eq("id",t);if(S)throw S;C(`Suggestion "${k}" deleted successfully.`),T(R)}catch(S){c(`Failed to delete suggestion: ${S.message}`)}finally{u(null)}}},ae=t=>{I(t),D(!0)},q=()=>{I(null),D(!1)},oe=()=>{T(R),D(!1),I(null),C("Suggestion updated successfully.")},Ae=t=>{h(t),f(t.admin_notes||""),s(!0)},pe=()=>{h(null),s(!1),f("")},ze=(t,k)=>{ee(k)},Ie=t=>{switch(t){case"pending":return"warning";case"approved":return"success";case"rejected":return"error";case"added":return"info";default:return"default"}};return a?e.jsx(ce,{display:"flex",justifyContent:"center",alignItems:"center",height:"50vh",children:e.jsx(fe,{})}):r?e.jsxs(me,{maxWidth:"xl",sx:{mt:4,mb:4},children:[e.jsx(xe,{variant:"h4",gutterBottom:!0,component:"h1",sx:{mb:2,color:t=>(t.palette.mode==="dark",t.palette.text.primary)},children:"Review Package Suggestions"}),e.jsx(kt,{open:!!w,autoHideDuration:6e3,onClose:()=>C(null),message:w}),e.jsx(ce,{sx:{borderBottom:1,borderColor:"divider",mb:2},children:e.jsxs(st,{value:R,onChange:ze,"aria-label":"suggestion status filter",children:[e.jsx(X,{label:"Pending",value:"pending"}),e.jsx(X,{label:"Approved",value:"approved"}),e.jsx(X,{label:"Rejected",value:"rejected"}),e.jsx(X,{label:"Added to DB",value:"added"})]})}),b&&e.jsx(ce,{display:"flex",justifyContent:"center",py:3,children:e.jsx(fe,{})}),x&&e.jsx(ve,{severity:"error",sx:{mb:2},children:x}),!b&&!x&&m.length===0&&e.jsxs(xe,{sx:{mt:2},children:["No ",R," suggestions found."]}),!b&&!x&&m.length>0&&e.jsx(Ge,{component:Pe,elevation:2,children:e.jsxs(Xe,{sx:{minWidth:900},"aria-label":"review suggestions table",children:[e.jsx(Ke,{children:e.jsxs(ge,{children:[e.jsx(g,{children:"Package Name"}),e.jsx(g,{children:"Suggested By"}),e.jsx(g,{children:"Submitted"}),e.jsx(g,{children:"Status"}),e.jsx(g,{children:"Repo URL"}),e.jsx(g,{children:"Publication URL"}),e.jsx(g,{children:"Webserver URL"}),e.jsx(g,{children:"Other Link"}),e.jsx(g,{align:"right",sx:{minWidth:"180px"},children:"Actions"})]})}),e.jsx(Je,{children:m.map(t=>e.jsxs(ge,{hover:!0,sx:{opacity:p===t.id?.5:1},children:[e.jsx(g,{component:"th",scope:"row",children:t.package_name}),e.jsx(g,{children:t.suggester_email||"Anonymous/Error"}),e.jsx(g,{children:new Date(t.created_at).toLocaleDateString()}),e.jsx(g,{children:e.jsx(Ye,{label:t.status,color:Ie(t.status),size:"small"})}),e.jsx(g,{children:e.jsx(K,{url:t.repo_url})}),e.jsx(g,{children:e.jsx(K,{url:t.publication_url,isRequired:!t.webserver_url&&!t.repo_url&&!t.link_url})}),e.jsx(g,{children:e.jsx(K,{url:t.webserver_url})}),e.jsx(g,{children:e.jsx(K,{url:t.link_url})}),e.jsxs(g,{align:"right",children:[e.jsx(H,{title:"View/Edit Details",children:e.jsxs("span",{children:[" ",e.jsx(F,{size:"small",onClick:()=>ae(t),disabled:p===t.id,children:e.jsx(ot,{})})]})}),t.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx(H,{title:"Approve",children:e.jsx("span",{children:e.jsx(F,{size:"small",color:"success",onClick:()=>te(t.id),sx:{ml:.5},disabled:p===t.id,children:e.jsx(Ot,{})})})}),e.jsx(H,{title:"Reject",children:e.jsx("span",{children:e.jsx(F,{size:"small",color:"error",onClick:()=>Ae(t),sx:{ml:.5},disabled:p===t.id,children:e.jsx(zt,{})})})})]}),t.status==="approved"&&e.jsx(H,{title:"Add to Database Directly",children:e.jsx("span",{children:e.jsx(F,{size:"small",color:"primary",onClick:()=>re(t),sx:{ml:.5},disabled:p===t.id,children:e.jsx(Bt,{})})})}),e.jsx(H,{title:"Delete Suggestion Permanently",children:e.jsx("span",{children:e.jsx(F,{size:"small",color:"error",onClick:()=>ne(t.id,t.package_name),sx:{ml:.5},disabled:p===t.id,children:e.jsx(Ht,{})})})})]})]},t.id))})]})}),z&&e.jsx(Ze,{open:Z,onClose:q,suggestion:z,onSaveSuccess:oe,isAdmin:!0}),e.jsxs(et,{open:_,onClose:pe,maxWidth:"sm",fullWidth:!0,children:[e.jsxs(tt,{children:["Reject Suggestion: ",d==null?void 0:d.package_name]}),e.jsxs(rt,{children:[e.jsx(it,{sx:{mb:2},children:"Please provide a reason for rejecting this suggestion. This will be visible to the user if they can view their rejected suggestions."}),e.jsx(nt,{autoFocus:!0,margin:"dense",id:"admin_notes_reject",label:"Admin Notes (Reason for Rejection)",type:"text",fullWidth:!0,variant:"outlined",multiline:!0,rows:3,value:l,onChange:t=>f(t.target.value)})]}),e.jsxs(at,{children:[e.jsx(je,{onClick:pe,children:"Cancel"}),e.jsx(je,{onClick:()=>d&&G(d.id,"rejected",l),color:"error",disabled:!l.trim(),children:"Confirm Rejection"})]})]})]}):e.jsx(me,{maxWidth:"md",sx:{mt:4},children:e.jsx(ve,{severity:"error",children:"Access Denied. Admins only."})})};export{Gt as default};
