import{Q as W,n as O,r,a2 as _,j as e,q as B,t as N,C as m,A as w,T as b,ak as R,R as z,al as L,am as F,an as v,ao as t,aq as Y,N as $,ap as l,I as E,ar as H}from"./index-BMjG8R_J.js";import{E as Q}from"./Edit-WQXBf0H0.js";import{D as G}from"./Delete-Bj0h_U7V.js";const X=()=>{const p=W(),{currentUser:i,loading:o,isAdmin:d}=O(),a=(i==null?void 0:i.id)||null,[j,c]=r.useState([]),[C,f]=r.useState(!0),[y,u]=r.useState(null),[S,h]=r.useState(null),[k,g]=r.useState(!1),x=r.useCallback(async()=>{if(a){f(!0),u(null);try{const{data:s,error:n}=await _.from("package_suggestions").select("*").eq("suggested_by_user_id",a).order("created_at",{ascending:!1});if(n)throw n;c(s||[])}catch(s){console.error("Error fetching suggestions:",s.message),u(`Failed to load your suggestions: ${s.message}`),c([])}finally{f(!1)}}},[a]);r.useEffect(()=>{!o&&!i?p("/login"):a&&x()},[a,o,p,x]);const T=async s=>{if(window.confirm("Are you sure you want to delete this pending suggestion? This action cannot be undone.")&&a)try{const{error:n}=await _.from("package_suggestions").delete().eq("id",s).eq("status","pending").eq("suggested_by_user_id",a);if(n)throw n;c(I=>I.filter(P=>P.id!==s))}catch(n){u(`Failed to delete suggestion: ${n.message}`)}},A=s=>{s.status==="pending"&&s.suggested_by_user_id===a||d?(h(s),g(!0)):alert("You can only edit your own suggestions that are still pending.")},M=()=>{h(null),g(!1)},q=()=>{x(),g(!1),h(null)},D=s=>{switch(s){case"pending":return"warning";case"approved":return"success";case"rejected":return"error";case"added":return"info";default:return"default"}};return o||C?e.jsx(B,{display:"flex",justifyContent:"center",alignItems:"center",height:"50vh",children:e.jsx(N,{})}):y?e.jsx(m,{maxWidth:"md",sx:{mt:4},children:e.jsx(w,{severity:"error",children:y})}):i?e.jsxs(m,{maxWidth:"lg",sx:{mt:4,mb:4},children:[e.jsx(b,{variant:"h4",gutterBottom:!0,component:"h1",sx:{mb:3,color:s=>(s.palette.mode==="dark",s.palette.text.primary)},children:"My Package Suggestions"}),j.length===0?e.jsx(b,{children:"You haven't submitted any package suggestions yet."}):e.jsx(R,{component:z,elevation:2,children:e.jsxs(L,{sx:{minWidth:650},"aria-label":"my suggestions table",children:[e.jsx(F,{children:e.jsxs(v,{children:[e.jsx(t,{children:"Package Name"}),e.jsx(t,{children:"Status"}),e.jsx(t,{children:"Submitted"}),e.jsx(t,{children:"Reason"}),e.jsx(t,{children:"Admin Notes"}),e.jsx(t,{align:"right",children:"Actions"})]})}),e.jsx(Y,{children:j.map(s=>e.jsxs(v,{hover:!0,children:[e.jsx(t,{component:"th",scope:"row",children:s.package_name}),e.jsx(t,{children:e.jsx($,{label:s.status,color:D(s.status),size:"small"})}),e.jsx(t,{children:new Date(s.created_at).toLocaleDateString()}),e.jsx(t,{sx:{maxWidth:200,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.jsx(l,{title:s.suggestion_reason||"",children:e.jsx("span",{children:s.suggestion_reason||"-"})})}),e.jsx(t,{sx:{maxWidth:200,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.jsx(l,{title:s.admin_notes||"",children:e.jsx("span",{children:s.admin_notes||"-"})})}),e.jsxs(t,{align:"right",children:[(s.status==="pending"&&s.suggested_by_user_id===a||d)&&e.jsx(l,{title:"Edit Suggestion",children:e.jsx(E,{size:"small",onClick:()=>A(s),sx:{color:"primary.main"},children:e.jsx(Q,{})})}),s.status==="pending"&&s.suggested_by_user_id===a&&e.jsx(l,{title:"Delete Suggestion",children:e.jsx(E,{size:"small",onClick:()=>T(s.id),sx:{ml:1,color:"error.main"},children:e.jsx(G,{})})})]})]},s.id))})]})}),S&&e.jsx(H,{open:k,onClose:M,suggestion:S,onSaveSuccess:q,isAdmin:!!d})]}):e.jsx(m,{maxWidth:"md",sx:{mt:4},children:e.jsx(w,{severity:"info",children:"Please log in to view your suggestions."})})};export{X as default};
