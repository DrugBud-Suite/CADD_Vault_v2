import{c as ue,j as e,n as fa,O as ja,r as i,o as $e,p as ba,C as K,t as C,A as g,T as c,q as h,G as n,R as _,F as $,a0 as W,S as z,M as j,a1 as X,N as T,m as f,$ as N,H as S,av as We,am as ze,I as Me,ah as Ue,ai as De,aj as He,ak as ee,al as u,an as Re,Z as B}from"./index-Cp6bVkxx.js";import{c as ya,D as ae}from"./dataService-BX5cfm6c.js";import{T as va,a as he}from"./Tabs-C5gOiCYm.js";import{F as Ca,C as Le}from"./FolderOutlined-BRly2U-Y.js";const _e=ue(e.jsx("path",{d:"M13 7h-2v4H7v2h4v4h2v-4h4v-2h-4zm-1-5C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8"}),"AddCircleOutline"),Be=ue(e.jsx("path",{d:"M19 9h-4V3H9v6H5l7 7zM5 18v2h14v-2z"}),"FileDownload"),Ye=ue(e.jsx("path",{d:"M20 6h-8l-2-2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2m0 12H4V6h5.17l2 2H20zm-6.92-3.96L12.39 17 15 15.47 17.61 17l-.69-2.96 2.3-1.99-3.03-.26L15 9l-1.19 2.79-3.03.26z"}),"FolderSpecialOutlined"),Ta=()=>ya("packages"),Sa=()=>{var Ie;const{currentUser:qe,loading:Je,isAdmin:M}=fa(),m=ja(),[P,Ve]=i.useState(0),[l,b]=i.useState({operation:"update",filterOptions:{folder:null,category:null,tags:[]},bulkOperations:{setFolder:null,setCategory:null,addTags:[],removeTags:[]}}),[d,Y]=i.useState({newFolder:"",selectedFolder:"",newCategory:""}),[o,q]=i.useState({oldTag:"",newTag:""}),[te,xe]=i.useState(!1),[U,pe]=i.useState(!1),[me,D]=i.useState(null),[fe,je]=i.useState(null),[be,H]=i.useState(null),[ye,ve]=i.useState(null),[se,re]=i.useState(!1),[Ce,p]=i.useState(null),[Te,le]=i.useState(null),[ne,J]=i.useState(0),[A,V]=i.useState([]),[ie,we]=i.useState(!1),[G,oe]=i.useState(!1),[de,ke]=i.useState(!1),[Fe,w]=i.useState(null),[Oe,Se]=i.useState(null),[R,ce]=i.useState(null),[y,Pe]=i.useState([]),[Q,Ae]=i.useState(!1),[Ge,L]=i.useState(!1),{allAvailableTags:k,allAvailableFolders:E,allAvailableCategories:I}=$e(ba(a=>({allAvailableTags:a.allAvailableTags,allAvailableFolders:a.allAvailableFolders,allAvailableCategories:a.allAvailableCategories}))),Qe=l.filterOptions.folder&&I[l.filterOptions.folder]?I[l.filterOptions.folder]:[],Ee=i.useCallback(async()=>{Ae(!0),L(!0),w(null);try{const a=Ta();l.filterOptions.folder&&a.filter("folder1","eq",l.filterOptions.folder),l.filterOptions.folder&&l.filterOptions.category&&a.filter("category1","eq",l.filterOptions.category);const t=await a.execute();if(t.error)throw t.error;let s=t.data||[];l.filterOptions.tags.length>0&&(s=s.filter(r=>{const x=r.tags||[];return l.filterOptions.tags.every(v=>x.includes(v))})),Pe(s)}catch(a){console.error("Error fetching matching packages:",a),w(`Failed to load matching packages: ${a.message}`),Pe([])}finally{Ae(!1)}},[l.filterOptions]),Ze=i.useCallback(async()=>{if(!o.oldTag.trim()){p("Please select a tag to preview affected packages.");return}we(!0),oe(!0),p(null);try{const a=await ae.fetchPackagesWithTag(o.oldTag.trim());V(a),J(a.length),a.length===0&&p(`No packages found with tag "${o.oldTag.trim()}".`)}catch(a){console.error("Error fetching packages with tag:",a),p(`Failed to load packages with tag: ${a.message}`),V([])}finally{we(!1)}},[o.oldTag]),Ke=a=>{b(t=>({...t,operation:a.target.value})),L(!1)},Xe=a=>{const t=a.target.value==="null"?null:a.target.value;b(s=>({...s,filterOptions:{...s.filterOptions,folder:t,category:null}})),L(!1)},ea=a=>{const t=a.target.value==="null"?null:a.target.value;b(s=>({...s,filterOptions:{...s.filterOptions,category:t}})),L(!1)},aa=(a,t)=>{b(s=>({...s,filterOptions:{...s.filterOptions,tags:t}})),L(!1)},ta=a=>{const t=a.target.value==="null"?null:a.target.value;b(s=>({...s,bulkOperations:{...s.bulkOperations,setFolder:t,setCategory:null}}))},sa=a=>{const t=a.target.value==="null"?null:a.target.value;b(s=>({...s,bulkOperations:{...s.bulkOperations,setCategory:t}}))},ra=(a,t)=>{b(s=>({...s,bulkOperations:{...s.bulkOperations,addTags:t}}))},la=(a,t)=>{b(s=>({...s,bulkOperations:{...s.bulkOperations,removeTags:t}}))},na=(a,t)=>{Ve(t)},Ne=a=>{const{name:t,value:s}=a.target;Y(r=>({...r,[t]:s}))},ia=a=>{const{name:t,value:s}=a.target;q(r=>({...r,[t]:s}))},oa=(a,t)=>{t&&(q(s=>({...s,oldTag:t})),oe(!1),V([]))},da=async()=>{if(!M){p("You must be an admin to perform this operation.");return}if(!o.oldTag.trim()){p("Please select a tag to replace.");return}if(!o.newTag.trim()){p("Please enter a new tag name.");return}re(!0),p(null),le(null),J(0);try{let a=[];if(G&&A.length>0?a=A:a=await ae.fetchPackagesWithTag(o.oldTag.trim()),a.length===0){p(`No packages found with tag "${o.oldTag.trim()}".`),re(!1);return}let t=0,s=0;for(const x of a)try{const Z=(x.tags||[]).map(O=>O===o.oldTag.trim()?o.newTag.trim():O),{error:F}=await B.from("packages").update({tags:Z}).eq("id",x.id);if(F)throw F;t++}catch(v){console.error("Error updating package tags:",v),s++}J(t),le(`Successfully updated tag "${o.oldTag.trim()}" to "${o.newTag.trim()}" in ${t} packages.`),s>0&&p(`Failed to update tags in ${s} packages.`),q({oldTag:"",newTag:""});const r=[...k];if(r.includes(o.newTag.trim())||r.push(o.newTag.trim()),t===a.length){const x=r.indexOf(o.oldTag.trim());x!==-1&&r.splice(x,1)}$e.setState({allAvailableTags:r.sort()})}catch(a){console.error("Error updating tags:",a),p(`Failed to update tags: ${a.message}`)}finally{re(!1)}},ca=a=>{Y(t=>({...t,selectedFolder:a.target.value}))},ga=async()=>{if(!M){D("You must be an admin to create folders.");return}if(!d.newFolder.trim()){D("Please enter a folder name.");return}xe(!0),D(null),je(null);try{const{error:a}=await B.from("folders").insert({name:d.newFolder.trim()}).select().single();if(a){if(a.code==="23505")D(`Folder "${d.newFolder.trim()}" already exists.`);else throw a;return}je(`Folder "${d.newFolder.trim()}" created successfully!`),Y({...d,newFolder:""}),await ae.refreshFilterMetadata()}catch(a){console.error("Error creating folder:",a),D(`Failed to create folder: ${a.message}`)}finally{xe(!1)}},ha=async()=>{if(!M){H("You must be an admin to create categories.");return}if(!d.selectedFolder){H("Please select a folder.");return}if(!d.newCategory.trim()){H("Please enter a category name.");return}pe(!0),H(null),ve(null);try{const{error:a}=await B.rpc("ensure_folder_category_exists",{folder_name:d.selectedFolder,category_name:d.newCategory.trim()});if(a)throw a;ve(`Category "${d.newCategory.trim()}" created successfully!`),Y({...d,newCategory:""}),await ae.refreshFilterMetadata()}catch(a){console.error("Error creating category:",a),H(`Failed to create category: ${a.message}`)}finally{pe(!1)}},ua=async()=>{if(!M){w("You must be an admin to perform this operation.");return}if(y.length===0){w("No packages match the current filter criteria.");return}if(!(l.bulkOperations.setFolder!==null||l.bulkOperations.setCategory!==null||l.bulkOperations.addTags.length>0||l.bulkOperations.removeTags.length>0)){w("Please specify at least one update option.");return}ke(!0),w(null),Se(null),ce(null);try{const t=y.map(x=>x.id);let s=0,r=0;for(const x of t)try{const{data:v,error:Z}=await B.from("packages").select("*").eq("id",x).single();if(Z)throw Z;if(!v)continue;const F={};if(l.bulkOperations.setFolder!==null&&(F.folder1=l.bulkOperations.setFolder),l.bulkOperations.setCategory!==null&&(F.category1=l.bulkOperations.setCategory),l.bulkOperations.addTags.length>0||l.bulkOperations.removeTags.length>0){const O=v.tags||[],pa=l.bulkOperations.addTags.filter(ge=>!O.includes(ge)),ma=O.filter(ge=>!l.bulkOperations.removeTags.includes(ge));F.tags=[...ma,...pa]}if(Object.keys(F).length>0){const{error:O}=await B.from("packages").update(F).eq("id",x);if(O)throw O;s++}}catch(v){console.error("Error updating package:",v),r++}ce({status:r>0?s>0?"warning":"error":"success",message:`Operation completed with ${s} packages updated successfully${r>0?` and ${r} errors`:""}.`,affectedPackages:s}),Se(`Successfully updated ${s} packages.`),r>0&&w(`Failed to update ${r} packages.`),await Ee()}catch(t){console.error("Error executing bulk operation:",t),w(`Failed to execute operation: ${t.message}`),ce({status:"error",message:`Operation failed: ${t.message}`,affectedPackages:0})}finally{ke(!1)}},xa=()=>{if(y.length===0)return;const a=JSON.stringify(y,null,2),t="data:application/json;charset=utf-8,"+encodeURIComponent(a),s=`cadd-vault-packages-${new Date().toISOString()}.json`,r=document.createElement("a");r.setAttribute("href",t),r.setAttribute("download",s),r.click()};return Je?e.jsx(K,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"80vh"},children:e.jsx(C,{})}):qe?M?e.jsxs(K,{sx:{py:4},children:[e.jsx(c,{variant:"h4",component:"h1",gutterBottom:!0,sx:{fontWeight:"bold"},children:"Database Administration"}),e.jsx(c,{variant:"subtitle1",color:"text.secondary",gutterBottom:!0,children:"Manage database entries and structure."}),e.jsx(h,{sx:{borderBottom:1,borderColor:"divider",mb:2},children:e.jsxs(va,{value:P,onChange:na,"aria-label":"admin operations tabs",children:[e.jsx(he,{label:"Bulk Updates",id:"admin-tab-0","aria-controls":"admin-tabpanel-0"}),e.jsx(he,{label:"Folder & Category Management",id:"admin-tab-1","aria-controls":"admin-tabpanel-1"}),e.jsx(he,{label:"Tag Management",id:"admin-tab-2","aria-controls":"admin-tabpanel-2"})]})}),e.jsx("div",{role:"tabpanel",hidden:P!==0,id:"admin-tabpanel-0","aria-labelledby":"admin-tab-0",children:P===0&&e.jsxs(n,{container:!0,spacing:3,children:[e.jsx(n,{item:!0,xs:12,children:e.jsxs(_,{elevation:3,sx:{p:3,mt:2},children:[e.jsx(c,{variant:"h6",gutterBottom:!0,children:"Operation Settings"}),e.jsxs($,{fullWidth:!0,sx:{mb:3},children:[e.jsx(W,{children:"Operation Type"}),e.jsx(z,{value:l.operation,onChange:Ke,label:"Operation Type",children:e.jsx(j,{value:"update",children:"Update Packages"})})]}),e.jsxs(h,{sx:{mb:4},children:[e.jsxs(c,{variant:"subtitle1",sx:{mb:2,display:"flex",alignItems:"center"},children:[e.jsx(Ca,{sx:{mr:1}}),"Filter Criteria"]}),e.jsx(g,{severity:"info",sx:{mb:2},children:"Define which packages will be affected by this operation."}),e.jsxs(n,{container:!0,spacing:2,children:[e.jsx(n,{item:!0,xs:12,sm:6,children:e.jsxs($,{fullWidth:!0,children:[e.jsx(W,{children:"Folder"}),e.jsxs(z,{value:l.filterOptions.folder||"null",onChange:Xe,label:"Folder",children:[e.jsx(j,{value:"null",children:"Any Folder"}),E.map(a=>e.jsx(j,{value:a,children:a},a))]})]})}),e.jsx(n,{item:!0,xs:12,sm:6,children:e.jsxs($,{fullWidth:!0,disabled:!l.filterOptions.folder,children:[e.jsx(W,{children:"Category"}),e.jsxs(z,{value:l.filterOptions.category||"null",onChange:ea,label:"Category",children:[e.jsx(j,{value:"null",children:"Any Category"}),Qe.map(a=>e.jsx(j,{value:a,children:a},a))]})]})}),e.jsx(n,{item:!0,xs:12,children:e.jsx(X,{multiple:!0,id:"filter-tags",options:k,value:l.filterOptions.tags,onChange:aa,renderInput:a=>e.jsx(N,{...a,label:"Has Tags",placeholder:"Select tags to filter by",helperText:"Only packages having ALL selected tags will be affected"}),renderTags:(a,t)=>a.map((s,r)=>e.jsx(T,{variant:"outlined",label:s,...t({index:r}),sx:{bgcolor:f(m.palette.primary.main,.1),borderColor:f(m.palette.primary.main,.3)}}))})})]})]}),e.jsx(S,{variant:"outlined",color:"primary",onClick:Ee,disabled:Q,sx:{mb:4},children:Q?e.jsx(C,{size:24}):"Preview Matching Packages"}),e.jsx(We,{sx:{mb:4}}),e.jsxs(h,{sx:{mb:4},children:[e.jsxs(c,{variant:"subtitle1",sx:{mb:2,display:"flex",alignItems:"center"},children:[e.jsx(Le,{sx:{mr:1}}),"Update Options"]}),e.jsx(g,{severity:"warning",sx:{mb:2},children:"Specify the changes to apply to all matching packages."}),e.jsxs(n,{container:!0,spacing:2,children:[e.jsx(n,{item:!0,xs:12,sm:6,children:e.jsxs($,{fullWidth:!0,children:[e.jsx(W,{children:"Change Folder To"}),e.jsxs(z,{value:l.bulkOperations.setFolder||"null",onChange:ta,label:"Change Folder To",children:[e.jsx(j,{value:"null",children:"No Change"}),E.map(a=>e.jsx(j,{value:a,children:a},a))]})]})}),e.jsx(n,{item:!0,xs:12,sm:6,children:e.jsxs($,{fullWidth:!0,children:[e.jsx(W,{children:"Change Category To"}),e.jsxs(z,{value:l.bulkOperations.setCategory||"null",onChange:sa,label:"Change Category To",children:[e.jsx(j,{value:"null",children:"No Change"}),Object.values(I).flat().filter((a,t,s)=>s.indexOf(a)===t).sort().map(a=>e.jsx(j,{value:a,children:a},a))]})]})}),e.jsx(n,{item:!0,xs:12,sm:6,children:e.jsx(X,{multiple:!0,id:"add-tags",options:k.filter(a=>!l.bulkOperations.addTags.includes(a)),value:l.bulkOperations.addTags,onChange:ra,renderInput:a=>e.jsx(N,{...a,label:"Add Tags",placeholder:"Select tags to add",helperText:"These tags will be added to all matching packages"}),renderTags:(a,t)=>a.map((s,r)=>e.jsx(T,{variant:"outlined",label:s,...t({index:r}),sx:{bgcolor:f(m.palette.success.main,.1),borderColor:f(m.palette.success.main,.3)}}))})}),e.jsx(n,{item:!0,xs:12,sm:6,children:e.jsx(X,{multiple:!0,id:"remove-tags",options:k.filter(a=>!l.bulkOperations.removeTags.includes(a)),value:l.bulkOperations.removeTags,onChange:la,renderInput:a=>e.jsx(N,{...a,label:"Remove Tags",placeholder:"Select tags to remove",helperText:"These tags will be removed from all matching packages"}),renderTags:(a,t)=>a.map((s,r)=>e.jsx(T,{variant:"outlined",label:s,...t({index:r}),sx:{bgcolor:f(m.palette.error.main,.1),borderColor:f(m.palette.error.main,.3)}}))})})]})]}),Fe&&e.jsx(g,{severity:"error",sx:{mb:2},children:Fe}),Oe&&e.jsx(g,{severity:"success",sx:{mb:2},children:Oe}),R&&e.jsxs(g,{severity:R.status,sx:{mb:2},children:[R.message,R.details&&e.jsx(c,{variant:"body2",mt:1,children:R.details})]}),e.jsx(S,{variant:"contained",color:"primary",disabled:de||y.length===0,onClick:ua,sx:{mr:2},children:de?e.jsx(C,{size:24}):"Execute Operation"}),e.jsx(S,{variant:"outlined",color:"secondary",onClick:()=>b({operation:"update",filterOptions:{folder:null,category:null,tags:[]},bulkOperations:{setFolder:null,setCategory:null,addTags:[],removeTags:[]}}),disabled:de,children:"Reset Form"})]})}),Ge&&e.jsx(n,{item:!0,xs:12,children:e.jsxs(_,{elevation:3,sx:{p:3,mt:2},children:[e.jsxs(h,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(c,{variant:"h6",children:Q?"Loading Matching Packages...":`Matching Packages (${y.length})`}),y.length>0&&e.jsx(ze,{title:"Download as JSON",children:e.jsx(Me,{onClick:xa,color:"primary",children:e.jsx(Be,{})})})]}),Q?e.jsx(h,{sx:{display:"flex",justifyContent:"center",p:4},children:e.jsx(C,{})}):y.length===0?e.jsx(g,{severity:"info",children:"No packages match the selected filter criteria."}):e.jsx(Ue,{sx:{maxHeight:400},children:e.jsxs(De,{stickyHeader:!0,children:[e.jsx(He,{children:e.jsxs(ee,{children:[e.jsx(u,{sx:{fontWeight:"bold"},children:"Package Name"}),e.jsx(u,{sx:{fontWeight:"bold"},children:"Folder"}),e.jsx(u,{sx:{fontWeight:"bold"},children:"Category"}),e.jsx(u,{sx:{fontWeight:"bold"},children:"Tags"})]})}),e.jsx(Re,{children:y.map(a=>{var t,s,r;return e.jsxs(ee,{hover:!0,children:[e.jsx(u,{children:a.package_name}),e.jsx(u,{children:a.folder1||"—"}),e.jsx(u,{children:a.category1||"—"}),e.jsx(u,{children:e.jsxs(h,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:[(t=a.tags)==null?void 0:t.slice(0,5).map(x=>e.jsx(T,{label:x,size:"small",sx:{fontSize:"0.75rem",height:22}},x)),(((s=a.tags)==null?void 0:s.length)||0)>5&&e.jsx(T,{label:`+${(((r=a.tags)==null?void 0:r.length)||0)-5} more`,size:"small",variant:"outlined",sx:{fontSize:"0.75rem",height:22}}),(!a.tags||a.tags.length===0)&&e.jsx(c,{variant:"body2",color:"text.secondary",children:"No tags"})]})})]},a.id)})})]})})]})})]})}),e.jsx("div",{role:"tabpanel",hidden:P!==2,id:"admin-tabpanel-2","aria-labelledby":"admin-tab-2",children:P===2&&e.jsx(n,{container:!0,spacing:3,children:e.jsx(n,{item:!0,xs:12,children:e.jsxs(_,{elevation:3,sx:{p:3},children:[e.jsxs(c,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center"},children:[e.jsx(Ye,{sx:{mr:1}}),"Tag Management"]}),e.jsx(g,{severity:"info",sx:{mb:3},children:"Find and correct tags with typos. Changes will be applied to all packages that have the selected tag."}),Ce&&e.jsx(g,{severity:"error",sx:{mb:2},children:Ce}),Te&&e.jsx(g,{severity:"success",sx:{mb:2},children:Te}),e.jsxs(n,{container:!0,spacing:2,sx:{mb:3},children:[e.jsx(n,{item:!0,xs:12,sm:6,children:e.jsx(X,{options:k,value:o.oldTag,onChange:(a,t)=>oa(a,t),renderInput:a=>e.jsx(N,{...a,label:"Tag to Replace",name:"oldTag",fullWidth:!0,helperText:"Select the tag that has a typo or needs to be renamed"})})}),e.jsx(n,{item:!0,xs:12,sm:6,children:e.jsx(N,{label:"New Tag Name",name:"newTag",value:o.newTag,onChange:ia,fullWidth:!0,helperText:"Enter the corrected tag name"})})]}),e.jsxs(h,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(S,{variant:"outlined",color:"primary",onClick:Ze,disabled:ie||!o.oldTag,children:ie?e.jsx(C,{size:24}):"Preview Affected Packages"}),!G&&o.oldTag&&e.jsx(c,{variant:"body2",sx:{alignSelf:"center",fontStyle:"italic"},children:"Click to see which packages will be affected"})]}),e.jsxs(h,{sx:{display:"flex",gap:2},children:[e.jsx(S,{variant:"contained",color:"primary",onClick:da,disabled:se||!o.oldTag||!o.newTag||ne===0,sx:{mr:2},children:se?e.jsx(C,{size:24}):"Update Tag"}),e.jsx(S,{variant:"outlined",color:"secondary",onClick:()=>{q({oldTag:"",newTag:""}),p(null),le(null),oe(!1),V([]),J(0)},disabled:se,children:"Reset Form"})]}),ne>0&&!G&&e.jsx(h,{sx:{mt:3},children:e.jsxs(c,{variant:"subtitle2",children:["Tags updated in ",ne," packages"]})}),e.jsx(We,{sx:{my:3}}),e.jsxs(c,{variant:"subtitle1",sx:{mb:2},children:["Available Tags (",k.length,")"]}),e.jsx(h,{sx:{maxHeight:200,overflowY:"auto",border:1,borderColor:"divider",borderRadius:1,p:1},children:k.length>0?e.jsx(h,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:k.map(a=>e.jsx(T,{label:a,size:"small",sx:{bgcolor:f(m.palette.primary.main,.1)}},a))}):e.jsx(c,{variant:"body2",color:"text.secondary",children:"No tags available"})}),G&&e.jsxs(h,{sx:{mt:3},children:[e.jsxs(c,{variant:"subtitle1",sx:{mb:2,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("span",{children:['Packages With Tag "',o.oldTag,'" (',A.length,")"]}),A.length>0&&e.jsx(ze,{title:"Download as JSON",children:e.jsx(Me,{size:"small",onClick:()=>{const a=JSON.stringify(A,null,2),t="data:application/json;charset=utf-8,"+encodeURIComponent(a),s=`packages-with-tag-${o.oldTag}-${new Date().toISOString()}.json`,r=document.createElement("a");r.setAttribute("href",t),r.setAttribute("download",s),r.click()},children:e.jsx(Be,{})})})]}),ie?e.jsx(h,{sx:{display:"flex",justifyContent:"center",p:3},children:e.jsx(C,{})}):A.length===0?e.jsx(g,{severity:"info",children:"No packages found with this tag."}):e.jsx(Ue,{sx:{maxHeight:400},children:e.jsxs(De,{stickyHeader:!0,size:"small",children:[e.jsx(He,{children:e.jsxs(ee,{children:[e.jsx(u,{children:"Package Name"}),e.jsx(u,{children:"Folder"}),e.jsx(u,{children:"Category"}),e.jsx(u,{children:"Tags"})]})}),e.jsx(Re,{children:A.map(a=>e.jsxs(ee,{hover:!0,children:[e.jsx(u,{children:a.package_name}),e.jsx(u,{children:a.folder1||"None"}),e.jsx(u,{children:a.category1||"None"}),e.jsx(u,{children:e.jsxs(h,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:[a.tags&&a.tags.map(t=>e.jsx(T,{label:t,size:"small",sx:{bgcolor:t===o.oldTag?f(m.palette.warning.main,.2):f(m.palette.primary.main,.1),fontWeight:t===o.oldTag?"bold":"normal",height:22}},`${a.id}-${t}`)),(!a.tags||a.tags.length===0)&&e.jsx(c,{variant:"body2",color:"text.secondary",children:"No tags"})]})})]},a.id))})]})})]})]})})})}),e.jsx("div",{role:"tabpanel",hidden:P!==1,id:"admin-tabpanel-1","aria-labelledby":"admin-tab-1",children:P===1&&e.jsxs(n,{container:!0,spacing:3,children:[e.jsx(n,{item:!0,xs:12,md:6,children:e.jsxs(_,{elevation:3,sx:{p:3},children:[e.jsxs(c,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center"},children:[e.jsx(Ye,{sx:{mr:1}}),"Create New Folder"]}),e.jsx(g,{severity:"info",sx:{mb:3},children:"Add a new top-level folder to organize packages. Folders are the main classification groups."}),me&&e.jsx(g,{severity:"error",sx:{mb:2},children:me}),fe&&e.jsx(g,{severity:"success",sx:{mb:2},children:fe}),e.jsxs(n,{container:!0,spacing:2,children:[e.jsx(n,{item:!0,xs:12,children:e.jsx(N,{fullWidth:!0,label:"New Folder Name",name:"newFolder",value:d.newFolder,onChange:Ne,placeholder:"Enter folder name",helperText:"This will create a new folder in the database"})}),e.jsx(n,{item:!0,xs:12,children:e.jsx(S,{variant:"contained",color:"primary",onClick:ga,disabled:te||!d.newFolder.trim(),startIcon:te?e.jsx(C,{size:20}):e.jsx(_e,{}),fullWidth:!0,children:te?"Creating...":"Create Folder"})})]}),e.jsxs(c,{variant:"subtitle2",sx:{mt:3,mb:1},children:["Existing Folders (",E.length,")"]}),e.jsx(h,{sx:{maxHeight:200,overflowY:"auto",border:1,borderColor:"divider",borderRadius:1,p:1},children:E.length>0?e.jsx(h,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:E.map(a=>e.jsx(T,{label:a,variant:"outlined",size:"small",sx:{bgcolor:f(m.palette.primary.main,.05)}},a))}):e.jsx(c,{variant:"body2",color:"text.secondary",children:"No folders defined yet."})})]})}),e.jsx(n,{item:!0,xs:12,md:6,children:e.jsxs(_,{elevation:3,sx:{p:3},children:[e.jsxs(c,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center"},children:[e.jsx(Le,{sx:{mr:1}}),"Create New Category"]}),e.jsx(g,{severity:"info",sx:{mb:3},children:"Add a new category within an existing folder. Categories are subgroups of folders."}),be&&e.jsx(g,{severity:"error",sx:{mb:2},children:be}),ye&&e.jsx(g,{severity:"success",sx:{mb:2},children:ye}),e.jsxs(n,{container:!0,spacing:2,children:[e.jsx(n,{item:!0,xs:12,children:e.jsxs($,{fullWidth:!0,children:[e.jsx(W,{children:"Select Folder"}),e.jsx(z,{value:d.selectedFolder,onChange:ca,label:"Select Folder",disabled:U||E.length===0,children:E.map(a=>e.jsx(j,{value:a,children:a},a))})]})}),e.jsx(n,{item:!0,xs:12,children:e.jsx(N,{fullWidth:!0,label:"New Category Name",name:"newCategory",value:d.newCategory,onChange:Ne,placeholder:"Enter category name",helperText:"This will create a new category within the selected folder",disabled:!d.selectedFolder||U})}),e.jsx(n,{item:!0,xs:12,children:e.jsx(S,{variant:"contained",color:"primary",onClick:ha,disabled:U||!d.selectedFolder||!d.newCategory.trim(),startIcon:U?e.jsx(C,{size:20}):e.jsx(_e,{}),fullWidth:!0,children:U?"Creating...":"Create Category"})})]}),d.selectedFolder&&e.jsxs(e.Fragment,{children:[e.jsxs(c,{variant:"subtitle2",sx:{mt:3,mb:1},children:['Existing Categories in "',d.selectedFolder,'" (',(I[d.selectedFolder]||[]).length,")"]}),e.jsx(h,{sx:{maxHeight:200,overflowY:"auto",border:1,borderColor:"divider",borderRadius:1,p:1},children:((Ie=I[d.selectedFolder])==null?void 0:Ie.length)>0?e.jsx(h,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:I[d.selectedFolder].map(a=>e.jsx(T,{label:a,variant:"outlined",size:"small",sx:{bgcolor:f(m.palette.secondary.main,.05)}},a))}):e.jsx(c,{variant:"body2",color:"text.secondary",children:"No categories defined in this folder yet."})})]})]})})]})})]}):e.jsx(K,{sx:{py:4},children:e.jsx(g,{severity:"error",children:"Access Denied. This page is for administrators only."})}):e.jsx(K,{sx:{py:4},children:e.jsx(g,{severity:"error",children:"You must be logged in to access this page."})})};export{Sa as default};
