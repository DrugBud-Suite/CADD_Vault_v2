import{Q as q,R as I,r as i,t as S,j as e,p as O,q as B,C as x,A as _,T as w,af as N,U as R,ag as z,ah as L,ai as b,aj as a,ak as F,N as Y,al as r,I as v,am as $}from"./index-B9BmRKEw.js";import{E as H}from"./Edit-B_54aDr2.js";import{D as Q}from"./Delete-B7U26GE2.js";const U=()=>{const m=q(),{currentUser:t,loading:l,isAdmin:o}=I(),[p,d]=i.useState([]),[E,j]=i.useState(!0),[f,c]=i.useState(null),[y,u]=i.useState(null),[C,h]=i.useState(!1),g=i.useCallback(async()=>{if(t){j(!0),c(null);try{const{data:s,error:n}=await S.from("package_suggestions").select("*").eq("suggested_by_user_id",t.id).order("created_at",{ascending:!1});if(n)throw n;d(s||[])}catch(s){console.error("Error fetching suggestions:",s.message),c(`Failed to load your suggestions: ${s.message}`),d([])}finally{j(!1)}}},[t]);i.useEffect(()=>{!l&&!t?m("/login"):t&&g()},[t,l,m,g]);const k=async s=>{if(window.confirm("Are you sure you want to delete this pending suggestion? This action cannot be undone.")&&t)try{const{error:n}=await S.from("package_suggestions").delete().eq("id",s).eq("status","pending").eq("suggested_by_user_id",t.id);if(n)throw n;d(P=>P.filter(W=>W.id!==s))}catch(n){c(`Failed to delete suggestion: ${n.message}`)}},T=s=>{s.status==="pending"&&s.suggested_by_user_id===(t==null?void 0:t.id)||o?(u(s),h(!0)):alert("You can only edit your own suggestions that are still pending.")},A=()=>{u(null),h(!1)},M=()=>{g(),h(!1),u(null)},D=s=>{switch(s){case"pending":return"warning";case"approved":return"success";case"rejected":return"error";case"added":return"info";default:return"default"}};return l||E?e.jsx(O,{display:"flex",justifyContent:"center",alignItems:"center",height:"50vh",children:e.jsx(B,{})}):f?e.jsx(x,{maxWidth:"md",sx:{mt:4},children:e.jsx(_,{severity:"error",children:f})}):t?e.jsxs(x,{maxWidth:"lg",sx:{mt:4,mb:4},children:[e.jsx(w,{variant:"h4",gutterBottom:!0,component:"h1",sx:{mb:3,color:s=>(s.palette.mode==="dark",s.palette.text.primary)},children:"My Package Suggestions"}),p.length===0?e.jsx(w,{children:"You haven't submitted any package suggestions yet."}):e.jsx(N,{component:R,elevation:2,children:e.jsxs(z,{sx:{minWidth:650},"aria-label":"my suggestions table",children:[e.jsx(L,{children:e.jsxs(b,{children:[e.jsx(a,{children:"Package Name"}),e.jsx(a,{children:"Status"}),e.jsx(a,{children:"Submitted"}),e.jsx(a,{children:"Reason"}),e.jsx(a,{children:"Admin Notes"}),e.jsx(a,{align:"right",children:"Actions"})]})}),e.jsx(F,{children:p.map(s=>e.jsxs(b,{hover:!0,children:[e.jsx(a,{component:"th",scope:"row",children:s.package_name}),e.jsx(a,{children:e.jsx(Y,{label:s.status,color:D(s.status),size:"small"})}),e.jsx(a,{children:new Date(s.created_at).toLocaleDateString()}),e.jsx(a,{sx:{maxWidth:200,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.jsx(r,{title:s.suggestion_reason||"",children:e.jsx("span",{children:s.suggestion_reason||"-"})})}),e.jsx(a,{sx:{maxWidth:200,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.jsx(r,{title:s.admin_notes||"",children:e.jsx("span",{children:s.admin_notes||"-"})})}),e.jsxs(a,{align:"right",children:[(s.status==="pending"&&s.suggested_by_user_id===t.id||o)&&e.jsx(r,{title:"Edit Suggestion",children:e.jsx(v,{size:"small",onClick:()=>T(s),sx:{color:"primary.main"},children:e.jsx(H,{})})}),s.status==="pending"&&s.suggested_by_user_id===t.id&&e.jsx(r,{title:"Delete Suggestion",children:e.jsx(v,{size:"small",onClick:()=>k(s.id),sx:{ml:1,color:"error.main"},children:e.jsx(Q,{})})})]})]},s.id))})]})}),y&&e.jsx($,{open:C,onClose:A,suggestion:y,onSaveSuccess:M,isAdmin:!!o})]}):e.jsx(x,{maxWidth:"md",sx:{mt:4},children:e.jsx(_,{severity:"info",children:"Please log in to view your suggestions."})})};export{U as default};
