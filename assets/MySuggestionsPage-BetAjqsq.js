import{x as q,y as T,z as k,D as E,P as R,Q as P,r as i,t as j,j as e,p as A,q as I,C as d,A as f,T as v,R as W,K as z,ad as u,I as M}from"./index-DB6fSGL8.js";import{T as B,a as F,b as H,c as y,d as r,e as L}from"./TableRow-knOFdDOx.js";var l={},w;function N(){if(w)return l;w=1;var o=q();Object.defineProperty(l,"__esModule",{value:!0}),l.default=void 0;var s=o(T()),n=k();return l.default=(0,s.default)((0,n.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM19 4h-3.5l-1-1h-5l-1 1H5v2h14z"}),"Delete"),l}var O=N();const $=E(O),Q=()=>{const o=R(),{currentUser:s,loading:n}=P(),[h,x]=i.useState([]),[b,g]=i.useState(!0),[p,c]=i.useState(null),m=i.useCallback(async()=>{if(s){g(!0),c(null);try{const{data:t,error:a}=await j.from("package_suggestions").select("*").eq("suggested_by_user_id",s.id).order("created_at",{ascending:!1});if(a)throw a;x(t||[])}catch(t){console.error("Error fetching suggestions:",t.message),c(`Failed to load your suggestions: ${t.message}`)}finally{g(!1)}}},[s]);i.useEffect(()=>{!n&&!s?o("/login"):s&&m()},[s,n,o,m]);const S=async t=>{if(window.confirm("Are you sure you want to delete this pending suggestion? This action cannot be undone."))try{const{error:a}=await j.from("package_suggestions").delete().eq("id",t).eq("status","pending");if(a)throw a;x(D=>D.filter(C=>C.id!==t))}catch(a){c(`Failed to delete suggestion: ${a.message}`)}},_=t=>{switch(t){case"pending":return"warning";case"approved":return"success";case"rejected":return"error";default:return"default"}};return n||b?e.jsx(A,{display:"flex",justifyContent:"center",alignItems:"center",height:"50vh",children:e.jsx(I,{})}):p?e.jsx(d,{maxWidth:"md",sx:{mt:4},children:e.jsx(f,{severity:"error",children:p})}):s?e.jsxs(d,{maxWidth:"lg",sx:{mt:4,mb:4},children:[e.jsx(v,{variant:"h4",gutterBottom:!0,component:"h1",sx:{mb:3,color:t=>(t.palette.mode==="dark",t.palette.text.primary)},children:"My Package Suggestions"}),h.length===0?e.jsx(v,{children:"You haven't submitted any package suggestions yet."}):e.jsx(B,{component:W,elevation:2,children:e.jsxs(F,{sx:{minWidth:650},"aria-label":"my suggestions table",children:[e.jsx(H,{children:e.jsxs(y,{children:[e.jsx(r,{children:"Package Name"}),e.jsx(r,{children:"Status"}),e.jsx(r,{children:"Submitted"}),e.jsx(r,{children:"Reason"}),e.jsx(r,{children:"Admin Notes"}),e.jsx(r,{align:"right",children:"Actions"})]})}),e.jsx(L,{children:h.map(t=>e.jsxs(y,{hover:!0,children:[e.jsx(r,{component:"th",scope:"row",children:t.package_name}),e.jsx(r,{children:e.jsx(z,{label:t.status,color:_(t.status),size:"small"})}),e.jsx(r,{children:new Date(t.created_at).toLocaleDateString()}),e.jsx(r,{sx:{maxWidth:200,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.jsx(u,{title:t.suggestion_reason||"",children:e.jsx("span",{children:t.suggestion_reason||"-"})})}),e.jsx(r,{sx:{maxWidth:200,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.jsx(u,{title:t.admin_notes||"",children:e.jsx("span",{children:t.admin_notes||"-"})})}),e.jsx(r,{align:"right",children:t.status==="pending"&&e.jsx(e.Fragment,{children:e.jsx(u,{title:"Delete Suggestion",children:e.jsx(M,{size:"small",onClick:()=>S(t.id),sx:{ml:1,color:"error.main"},children:e.jsx($,{})})})})})]},t.id))})]})})]}):e.jsx(d,{maxWidth:"md",sx:{mt:4},children:e.jsx(f,{severity:"info",children:"Please log in to view your suggestions."})})};export{Q as default};
