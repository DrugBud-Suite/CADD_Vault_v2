import{R as M,o as U,r as i,p as x,j as e,t as G,v as S,C as z,U as B,T as H,ae as o,F as w,af as T,S as W,M as h,ag as O,N as q,A,H as Y,n as b}from"./index-4SPLIEu2.js";import{G as s}from"./Grid-D_GsxMrC.js";const J=()=>{const F=M(),{currentUser:m,loading:p}=U(),[a,g]=i.useState({package_name:"",description:"",publication_url:"",webserver_url:"",repo_url:"",link_url:"",license:"",tag_names:[],folder_name:"",category_name:"",suggestion_reason:""}),[_,f]=i.useState(!1),[v,c]=i.useState(null),[j,y]=i.useState(null),P=x(t=>t.allAvailableTags),[E,I]=i.useState([]),[L,k]=i.useState([]);i.useEffect(()=>{c(!p&&!m?"You must be logged in to suggest a package.":null)},[m,p,F]),i.useEffect(()=>{const t=x.getState().allAvailableFolders;I(t)},[]),i.useEffect(()=>{if(a.folder_name){const t=x.getState().allAvailableCategories[a.folder_name]||[];k(t)}else k([])},[a.folder_name]);const u=t=>{const{name:r,value:n}=t.target;g(l=>({...l,[r]:n})),r==="folder_name"&&g(l=>({...l,category_name:""}))},C=t=>{const{name:r,value:n}=t.target;g(l=>({...l,[r]:n})),r==="folder_name"&&g(l=>({...l,category_name:""}))},R=(t,r)=>{g(n=>({...n,tag_names:r}))},N=async t=>{if(t.preventDefault(),c(null),y(null),!m){c("You must be logged in to suggest a package.");return}if(!a.package_name){c("Package Name is required.");return}f(!0);try{const r={suggested_by_user_id:m.id,package_name:a.package_name||"",description:a.description||void 0,publication_url:a.publication_url||void 0,webserver_url:a.webserver_url||void 0,repo_url:a.repo_url||void 0,link_url:a.link_url||void 0,license:a.license||void 0,suggestion_reason:a.suggestion_reason||void 0},{data:n,error:l}=await b.from("package_suggestions").insert([r]).select("id").single();if(l)throw l;if(a.tag_names&&a.tag_names.length>0){const{error:d}=await b.rpc("update_suggestion_tags",{suggestion_uuid:n.id,new_tags:a.tag_names});if(d)throw d}if(a.folder_name&&a.category_name){const{error:d}=await b.rpc("update_suggestion_folder_category",{suggestion_uuid:n.id,folder_name:a.folder_name,category_name:a.category_name});if(d)throw d}y("Package suggestion submitted successfully! It will be reviewed by an admin."),g({package_name:"",description:"",publication_url:"",webserver_url:"",repo_url:"",link_url:"",license:"",tag_names:[],folder_name:"",category_name:"",suggestion_reason:""})}catch(r){console.error("Error submitting package suggestion: ",r.message),c(`Failed to submit suggestion: ${r.message}`)}finally{f(!1)}};return p?e.jsx(G,{display:"flex",justifyContent:"center",alignItems:"center",height:"50vh",children:e.jsx(S,{})}):e.jsx(z,{maxWidth:"md",children:e.jsxs(B,{elevation:3,sx:{p:{xs:2,md:4},mt:4,mb:4,background:t=>t.palette.mode==="dark"?"linear-gradient(135deg, rgba(30,30,30,0.8) 0%, rgba(23,23,23,0.8) 100%)":"linear-gradient(135deg, rgba(255,255,255,0.8) 0%, rgba(249,250,251,0.8) 100%)",backdropFilter:"blur(8px)",border:0,overflow:"hidden",borderRadius:2},children:[e.jsx(H,{variant:"h4",gutterBottom:!0,component:"h1",sx:{textAlign:"center",mb:3,color:t=>(t.palette.mode==="dark",t.palette.text.primary)},children:"Suggest a New Package"}),e.jsx("form",{onSubmit:N,children:e.jsxs(s,{container:!0,spacing:3,children:[e.jsx(s,{item:!0,xs:12,children:e.jsx(o,{label:"Package Name",name:"package_name",value:a.package_name,onChange:u,required:!0,fullWidth:!0,variant:"outlined",helperText:"The primary name of the software or tool."})}),e.jsx(s,{item:!0,xs:12,children:e.jsx(o,{label:"Description",name:"description",value:a.description,onChange:u,multiline:!0,rows:3,fullWidth:!0,variant:"outlined",helperText:"A brief summary of what the package does."})}),e.jsx(s,{item:!0,xs:12,sm:6,children:e.jsx(o,{label:"Publication URL (e.g., DOI link)",name:"publication_url",value:a.publication_url,onChange:u,fullWidth:!0,variant:"outlined",type:"url"})}),e.jsx(s,{item:!0,xs:12,sm:6,children:e.jsx(o,{label:"Webserver/Homepage URL",name:"webserver_url",value:a.webserver_url,onChange:u,fullWidth:!0,variant:"outlined",type:"url"})}),e.jsx(s,{item:!0,xs:12,sm:6,children:e.jsx(o,{label:"Code Repository URL (e.g., GitHub)",name:"repo_url",value:a.repo_url,onChange:u,fullWidth:!0,variant:"outlined",type:"url"})}),e.jsx(s,{item:!0,xs:12,sm:6,children:e.jsx(o,{label:"Other Relevant Link",name:"link_url",value:a.link_url,onChange:u,fullWidth:!0,variant:"outlined",type:"url"})}),e.jsx(s,{item:!0,xs:12,sm:6,children:e.jsx(o,{label:"License (e.g., MIT, GPL-3.0)",name:"license",value:a.license,onChange:u,fullWidth:!0,variant:"outlined"})}),e.jsx(s,{item:!0,xs:12,sm:6,children:e.jsxs(w,{fullWidth:!0,variant:"outlined",children:[e.jsx(T,{id:"folder-label",children:"Folder"}),e.jsxs(W,{labelId:"folder-label",id:"folder_name",name:"folder_name",value:a.folder_name||"",onChange:C,label:"Folder",children:[e.jsx(h,{value:"",children:e.jsx("em",{children:"None"})}),E.map(t=>e.jsx(h,{value:t,children:t},t))]})]})}),e.jsx(s,{item:!0,xs:12,sm:6,children:e.jsxs(w,{fullWidth:!0,variant:"outlined",disabled:!a.folder_name,children:[e.jsx(T,{id:"category-label",children:"Category"}),e.jsxs(W,{labelId:"category-label",id:"category_name",name:"category_name",value:a.category_name||"",onChange:C,label:"Category",children:[e.jsx(h,{value:"",children:e.jsx("em",{children:"None"})}),L.map(t=>e.jsx(h,{value:t,children:t},t))]})]})}),e.jsx(s,{item:!0,xs:12,children:e.jsx(O,{multiple:!0,id:"tags-suggest",options:P,value:a.tag_names||[],onChange:R,freeSolo:!0,renderTags:(t,r)=>t.map((n,l)=>{const{key:d,...D}=r({index:l});return e.jsx(q,{variant:"outlined",label:n,...D},d)}),renderInput:t=>e.jsx(o,{...t,variant:"outlined",label:"Tags",placeholder:"Add or select tags",helperText:"Keywords to help categorize the package."})})}),e.jsx(s,{item:!0,xs:12,children:e.jsx(o,{label:"Reason for Suggestion (Optional)",name:"suggestion_reason",value:a.suggestion_reason,onChange:u,multiline:!0,rows:3,fullWidth:!0,variant:"outlined",helperText:"Why do you think this package should be added?"})}),e.jsxs(s,{item:!0,xs:12,children:[v&&e.jsx(A,{severity:"error",sx:{mb:2},children:v}),j&&e.jsx(A,{severity:"success",sx:{mb:2},children:j}),e.jsx(Y,{type:"submit",variant:"contained",color:"primary",disabled:_||!m,startIcon:_?e.jsx(S,{size:20}):null,fullWidth:!0,size:"large",children:_?"Submitting...":"Submit Suggestion"})]})]})})]})})};export{J as default};
