import{Q as M,n as q,r as s,o as p,j as e,q as B,t as y,T as S,R as F,G as i,a3 as d,F as L,a4 as W,S as E,M as b,a5 as O,N as R,m as o,a6 as $,H as Q,a7 as Y,a2 as J}from"./index-3_hS9l67.js";const V=()=>{const v=M(),{isAdmin:m,loading:j}=q(),[t,h]=s.useState({package_name:"",description:"",publication:"",webserver:"",repo_link:"",link:"",license:"",tags:[],folder1:"",category1:""}),[k,C]=s.useState(!1),[w,x]=s.useState(null),D=p(a=>a.allAvailableTags),P=p(a=>a.originalPackages.length>0),[A,_]=s.useState(!0),[N,z]=s.useState([]),[U,I]=s.useState([]);s.useEffect(()=>{!j&&!m&&(console.warn("Access denied: User is not an admin."),v("/"))},[m,j,v]),s.useEffect(()=>{m&&_(!P)},[m,P]),s.useEffect(()=>{const a=p.getState().allAvailableFolders;z(a)},[]),s.useEffect(()=>{if(t.folder1){const a=p.getState().allAvailableCategories[t.folder1]||[];I(a)}else I([])},[t.folder1]);const c=a=>{const{name:l,value:n}=a.target;h(r=>({...r,[l]:n}))},G=(a,l)=>{h(n=>({...n,tags:l}))},T=a=>{const{name:l,value:n}=a.target;h(r=>({...r,[l]:n})),l==="folder1"&&h(r=>({...r,category1:""}))},H=async a=>{if(a.preventDefault(),x(null),!t.package_name){x("Package Name (package_name) is required.");return}C(!0);try{const n={id:Y(),package_name:t.package_name||"",description:t.description||"",publication:t.publication||"",webserver:t.webserver||"",repo_link:t.repo_link||"",link:t.link||"",license:t.license||"",tags:t.tags||[],folder1:t.folder1||"",category1:t.category1||"",last_updated:new Date().toISOString()},{data:r,error:f}=await J.from("packages").insert([n]).select();if(f)throw f;const g=r==null?void 0:r[0];g?(console.log("Package added successfully:",g),p.getState().setOriginalPackagesAndDeriveMetadata([...p.getState().originalPackages,g]),v(`/package/${encodeURIComponent(g.id)}`)):(x("Failed to retrieve the newly added package data."),console.error("Insert successful but no data returned."))}catch(l){console.error("Error adding package: ",l),x(`Failed to add package: ${l instanceof Error?l.message:String(l)}`)}finally{C(!1)}};return j?e.jsx(B,{display:"flex",justifyContent:"center",alignItems:"center",height:"50vh",children:e.jsx(y,{})}):m?e.jsxs(F,{elevation:3,sx:{p:3,m:2},children:[e.jsx(S,{variant:"h4",gutterBottom:!0,component:"div",children:"Add New Package"}),e.jsx("form",{onSubmit:H,children:e.jsxs(i,{container:!0,spacing:3,children:[e.jsx(i,{item:!0,xs:12,children:e.jsx(d,{id:"package_name",label:"Package Name (package_name)",name:"package_name",value:t.package_name,onChange:c,required:!0,fullWidth:!0,variant:"outlined"})}),e.jsx(i,{item:!0,xs:12,children:e.jsx(d,{id:"description",label:"Description",name:"description",value:t.description,onChange:c,multiline:!0,rows:4,fullWidth:!0,variant:"outlined"})}),e.jsx(i,{item:!0,xs:12,sm:6,children:e.jsx(d,{id:"publication",label:"Publication URL",name:"publication",value:t.publication,onChange:c,fullWidth:!0,variant:"outlined",type:"url"})}),e.jsx(i,{item:!0,xs:12,sm:6,children:e.jsx(d,{id:"webserver",label:"Webserver/Homepage URL",name:"webserver",value:t.webserver,onChange:c,fullWidth:!0,variant:"outlined",type:"url"})}),e.jsx(i,{item:!0,xs:12,sm:6,children:e.jsx(d,{id:"repo_link",label:"Code Repository Link (GitHub or other)",name:"repo_link",value:t.repo_link,onChange:c,fullWidth:!0,variant:"outlined",type:"url",helperText:"Enter the URL for the code repository"})}),e.jsx(i,{item:!0,xs:12,sm:6,children:e.jsx(d,{id:"link",label:"General Link",name:"link",value:t.link,onChange:c,fullWidth:!0,variant:"outlined",type:"url",helperText:"Any other relevant link (not publication or webserver)"})}),e.jsx(i,{item:!0,xs:12,sm:6,children:e.jsx(d,{id:"license",label:"License",name:"license",value:t.license,onChange:c,fullWidth:!0,variant:"outlined"})}),e.jsx(i,{item:!0,xs:12,sm:6,children:e.jsxs(L,{fullWidth:!0,variant:"outlined",children:[e.jsx(W,{id:"folder1-label",children:"Folder"}),e.jsxs(E,{labelId:"folder1-label",id:"folder1",name:"folder1",value:t.folder1||"",onChange:T,label:"Folder",children:[e.jsx(b,{value:"",children:e.jsx("em",{children:"None"})}),N.map(a=>e.jsx(b,{value:a,children:a},a))]})]})}),e.jsx(i,{item:!0,xs:12,sm:6,children:e.jsxs(L,{fullWidth:!0,variant:"outlined",children:[e.jsx(W,{id:"category1-label",children:"Category"}),e.jsxs(E,{labelId:"category1-label",id:"category1",name:"category1",value:t.category1||"",onChange:T,label:"Category",disabled:!t.folder1,children:[e.jsx(b,{value:"",children:e.jsx("em",{children:"None"})}),U.map(a=>e.jsx(b,{value:a,children:a},a))]})]})}),e.jsx(i,{item:!0,xs:12,children:e.jsx(O,{multiple:!0,id:"tags-standard",options:D,loading:A,value:t.tags||[],onChange:G,freeSolo:!0,renderTags:(a,l)=>a.map((n,r)=>{const{key:f,...g}=l({index:r});return e.jsx(R,{label:n,...g,size:"small",sx:{height:"22px",borderRadius:4,bgcolor:u=>u.palette.mode==="dark"?o(u.palette.primary.main,.15):o(u.palette.primary.light,.15),color:"primary.main",fontWeight:500,fontSize:"0.7rem",mr:.5,mb:.5,"&:hover":{bgcolor:u=>u.palette.mode==="dark"?o(u.palette.primary.main,.25):o(u.palette.primary.light,.25)}}},f)}),renderInput:a=>e.jsx(d,{...a,variant:"outlined",label:"Tags",placeholder:"Add or select tags",helperText:"Type to see suggestions or add new tags",InputProps:{...a.InputProps,endAdornment:e.jsxs($.Fragment,{children:[A?e.jsx(y,{color:"inherit",size:20}):null,a.InputProps.endAdornment]})}}),PaperComponent:({children:a,...l})=>e.jsx(F,{...l,sx:{boxShadow:3,maxHeight:"200px",overflow:"auto"},children:a}),ListboxProps:{style:{display:"flex",flexWrap:"wrap",gap:"4px",padding:"4px",margin:0,listStyle:"none"}},renderOption:(a,l,{selected:n})=>e.jsx("li",{...a,style:{margin:0,padding:0,width:"auto",listStyle:"none"},children:e.jsx(R,{label:l,size:"small",variant:n?"filled":"outlined",clickable:!0,sx:{height:"22px",borderRadius:4,bgcolor:r=>n?r.palette.mode==="dark"?o(r.palette.primary.main,.35):o(r.palette.primary.light,.35):r.palette.mode==="dark"?o(r.palette.primary.main,.15):o(r.palette.primary.light,.15),color:"primary.main",fontWeight:500,fontSize:"0.7rem",cursor:"pointer",m:.25,"&:hover":{bgcolor:r=>r.palette.mode==="dark"?o(r.palette.primary.main,.25):o(r.palette.primary.light,.25)},display:"inline-flex"}})})})}),e.jsxs(i,{item:!0,xs:12,children:[w&&e.jsx(S,{color:"error",sx:{mb:2},children:w}),e.jsx(Q,{type:"submit",variant:"contained",color:"primary",disabled:k,startIcon:k?e.jsx(y,{size:20}):null,children:k?"Adding...":"Add Package"})]})]})})]}):e.jsx(S,{color:"error",align:"center",children:"Access Denied. You must be an admin to add packages."})};export{V as default};
