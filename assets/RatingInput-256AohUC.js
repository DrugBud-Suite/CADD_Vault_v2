import{c as N,j as n,a as Ee,g as He,r as d,d as _e,_ as ge,ax as pe,u as we,e as Ie,ay as Be,a7 as Oe,b as g,s as Q,f as K,h as fe,i as Pe,az as $e,aA as qe,aB as Te,x as he,y as me,z as ve,D as ye,R as Ue,p as re,al as De,I as Ne,q as le,T as te,at as ke,t as G}from"./index-BUAb653Z.js";const We=N(n.jsx("path",{d:"M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"}),"Star"),Xe=N(n.jsx("path",{d:"M22 9.24l-7.19-.62L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21 12 17.27 18.18 21l-1.63-7.03L22 9.24zM12 15.4l-3.76 2.27 1-4.28-3.32-2.88 4.38-.38L12 6.1l1.71 4.04 4.38.38-3.32 2.88 1 4.28L12 15.4z"}),"StarBorder");function Ye(e){return He("MuiRating",e)}const W=Ee("MuiRating",["root","sizeSmall","sizeMedium","sizeLarge","readOnly","disabled","focusVisible","visuallyHidden","pristine","label","labelEmptyValueActive","icon","iconEmpty","iconFilled","iconHover","iconFocus","iconActive","decimal"]),Je=["value"],Ge=["className","defaultValue","disabled","emptyIcon","emptyLabelText","getLabelText","highlightSelectedOnly","icon","IconContainerComponent","max","name","onChange","onChangeActive","onMouseLeave","onMouseMove","precision","readOnly","size","value"];function Ke(e){const t=e.toString().split(".")[1];return t?t.length:0}function ne(e,t){if(e==null)return e;const a=Math.round(e/t)*t;return Number(a.toFixed(Ke(t)))}const Qe=e=>{const{classes:t,size:a,readOnly:s,disabled:_,emptyValueFocused:z,focusVisible:b}=e,L={root:["root",`size${fe(a)}`,_&&"disabled",b&&"focusVisible",s&&"readOnly"],label:["label","pristine"],labelEmptyValue:[z&&"labelEmptyValueActive"],icon:["icon"],iconEmpty:["iconEmpty"],iconFilled:["iconFilled"],iconHover:["iconHover"],iconFocus:["iconFocus"],iconActive:["iconActive"],decimal:["decimal"],visuallyHidden:["visuallyHidden"]};return Pe(L,Ye,t)},Ze=Q("span",{name:"MuiRating",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:a}=e;return[{[`& .${W.visuallyHidden}`]:t.visuallyHidden},t.root,t[`size${fe(a.size)}`],a.readOnly&&t.readOnly]}})(({theme:e,ownerState:t})=>g({display:"inline-flex",position:"relative",fontSize:e.typography.pxToRem(24),color:"#faaf00",cursor:"pointer",textAlign:"left",width:"min-content",WebkitTapHighlightColor:"transparent",[`&.${W.disabled}`]:{opacity:(e.vars||e).palette.action.disabledOpacity,pointerEvents:"none"},[`&.${W.focusVisible} .${W.iconActive}`]:{outline:"1px solid #999"},[`& .${W.visuallyHidden}`]:$e},t.size==="small"&&{fontSize:e.typography.pxToRem(18)},t.size==="large"&&{fontSize:e.typography.pxToRem(30)},t.readOnly&&{pointerEvents:"none"})),xe=Q("label",{name:"MuiRating",slot:"Label",overridesResolver:({ownerState:e},t)=>[t.label,e.emptyValueFocused&&t.labelEmptyValueActive]})(({ownerState:e})=>g({cursor:"inherit"},e.emptyValueFocused&&{top:0,bottom:0,position:"absolute",outline:"1px solid #999",width:"100%"})),et=Q("span",{name:"MuiRating",slot:"Icon",overridesResolver:(e,t)=>{const{ownerState:a}=e;return[t.icon,a.iconEmpty&&t.iconEmpty,a.iconFilled&&t.iconFilled,a.iconHover&&t.iconHover,a.iconFocus&&t.iconFocus,a.iconActive&&t.iconActive]}})(({theme:e,ownerState:t})=>g({display:"flex",transition:e.transitions.create("transform",{duration:e.transitions.duration.shortest}),pointerEvents:"none"},t.iconActive&&{transform:"scale(1.2)"},t.iconEmpty&&{color:(e.vars||e).palette.action.disabled})),tt=Q("span",{name:"MuiRating",slot:"Decimal",shouldForwardProp:e=>qe(e)&&e!=="iconActive",overridesResolver:(e,t)=>{const{iconActive:a}=e;return[t.decimal,a&&t.iconActive]}})(({iconActive:e})=>g({position:"relative"},e&&{transform:"scale(1.2)"}));function nt(e){const t=ge(e,Je);return n.jsx("span",g({},t))}function ce(e){const{classes:t,disabled:a,emptyIcon:s,focus:_,getLabelText:z,highlightSelectedOnly:b,hover:L,icon:A,IconContainerComponent:y,isActive:w,itemValue:u,labelProps:x,name:S,onBlur:P,onChange:C,onClick:V,onFocus:p,readOnly:$,ownerState:l,ratingValue:m,ratingValueRounded:q}=e,E=b?u===m:u<=m,I=u<=L,j=u<=_,T=u===q,B=pe(),o=n.jsx(et,{as:y,value:u,className:K(t.icon,E?t.iconFilled:t.iconEmpty,I&&t.iconHover,j&&t.iconFocus,w&&t.iconActive),ownerState:g({},l,{iconEmpty:!E,iconFilled:E,iconHover:I,iconFocus:j,iconActive:w}),children:s&&!E?s:A});return $?n.jsx("span",g({},x,{children:o})):n.jsxs(d.Fragment,{children:[n.jsxs(xe,g({ownerState:g({},l,{emptyValueFocused:void 0}),htmlFor:B},x,{children:[o,n.jsx("span",{className:t.visuallyHidden,children:z(u)})]})),n.jsx("input",{className:t.visuallyHidden,onFocus:p,onBlur:P,onChange:C,onClick:V,disabled:a,value:u,id:B,type:"radio",name:S,checked:T})]})}const ot=n.jsx(We,{fontSize:"inherit"}),at=n.jsx(Xe,{fontSize:"inherit"});function it(e){return`${e} Star${e!==1?"s":""}`}const st=d.forwardRef(function(t,a){const s=_e({name:"MuiRating",props:t}),{className:_,defaultValue:z=null,disabled:b=!1,emptyIcon:L=at,emptyLabelText:A="Empty",getLabelText:y=it,highlightSelectedOnly:w=!1,icon:u=ot,IconContainerComponent:x=nt,max:S=5,name:P,onChange:C,onChangeActive:V,onMouseLeave:p,onMouseMove:$,precision:l=1,readOnly:m=!1,size:q="medium",value:E}=s,I=ge(s,Ge),j=pe(P),[T,B]=we({controlled:E,default:z,name:"Rating"}),o=ne(T,l),f=Ie(),[{hover:r,focus:R},h]=d.useState({hover:-1,focus:-1});let F=o;r!==-1&&(F=r),R!==-1&&(F=R);const{isFocusVisibleRef:oe,onBlur:Re,onFocus:be,ref:Se}=Be(),[Ce,Z]=d.useState(!1),ae=d.useRef(),je=Oe(Se,ae,a),Fe=i=>{$&&$(i);const c=ae.current,{right:v,left:J,width:U}=c.getBoundingClientRect();let D;f?D=(v-i.clientX)/U:D=(i.clientX-J)/U;let M=ne(S*D+l/2,l);M=Te(M,l,S),h(O=>O.hover===M&&O.focus===M?O:{hover:M,focus:M}),Z(!1),V&&r!==M&&V(i,M)},Me=i=>{p&&p(i);const c=-1;h({hover:c,focus:c}),V&&r!==c&&V(i,c)},ie=i=>{let c=i.target.value===""?null:parseFloat(i.target.value);r!==-1&&(c=r),B(c),C&&C(i,c)},ze=i=>{i.clientX===0&&i.clientY===0||(h({hover:-1,focus:-1}),B(null),C&&parseFloat(i.target.value)===o&&C(i,null))},Le=i=>{be(i),oe.current===!0&&Z(!0);const c=parseFloat(i.target.value);h(v=>({hover:v.hover,focus:c}))},Ae=i=>{if(r!==-1)return;Re(i),oe.current===!1&&Z(!1);const c=-1;h(v=>({hover:v.hover,focus:c}))},[Ve,se]=d.useState(!1),k=g({},s,{defaultValue:z,disabled:b,emptyIcon:L,emptyLabelText:A,emptyValueFocused:Ve,focusVisible:Ce,getLabelText:y,icon:u,IconContainerComponent:x,max:S,precision:l,readOnly:m,size:q}),H=Qe(k);return n.jsxs(Ze,g({ref:je,onMouseMove:Fe,onMouseLeave:Me,className:K(H.root,_,m&&"MuiRating-readOnly"),ownerState:k,role:m?"img":null,"aria-label":m?y(F):null},I,{children:[Array.from(new Array(S)).map((i,c)=>{const v=c+1,J={classes:H,disabled:b,emptyIcon:L,focus:R,getLabelText:y,highlightSelectedOnly:w,hover:r,icon:u,IconContainerComponent:x,name:j,onBlur:Ae,onChange:ie,onClick:ze,onFocus:Le,ratingValue:F,ratingValueRounded:o,readOnly:m,ownerState:k},U=v===Math.ceil(F)&&(r!==-1||R!==-1);if(l<1){const D=Array.from(new Array(1/l));return n.jsx(tt,{className:K(H.decimal,U&&H.iconActive),ownerState:k,iconActive:U,children:D.map((M,O)=>{const ee=ne(v-1+(O+1)*l,l);return n.jsx(ce,g({},J,{isActive:!1,itemValue:ee,labelProps:{style:D.length-1===O?{}:{width:ee===F?`${(O+1)*l*100}%`:"0%",overflow:"hidden",position:"absolute"}}}),ee)})},v)}return n.jsx(ce,g({},J,{isActive:U,itemValue:v}),v)}),!m&&!b&&n.jsxs(xe,{className:K(H.label,H.labelEmptyValue),ownerState:k,children:[n.jsx("input",{className:H.visuallyHidden,value:"",id:`${j}-empty`,type:"radio",name:j,checked:o==null,onFocus:()=>se(!0),onBlur:()=>se(!1),onChange:ie}),n.jsx("span",{className:H.visuallyHidden,children:A})]})]}))}),ft=N(n.jsx("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m-5 14H7v-2h7zm3-4H7v-2h10zm0-4H7V7h10z"}),"Article"),ht=N(n.jsx("path",{d:"M9.4 16.6 4.8 12l4.6-4.6L8 6l-6 6 6 6zm5.2 0 4.6-4.6-4.6-4.6L16 6l6 6-6 6z"}),"Code"),mt=N(n.jsx("path",{d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2m6.93 6h-2.95c-.32-1.25-.78-2.45-1.38-3.56 1.84.63 3.37 1.91 4.33 3.56M12 4.04c.83 1.2 1.48 2.53 1.91 3.96h-3.82c.43-1.43 1.08-2.76 1.91-3.96M4.26 14C4.1 13.36 4 12.69 4 12s.1-1.36.26-2h3.38c-.08.66-.14 1.32-.14 2 0 .68.06 1.34.14 2zm.82 2h2.95c.32 1.25.78 2.45 1.38 3.56-1.84-.63-3.37-1.9-4.33-3.56m2.95-8H5.08c.96-1.66 2.49-2.93 4.33-3.56C8.81 5.55 8.35 6.75 8.03 8M12 19.96c-.83-1.2-1.48-2.53-1.91-3.96h3.82c-.43 1.43-1.08 2.76-1.91 3.96M14.34 14H9.66c-.09-.66-.16-1.32-.16-2 0-.68.07-1.35.16-2h4.68c.09.65.16 1.32.16 2 0 .68-.07 1.34-.16 2m.25 5.56c.6-1.11 1.06-2.31 1.38-3.56h2.95c-.96 1.65-2.49 2.93-4.33 3.56M16.36 14c.08-.66.14-1.32.14-2 0-.68-.06-1.34-.14-2h3.38c.16.64.26 1.31.26 2s-.1 1.36-.26 2z"}),"Language"),vt=N(n.jsx("path",{d:"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1M8 13h8v-2H8zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5"}),"Link");var X={},ue;function rt(){if(ue)return X;ue=1;var e=he();Object.defineProperty(X,"__esModule",{value:!0}),X.default=void 0;var t=e(me()),a=ve();return X.default=(0,t.default)((0,a.jsx)("path",{d:"M12 17.27 18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"}),"Star"),X}var lt=rt();const ct=ye(lt);var Y={},de;function ut(){if(de)return Y;de=1;var e=he();Object.defineProperty(Y,"__esModule",{value:!0}),Y.default=void 0;var t=e(me()),a=ve();return Y.default=(0,t.default)((0,a.jsx)("path",{d:"m22 9.24-7.19-.62L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21 12 17.27 18.18 21l-1.63-7.03zM12 15.4l-3.76 2.27 1-4.28-3.32-2.88 4.38-.38L12 6.1l1.71 4.04 4.38.38-3.32 2.88 1 4.28z"}),"StarBorder"),Y}var dt=ut();const gt=ye(dt),yt=({packageId:e,initialAverageRating:t,initialRatingsCount:a})=>{const{currentUser:s}=Ue(),[_,z]=d.useState(t),[b,L]=d.useState(a),[A,y]=d.useState(null),[w,u]=d.useState(!1),[x,S]=d.useState(!1),[P,C]=d.useState(null),[V,p]=d.useState(null),$=async()=>{if(s){u(!0);try{const{data:o,error:f}=await G.from("ratings").select("rating").eq("user_id",s.id).eq("package_id",e).limit(1);f?console.error("Error fetching user rating:",f):o&&o.length>0?(y(o[0].rating),p(o[0].rating)):(y(null),p(null))}catch(o){console.error("Unexpected error fetching user rating:",o)}finally{u(!1)}}},l=async()=>{try{const{data:o,error:f}=await G.from("packages").select("average_rating, ratings_count").eq("id",e).limit(1);if(f)console.error("Error fetching aggregated rating:",f);else if(o&&o.length>0){const r=o[0].average_rating??0,R=o[0].ratings_count??0;z(r),L(R);const h=new CustomEvent("package-rating-updated",{detail:{packageId:e,newAverageRating:r,newRatingsCount:R},bubbles:!0,cancelable:!1,composed:!0});document.dispatchEvent(h),console.log(`Rating update event dispatched for package ${e}`)}}catch(o){console.error("Unexpected error fetching aggregated rating:",o)}};d.useEffect(()=>{s?$():(y(null),p(null)),l()},[s,e]);const m=o=>{if(!s){console.log("User must be logged in to rate.");return}C(o.currentTarget),p(A)},q=()=>{C(null)},E=async(o,f)=>{if(!(!s||f===null)){S(!0),p(f);try{const{data:r,error:R}=await G.from("ratings").select("id").eq("user_id",s.id).eq("package_id",e).limit(1),h=r&&r.length>0?r[0]:null;if(R)throw R;const{error:F}=await G.from("ratings").upsert({id:h==null?void 0:h.id,user_id:s.id,package_id:e,rating:f,created_at:h?void 0:new Date().toISOString()});F?(console.error("Error submitting rating:",F),p(A)):(y(f),q(),setTimeout(async()=>{await l()},200))}catch(r){console.error("Unexpected error submitting rating:",r),p(A)}finally{S(!1)}}},I=!!P,j=I?`rating-popover-${e}`:void 0,T=_??0,B=b??0;return n.jsxs(re,{sx:{display:"flex",alignItems:"center",gap:.5},children:[n.jsx(De,{title:s?"Rate this package":"Login to rate",children:n.jsxs("span",{children:[" ",n.jsx(Ne,{size:"small",onClick:m,"aria-describedby":j,disabled:w||x||!s,sx:{p:.5},children:w||x?n.jsx(le,{size:20}):n.jsx(ct,{fontSize:"inherit",sx:{color:T>0?"warning.main":"action.disabled"}})})]})}),n.jsx(te,{variant:"body2",sx:{fontWeight:"medium"},children:T.toFixed(1)}),n.jsxs(te,{variant:"body2",color:"text.secondary",children:["(",B,")"]}),n.jsx(ke,{id:j,open:I,anchorEl:P,onClose:q,anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"},children:n.jsxs(re,{sx:{p:2,display:"flex",flexDirection:"column",alignItems:"center"},children:[n.jsx(te,{variant:"subtitle2",gutterBottom:!0,sx:{color:o=>o.palette.text.primary},children:"Your Rating"}),n.jsx(st,{name:`rating-${e}`,value:V,onChange:E,precision:1,emptyIcon:n.jsx(gt,{fontSize:"inherit"}),disabled:x}),x&&n.jsx(le,{size:20,sx:{mt:1}})]})})]})};export{ft as A,ht as C,mt as L,yt as R,vt as a};
