import{W as M,v as G,r as n,w as b,j as e,t as U,y as w,C as z,X as B,T as O,ah as o,F as S,ai as T,S as W,M as m,aj as q,Q as H,A,L as Y,n as f}from"./index-QxSUAMeM.js";import{G as s}from"./Grid-D4ArmYgK.js";const X=()=>{const F=M(),{currentUser:h,loading:p}=G(),[a,g]=n.useState({package_name:"",description:"",publication_url:"",webserver_url:"",repo_url:"",link_url:"",license:"",tags:[],folder:"",category:"",suggestion_reason:""}),[x,v]=n.useState(!1),[_,c]=n.useState(null),[j,y]=n.useState(null),P=b(t=>t.allAvailableTags),[E,I]=n.useState([]),[L,k]=n.useState([]);n.useEffect(()=>{c(!p&&!h?"You must be logged in to suggest a package.":null)},[h,p,F]),n.useEffect(()=>{const t=b.getState().allAvailableFolders;I(t)},[]),n.useEffect(()=>{if(a.folder){const t=b.getState().allAvailableCategories[a.folder]||[];k(t)}else k([])},[a.folder]);const u=t=>{const{name:r,value:i}=t.target;g(l=>({...l,[r]:i})),r==="folder"&&g(l=>({...l,category:""}))},C=t=>{const{name:r,value:i}=t.target;g(l=>({...l,[r]:i})),r==="folder"&&g(l=>({...l,category:""}))},R=(t,r)=>{g(i=>({...i,tags:r}))},D=async t=>{if(t.preventDefault(),c(null),y(null),!h){c("You must be logged in to suggest a package.");return}if(!a.package_name){c("Package Name is required.");return}v(!0);try{const r={suggested_by_user_id:h.id,package_name:a.package_name||"",description:a.description||void 0,publication_url:a.publication_url||void 0,webserver_url:a.webserver_url||void 0,repo_url:a.repo_url||void 0,link_url:a.link_url||void 0,license:a.license||void 0,suggestion_reason:a.suggestion_reason||void 0},{data:i,error:l}=await f.from("package_suggestions").insert([r]).select("id").single();if(l)throw l;if(a.tags&&a.tags.length>0){const{error:d}=await f.rpc("update_suggestion_tags",{suggestion_uuid:i.id,new_tags:a.tags});if(d)throw d}if(a.folder&&a.category){const{error:d}=await f.rpc("update_suggestion_folder_category",{suggestion_uuid:i.id,folder_name:a.folder,category_name:a.category});if(d)throw d}y("Package suggestion submitted successfully! It will be reviewed by an admin."),g({package_name:"",description:"",publication_url:"",webserver_url:"",repo_url:"",link_url:"",license:"",tags:[],folder:"",category:"",suggestion_reason:""})}catch(r){console.error("Error submitting package suggestion: ",r.message),c(`Failed to submit suggestion: ${r.message}`)}finally{v(!1)}};return p?e.jsx(U,{display:"flex",justifyContent:"center",alignItems:"center",height:"50vh",children:e.jsx(w,{})}):e.jsx(z,{maxWidth:"md",children:e.jsxs(B,{elevation:3,sx:{p:{xs:2,md:4},mt:4,mb:4,background:t=>t.palette.mode==="dark"?"linear-gradient(135deg, rgba(30,30,30,0.8) 0%, rgba(23,23,23,0.8) 100%)":"linear-gradient(135deg, rgba(255,255,255,0.8) 0%, rgba(249,250,251,0.8) 100%)",backdropFilter:"blur(8px)",border:0,overflow:"hidden",borderRadius:2},children:[e.jsx(O,{variant:"h4",gutterBottom:!0,component:"h1",sx:{textAlign:"center",mb:3,color:t=>(t.palette.mode==="dark",t.palette.text.primary)},children:"Suggest a New Package"}),e.jsx("form",{onSubmit:D,children:e.jsxs(s,{container:!0,spacing:3,children:[e.jsx(s,{item:!0,xs:12,children:e.jsx(o,{label:"Package Name",name:"package_name",value:a.package_name,onChange:u,required:!0,fullWidth:!0,variant:"outlined",helperText:"The primary name of the software or tool."})}),e.jsx(s,{item:!0,xs:12,children:e.jsx(o,{label:"Description",name:"description",value:a.description,onChange:u,multiline:!0,rows:3,fullWidth:!0,variant:"outlined",helperText:"A brief summary of what the package does."})}),e.jsx(s,{item:!0,xs:12,sm:6,children:e.jsx(o,{label:"Publication URL (e.g., DOI link)",name:"publication_url",value:a.publication_url,onChange:u,fullWidth:!0,variant:"outlined",type:"url"})}),e.jsx(s,{item:!0,xs:12,sm:6,children:e.jsx(o,{label:"Webserver/Homepage URL",name:"webserver_url",value:a.webserver_url,onChange:u,fullWidth:!0,variant:"outlined",type:"url"})}),e.jsx(s,{item:!0,xs:12,sm:6,children:e.jsx(o,{label:"Code Repository URL (e.g., GitHub)",name:"repo_url",value:a.repo_url,onChange:u,fullWidth:!0,variant:"outlined",type:"url"})}),e.jsx(s,{item:!0,xs:12,sm:6,children:e.jsx(o,{label:"Other Relevant Link",name:"link_url",value:a.link_url,onChange:u,fullWidth:!0,variant:"outlined",type:"url"})}),e.jsx(s,{item:!0,xs:12,sm:6,children:e.jsx(o,{label:"License (e.g., MIT, GPL-3.0)",name:"license",value:a.license,onChange:u,fullWidth:!0,variant:"outlined"})}),e.jsx(s,{item:!0,xs:12,sm:6,children:e.jsxs(S,{fullWidth:!0,variant:"outlined",children:[e.jsx(T,{id:"folder-label",children:"Folder"}),e.jsxs(W,{labelId:"folder-label",id:"folder",name:"folder",value:a.folder||"",onChange:C,label:"Folder",children:[e.jsx(m,{value:"",children:e.jsx("em",{children:"None"})}),E.map(t=>e.jsx(m,{value:t,children:t},t))]})]})}),e.jsx(s,{item:!0,xs:12,sm:6,children:e.jsxs(S,{fullWidth:!0,variant:"outlined",disabled:!a.folder,children:[e.jsx(T,{id:"category-label",children:"Category"}),e.jsxs(W,{labelId:"category-label",id:"category",name:"category",value:a.category||"",onChange:C,label:"Category",children:[e.jsx(m,{value:"",children:e.jsx("em",{children:"None"})}),L.map(t=>e.jsx(m,{value:t,children:t},t))]})]})}),e.jsx(s,{item:!0,xs:12,children:e.jsx(q,{multiple:!0,id:"tags-suggest",options:P,value:a.tags||[],onChange:R,freeSolo:!0,renderTags:(t,r)=>t.map((i,l)=>{const{key:d,...N}=r({index:l});return e.jsx(H,{variant:"outlined",label:i,...N},d)}),renderInput:t=>e.jsx(o,{...t,variant:"outlined",label:"Tags",placeholder:"Add or select tags",helperText:"Keywords to help categorize the package."})})}),e.jsx(s,{item:!0,xs:12,children:e.jsx(o,{label:"Reason for Suggestion (Optional)",name:"suggestion_reason",value:a.suggestion_reason,onChange:u,multiline:!0,rows:3,fullWidth:!0,variant:"outlined",helperText:"Why do you think this package should be added?"})}),e.jsxs(s,{item:!0,xs:12,children:[_&&e.jsx(A,{severity:"error",sx:{mb:2},children:_}),j&&e.jsx(A,{severity:"success",sx:{mb:2},children:j}),e.jsx(Y,{type:"submit",variant:"contained",color:"primary",disabled:x||!h,startIcon:x?e.jsx(w,{size:20}):null,fullWidth:!0,size:"large",children:x?"Submitting...":"Submit Suggestion"})]})]})})]})})};export{X as default};
