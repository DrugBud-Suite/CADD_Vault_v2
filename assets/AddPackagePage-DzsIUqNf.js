import{Q as I,n as D,r as u,o as x,j as e,q as E,t as f,T as v,R as C,G as s,a3 as o,a4 as z,N as A,m as l,a5 as F,H as N,a2 as U}from"./index-lkaWrI8o.js";const H=()=>{const h=I(),{isAdmin:g,loading:k}=D(),[t,y]=u.useState({package_name:"",description:"",publication:"",webserver:"",repo_link:"",link:"",license:"",tags:[]}),[b,j]=u.useState(!1),[w,m]=u.useState(null),T=x(a=>a.allAvailableTags),P=x(a=>a.originalPackages.length>0),[S,_]=u.useState(!0);u.useEffect(()=>{!k&&!g&&(console.warn("Access denied: User is not an admin."),h("/"))},[g,k,h]),u.useEffect(()=>{g&&_(!P)},[g,P]);const d=a=>{const{name:n,value:i}=a.target;y(r=>({...r,[n]:i}))},L=(a,n)=>{y(i=>({...i,tags:n}))},W=async a=>{if(a.preventDefault(),m(null),!t.package_name){m("Package Name (package_name) is required.");return}j(!0);try{const n={package_name:t.package_name||"",description:t.description||"",publication:t.publication||"",webserver:t.webserver||"",repo_link:t.repo_link||"",link:t.link||"",license:t.license||"",tags:t.tags||[],last_updated:new Date().toISOString()},{data:i,error:r}=await U.from("packages").insert([n]).select();if(r)throw r;const p=i==null?void 0:i[0];p?(console.log("Package added successfully:",p),x.getState().setOriginalPackagesAndDeriveMetadata([...x.getState().originalPackages,p]),h(`/package/${encodeURIComponent(p.id)}`)):(m("Failed to retrieve the newly added package data."),console.error("Insert successful but no data returned."))}catch(n){console.error("Error adding package: ",n.message),m(`Failed to add package: ${n.message}`)}finally{j(!1)}};return k?e.jsx(E,{display:"flex",justifyContent:"center",alignItems:"center",height:"50vh",children:e.jsx(f,{})}):g?e.jsxs(C,{elevation:3,sx:{p:3,m:2},children:[e.jsx(v,{variant:"h4",gutterBottom:!0,component:"div",children:"Add New Package"}),e.jsx("form",{onSubmit:W,children:e.jsxs(s,{container:!0,spacing:3,children:[e.jsx(s,{item:!0,xs:12,children:e.jsx(o,{id:"package_name",label:"Package Name (package_name)",name:"package_name",value:t.package_name,onChange:d,required:!0,fullWidth:!0,variant:"outlined"})}),e.jsx(s,{item:!0,xs:12,children:e.jsx(o,{id:"description",label:"Description",name:"description",value:t.description,onChange:d,multiline:!0,rows:4,fullWidth:!0,variant:"outlined"})}),e.jsx(s,{item:!0,xs:12,sm:6,children:e.jsx(o,{id:"publication",label:"Publication URL",name:"publication",value:t.publication,onChange:d,fullWidth:!0,variant:"outlined",type:"url"})}),e.jsx(s,{item:!0,xs:12,sm:6,children:e.jsx(o,{id:"webserver",label:"Webserver/Homepage URL",name:"webserver",value:t.webserver,onChange:d,fullWidth:!0,variant:"outlined",type:"url"})}),e.jsx(s,{item:!0,xs:12,sm:6,children:e.jsx(o,{id:"repo_link",label:"Code Repository Link (GitHub or other)",name:"repo_link",value:t.repo_link,onChange:d,fullWidth:!0,variant:"outlined",type:"url",helperText:"Enter the URL for the code repository"})}),e.jsx(s,{item:!0,xs:12,sm:6,children:e.jsx(o,{id:"link",label:"General Link",name:"link",value:t.link,onChange:d,fullWidth:!0,variant:"outlined",type:"url",helperText:"Any other relevant link (not publication or webserver)"})}),e.jsx(s,{item:!0,xs:12,sm:6,children:e.jsx(o,{id:"license",label:"License",name:"license",value:t.license,onChange:d,fullWidth:!0,variant:"outlined"})}),e.jsx(s,{item:!0,xs:12,children:e.jsx(z,{multiple:!0,id:"tags-standard",options:T,loading:S,value:t.tags||[],onChange:L,freeSolo:!0,renderTags:(a,n)=>a.map((i,r)=>{const{key:p,...R}=n({index:r});return e.jsx(A,{label:i,...R,size:"small",sx:{height:"22px",borderRadius:4,bgcolor:c=>c.palette.mode==="dark"?l(c.palette.primary.main,.15):l(c.palette.primary.light,.15),color:"primary.main",fontWeight:500,fontSize:"0.7rem",mr:.5,mb:.5,"&:hover":{bgcolor:c=>c.palette.mode==="dark"?l(c.palette.primary.main,.25):l(c.palette.primary.light,.25)}}},p)}),renderInput:a=>e.jsx(o,{...a,variant:"outlined",label:"Tags",placeholder:"Add or select tags",helperText:"Type to see suggestions or add new tags",InputProps:{...a.InputProps,endAdornment:e.jsxs(F.Fragment,{children:[S?e.jsx(f,{color:"inherit",size:20}):null,a.InputProps.endAdornment]})}}),PaperComponent:({children:a,...n})=>e.jsx(C,{...n,sx:{boxShadow:3,maxHeight:"200px",overflow:"auto"},children:a}),ListboxProps:{style:{display:"flex",flexWrap:"wrap",gap:"4px",padding:"4px",margin:0,listStyle:"none"}},renderOption:(a,n,{selected:i})=>e.jsx("li",{...a,style:{margin:0,padding:0,width:"auto",listStyle:"none"},children:e.jsx(A,{label:n,size:"small",variant:i?"filled":"outlined",clickable:!0,sx:{height:"22px",borderRadius:4,bgcolor:r=>i?r.palette.mode==="dark"?l(r.palette.primary.main,.35):l(r.palette.primary.light,.35):r.palette.mode==="dark"?l(r.palette.primary.main,.15):l(r.palette.primary.light,.15),color:"primary.main",fontWeight:500,fontSize:"0.7rem",cursor:"pointer",m:.25,"&:hover":{bgcolor:r=>r.palette.mode==="dark"?l(r.palette.primary.main,.25):l(r.palette.primary.light,.25)},display:"inline-flex"}})})})}),e.jsxs(s,{item:!0,xs:12,children:[w&&e.jsx(v,{color:"error",sx:{mb:2},children:w}),e.jsx(N,{type:"submit",variant:"contained",color:"primary",disabled:b,startIcon:b?e.jsx(f,{size:20}):null,children:b?"Adding...":"Add Package"})]})]})})]}):e.jsx(v,{color:"error",align:"center",children:"Access Denied. You must be an admin to add packages."})};export{H as default};
