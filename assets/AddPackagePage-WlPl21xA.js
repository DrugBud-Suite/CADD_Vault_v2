import{Q as W,R as L,r as g,j as e,p as R,q as w,T as k,U as C,G as s,a3 as c,a4 as D,N as T,m as l,H as U,t as _}from"./index-Cq7ylKjH.js";const F=()=>{const h=W(),{isAdmin:u,loading:x}=L(),[r,y]=g.useState({package_name:"",description:"",publication:"",webserver:"",repo_link:"",link:"",license:"",tags:[]}),[f,v]=g.useState(!1),[j,m]=g.useState(null),[P,A]=g.useState([]);g.useEffect(()=>{!x&&!u&&(console.warn("Access denied: User is not an admin."),h("/"))},[u,x,h]),g.useEffect(()=>{u&&(async()=>{if(u)try{const{data:t,error:n}=await _.from("packages").select("tags");if(n)throw n;const a=new Set;t.forEach(o=>{o.tags&&Array.isArray(o.tags)&&o.tags.forEach(b=>a.add(b))}),A(Array.from(a).sort())}catch(t){console.error("Error fetching existing tags:",t.message),m("Failed to load existing tags.")}})()},[u]);const d=i=>{const{name:t,value:n}=i.target;y(a=>({...a,[t]:n}))},E=(i,t)=>{y(n=>({...n,tags:t}))},S=async i=>{if(i.preventDefault(),m(null),!r.package_name){m("Package Name (package_name) is required.");return}v(!0);try{const t={package_name:r.package_name||"",description:r.description||"",publication:r.publication||"",webserver:r.webserver||"",repo_link:r.repo_link||"",link:r.link||"",license:r.license||"",tags:r.tags||[]},{data:n,error:a}=await _.from("packages").insert([t]).select();if(a)throw a;const o=n==null?void 0:n[0];o?(console.log("Package added successfully:",o),h(`/package/${encodeURIComponent(o.id)}`)):(m("Failed to retrieve the newly added package data."),console.error("Insert successful but no data returned."))}catch(t){console.error("Error adding package: ",t.message),m(`Failed to add package: ${t.message}`)}finally{v(!1)}};return x?e.jsx(R,{display:"flex",justifyContent:"center",alignItems:"center",height:"50vh",children:e.jsx(w,{})}):u?e.jsxs(C,{elevation:3,sx:{p:3,m:2},children:[e.jsx(k,{variant:"h4",gutterBottom:!0,component:"div",children:"Add New Package"}),e.jsx("form",{onSubmit:S,children:e.jsxs(s,{container:!0,spacing:3,children:[e.jsx(s,{item:!0,xs:12,children:e.jsx(c,{id:"package_name",label:"Package Name (package_name)",name:"package_name",value:r.package_name,onChange:d,required:!0,fullWidth:!0,variant:"outlined"})}),e.jsx(s,{item:!0,xs:12,children:e.jsx(c,{id:"description",label:"Description",name:"description",value:r.description,onChange:d,multiline:!0,rows:4,fullWidth:!0,variant:"outlined"})}),e.jsx(s,{item:!0,xs:12,sm:6,children:e.jsx(c,{id:"publication",label:"Publication URL",name:"publication",value:r.publication,onChange:d,fullWidth:!0,variant:"outlined",type:"url"})}),e.jsx(s,{item:!0,xs:12,sm:6,children:e.jsx(c,{id:"webserver",label:"Webserver/Homepage URL",name:"webserver",value:r.webserver,onChange:d,fullWidth:!0,variant:"outlined",type:"url"})}),e.jsx(s,{item:!0,xs:12,sm:6,children:e.jsx(c,{id:"repo_link",label:"Code Repository Link (GitHub or other)",name:"repo_link",value:r.repo_link,onChange:d,fullWidth:!0,variant:"outlined",type:"url",helperText:"Enter the URL for the code repository"})}),e.jsx(s,{item:!0,xs:12,sm:6,children:e.jsx(c,{id:"link",label:"General Link",name:"link",value:r.link,onChange:d,fullWidth:!0,variant:"outlined",type:"url",helperText:"Any other relevant link (not publication or webserver)"})}),e.jsx(s,{item:!0,xs:12,sm:6,children:e.jsx(c,{id:"license",label:"License",name:"license",value:r.license,onChange:d,fullWidth:!0,variant:"outlined"})}),e.jsx(s,{item:!0,xs:12,children:e.jsx(D,{multiple:!0,id:"tags-standard",options:P,getOptionLabel:i=>i,value:r.tags||[],onChange:E,freeSolo:!0,renderTags:(i,t)=>i.map((n,a)=>{const{key:o,...b}=t({index:a});return e.jsx(T,{label:n,...b,size:"small",sx:{height:"22px",borderRadius:4,bgcolor:p=>p.palette.mode==="dark"?l(p.palette.primary.main,.15):l(p.palette.primary.light,.15),color:"primary.main",fontWeight:500,fontSize:"0.7rem",mr:.5,mb:.5,"&:hover":{bgcolor:p=>p.palette.mode==="dark"?l(p.palette.primary.main,.25):l(p.palette.primary.light,.25)}}},o)}),renderInput:i=>e.jsx(c,{...i,variant:"outlined",label:"Tags",placeholder:"Add or select tags",helperText:"Type to see suggestions or add new tags"}),PaperComponent:({children:i,...t})=>e.jsx(C,{...t,sx:{boxShadow:3,maxHeight:"200px",overflow:"auto"},children:i}),ListboxProps:{style:{display:"flex",flexWrap:"wrap",gap:"4px",padding:"4px",margin:0,listStyle:"none"}},renderOption:(i,t,{selected:n})=>e.jsx("li",{...i,style:{margin:0,padding:0,width:"auto",listStyle:"none"},children:e.jsx(T,{label:t,size:"small",variant:n?"filled":"outlined",clickable:!0,sx:{height:"22px",borderRadius:4,bgcolor:a=>n?a.palette.mode==="dark"?l(a.palette.primary.main,.35):l(a.palette.primary.light,.35):a.palette.mode==="dark"?l(a.palette.primary.main,.15):l(a.palette.primary.light,.15),color:"primary.main",fontWeight:500,fontSize:"0.7rem",cursor:"pointer",m:.25,"&:hover":{bgcolor:a=>a.palette.mode==="dark"?l(a.palette.primary.main,.25):l(a.palette.primary.light,.25)},display:"inline-flex"}})})})}),e.jsxs(s,{item:!0,xs:12,children:[j&&e.jsx(k,{color:"error",sx:{mb:2},children:j}),e.jsx(U,{type:"submit",variant:"contained",color:"primary",disabled:f,startIcon:f?e.jsx(w,{size:20}):null,children:f?"Adding...":"Add Package"})]})]})})]}):e.jsx(k,{color:"error",align:"center",children:"Access Denied. You must be an admin to add packages."})};export{F as default};
