import{x as z,y as O,z as W,D as B,Q as N,R as F,r as n,t as v,j as e,p as H,q as L,C as m,A as S,T as b,af as Y,U as $,ag as J,ah as Q,ai as w,aj as a,ak as V,N as G,al as d,I as E,am as K}from"./index-BUAb653Z.js";import{E as U}from"./Edit-ChCja0CX.js";var l={},C;function X(){if(C)return l;C=1;var o=z();Object.defineProperty(l,"__esModule",{value:!0}),l.default=void 0;var s=o(O()),i=W();return l.default=(0,s.default)((0,i.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM19 4h-3.5l-1-1h-5l-1 1H5v2h14z"}),"Delete"),l}var Z=X();const ee=B(Z),ae=()=>{const o=N(),{currentUser:s,loading:i,isAdmin:c}=F(),[f,u]=n.useState([]),[D,j]=n.useState(!0),[y,h]=n.useState(null),[_,g]=n.useState(null),[q,x]=n.useState(!1),p=n.useCallback(async()=>{if(s){j(!0),h(null);try{const{data:t,error:r}=await v.from("package_suggestions").select("*").eq("suggested_by_user_id",s.id).order("created_at",{ascending:!1});if(r)throw r;u(t||[])}catch(t){console.error("Error fetching suggestions:",t.message),h(`Failed to load your suggestions: ${t.message}`),u([])}finally{j(!1)}}},[s]);n.useEffect(()=>{!i&&!s?o("/login"):s&&p()},[s,i,o,p]);const k=async t=>{if(window.confirm("Are you sure you want to delete this pending suggestion? This action cannot be undone.")&&s)try{const{error:r}=await v.from("package_suggestions").delete().eq("id",t).eq("status","pending").eq("suggested_by_user_id",s.id);if(r)throw r;u(I=>I.filter(P=>P.id!==t))}catch(r){h(`Failed to delete suggestion: ${r.message}`)}},M=t=>{t.status==="pending"&&t.suggested_by_user_id===(s==null?void 0:s.id)||c?(g(t),x(!0)):alert("You can only edit your own suggestions that are still pending.")},T=()=>{g(null),x(!1)},R=()=>{p(),x(!1),g(null)},A=t=>{switch(t){case"pending":return"warning";case"approved":return"success";case"rejected":return"error";case"added":return"info";default:return"default"}};return i||D?e.jsx(H,{display:"flex",justifyContent:"center",alignItems:"center",height:"50vh",children:e.jsx(L,{})}):y?e.jsx(m,{maxWidth:"md",sx:{mt:4},children:e.jsx(S,{severity:"error",children:y})}):s?e.jsxs(m,{maxWidth:"lg",sx:{mt:4,mb:4},children:[e.jsx(b,{variant:"h4",gutterBottom:!0,component:"h1",sx:{mb:3,color:t=>(t.palette.mode==="dark",t.palette.text.primary)},children:"My Package Suggestions"}),f.length===0?e.jsx(b,{children:"You haven't submitted any package suggestions yet."}):e.jsx(Y,{component:$,elevation:2,children:e.jsxs(J,{sx:{minWidth:650},"aria-label":"my suggestions table",children:[e.jsx(Q,{children:e.jsxs(w,{children:[e.jsx(a,{children:"Package Name"}),e.jsx(a,{children:"Status"}),e.jsx(a,{children:"Submitted"}),e.jsx(a,{children:"Reason"}),e.jsx(a,{children:"Admin Notes"}),e.jsx(a,{align:"right",children:"Actions"})]})}),e.jsx(V,{children:f.map(t=>e.jsxs(w,{hover:!0,children:[e.jsx(a,{component:"th",scope:"row",children:t.package_name}),e.jsx(a,{children:e.jsx(G,{label:t.status,color:A(t.status),size:"small"})}),e.jsx(a,{children:new Date(t.created_at).toLocaleDateString()}),e.jsx(a,{sx:{maxWidth:200,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.jsx(d,{title:t.suggestion_reason||"",children:e.jsx("span",{children:t.suggestion_reason||"-"})})}),e.jsx(a,{sx:{maxWidth:200,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.jsx(d,{title:t.admin_notes||"",children:e.jsx("span",{children:t.admin_notes||"-"})})}),e.jsxs(a,{align:"right",children:[(t.status==="pending"&&t.suggested_by_user_id===s.id||c)&&e.jsx(d,{title:"Edit Suggestion",children:e.jsx(E,{size:"small",onClick:()=>M(t),sx:{color:"primary.main"},children:e.jsx(U,{})})}),t.status==="pending"&&t.suggested_by_user_id===s.id&&e.jsx(d,{title:"Delete Suggestion",children:e.jsx(E,{size:"small",onClick:()=>k(t.id),sx:{ml:1,color:"error.main"},children:e.jsx(ee,{})})})]})]},t.id))})]})}),_&&e.jsx(K,{open:q,onClose:T,suggestion:_,onSaveSuccess:R,isAdmin:!!c})]}):e.jsx(m,{maxWidth:"md",sx:{mt:4},children:e.jsx(S,{severity:"info",children:"Please log in to view your suggestions."})})};export{ae as default};
