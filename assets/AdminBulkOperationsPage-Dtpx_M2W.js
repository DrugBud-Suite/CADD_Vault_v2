import{c as pe,j as e,Q as ma,N as fa,r as o,n as ee,o as ja,a2 as b,C as ae,q as F,A as h,T as c,p as u,G as i,R as q,F as D,a6 as M,S as U,M as v,a4 as te,K as O,m as j,a3 as W,E,at as Ne,ap as We,I as ze,ak as De,al as Me,am as Ue,an as re,ao as x,aq as _e}from"./index-DRiBbmay.js";import{T as ya,a as xe}from"./Tabs-CcPpNTSK.js";import{F as ba,C as He}from"./FolderOutlined-DcmGYGDR.js";const Re=pe(e.jsx("path",{d:"M13 7h-2v4H7v2h4v4h2v-4h4v-2h-4zm-1-5C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8"}),"AddCircleOutline"),Le=pe(e.jsx("path",{d:"M19 9h-4V3H9v6H5l7 7zM5 18v2h14v-2z"}),"FileDownload"),qe=pe(e.jsx("path",{d:"M20 6h-8l-2-2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2m0 12H4V6h5.17l2 2H20zm-6.92-3.96L12.39 17 15 15.47 17.61 17l-.69-2.96 2.3-1.99-3.03-.26L15 9l-1.19 2.79-3.03.26z"}),"FolderSpecialOutlined"),Ta=()=>{var Ie;const{currentUser:Be,loading:Ye,isAdmin:_}=ma(),f=fa(),[$,Je]=o.useState(0),[n,C]=o.useState({operation:"update",filterOptions:{folder:null,category:null,tags:[]},updateOptions:{folder:null,category:null,addTags:[],removeTags:[]}}),[l,B]=o.useState({newFolder:"",selectedFolder:"",newCategory:""}),[d,Y]=o.useState({oldTag:"",newTag:""}),[se,J]=o.useState(!1),[H,V]=o.useState(!1),[me,z]=o.useState(null),[fe,je]=o.useState(null),[ye,I]=o.useState(null),[be,ve]=o.useState(null),[le,ne]=o.useState(!1),[Ce,m]=o.useState(null),[we,ie]=o.useState(null),[oe,G]=o.useState(0),[N,K]=o.useState([]),[de,Te]=o.useState(!1),[Q,ce]=o.useState(!1),[ge,Fe]=o.useState(!1),[Oe,k]=o.useState(null),[ke,Se]=o.useState(null),[R,he]=o.useState(null),[w,Pe]=o.useState([]),[X,Ae]=o.useState(!1),[Ve,L]=o.useState(!1),{allAvailableTags:S,allAvailableFolders:T,allAvailableCategories:y}=ee(ja(a=>({allAvailableTags:a.allAvailableTags,allAvailableFolders:a.allAvailableFolders,allAvailableCategories:a.allAvailableCategories}))),Ge=n.filterOptions.folder&&y[n.filterOptions.folder]?y[n.filterOptions.folder]:[],Ee=o.useCallback(async()=>{Ae(!0),L(!0),k(null);try{let a=b.from("packages").select("*");n.filterOptions.folder&&(a=a.eq("folder1",n.filterOptions.folder)),n.filterOptions.folder&&n.filterOptions.category&&(a=a.eq("category1",n.filterOptions.category)),n.filterOptions.tags.length>0&&n.filterOptions.tags.forEach(s=>{a=a.contains("tags",[s])});const{data:t,error:r}=await a;if(r)throw r;Pe(t||[])}catch(a){console.error("Error fetching matching packages:",a),k(`Failed to load matching packages: ${a.message}`),Pe([])}finally{Ae(!1)}},[n.filterOptions]),Ke=o.useCallback(async()=>{if(!d.oldTag.trim()){m("Please select a tag to preview affected packages.");return}Te(!0),ce(!0),m(null);try{const{data:a,error:t}=await b.from("packages").select("*").contains("tags",[d.oldTag.trim()]);if(t)throw t;K(a||[]),G((a==null?void 0:a.length)||0),(!a||a.length===0)&&m(`No packages found with tag "${d.oldTag.trim()}".`)}catch(a){console.error("Error fetching packages with tag:",a),m(`Failed to load packages with tag: ${a.message}`),K([])}finally{Te(!1)}},[d.oldTag]),Qe=a=>{C(t=>({...t,operation:a.target.value})),L(!1)},Xe=a=>{const t=a.target.value==="null"?null:a.target.value;C(r=>({...r,filterOptions:{...r.filterOptions,folder:t,category:null}})),L(!1)},Ze=a=>{const t=a.target.value==="null"?null:a.target.value;C(r=>({...r,filterOptions:{...r.filterOptions,category:t}})),L(!1)},ea=(a,t)=>{C(r=>({...r,filterOptions:{...r.filterOptions,tags:t}})),L(!1)},aa=a=>{const t=a.target.value==="null"?null:a.target.value;C(r=>({...r,updateOptions:{...r.updateOptions,folder:t,category:null}}))},ta=a=>{const t=a.target.value==="null"?null:a.target.value;C(r=>({...r,updateOptions:{...r.updateOptions,category:t}}))},ra=(a,t)=>{C(r=>({...r,updateOptions:{...r.updateOptions,addTags:t}}))},sa=(a,t)=>{C(r=>({...r,updateOptions:{...r.updateOptions,removeTags:t}}))},la=(a,t)=>{Je(t)},$e=a=>{const{name:t,value:r}=a.target;B(s=>({...s,[t]:r}))},na=a=>{const{name:t,value:r}=a.target;Y(s=>({...s,[t]:r}))},ia=(a,t)=>{t&&(Y(r=>({...r,oldTag:t})),ce(!1),K([]))},oa=async()=>{if(!_){m("You must be an admin to perform this operation.");return}if(!d.oldTag.trim()){m("Please select a tag to replace.");return}if(!d.newTag.trim()){m("Please enter a new tag name.");return}ne(!0),m(null),ie(null),G(0);try{let a=[];if(Q&&N.length>0)a=N;else{const{data:g,error:p}=await b.from("packages").select("*").contains("tags",[d.oldTag.trim()]);if(p)throw p;a=g||[]}if(a.length===0){m(`No packages found with tag "${d.oldTag.trim()}".`),ne(!1);return}let t=0,r=0;for(const g of a)try{const Z=(g.tags||[]).map(A=>A===d.oldTag.trim()?d.newTag.trim():A),{error:P}=await b.from("packages").update({tags:Z}).eq("id",g.id);if(P)throw P;t++}catch(p){console.error("Error updating package tags:",p),r++}G(t),ie(`Successfully updated tag "${d.oldTag.trim()}" to "${d.newTag.trim()}" in ${t} packages.`),r>0&&m(`Failed to update tags in ${r} packages.`),Y({oldTag:"",newTag:""});const s=[...S];if(s.includes(d.newTag.trim())||s.push(d.newTag.trim()),t===a.length){const g=s.indexOf(d.oldTag.trim());g!==-1&&s.splice(g,1)}ee.setState({allAvailableTags:s.sort()})}catch(a){console.error("Error updating tags:",a),m(`Failed to update tags: ${a.message}`)}finally{ne(!1)}},da=a=>{B(t=>({...t,selectedFolder:a.target.value}))},ca=async()=>{if(!_){z("You must be an admin to perform this operation.");return}if(!l.newFolder.trim()){z("Please enter a folder name.");return}J(!0),z(null),je(null);try{if(T.includes(l.newFolder.trim())){z(`Folder "${l.newFolder.trim()}" already exists.`),J(!1);return}const{data:a,error:t}=await b.from("packages").select("folder1").eq("folder1",l.newFolder.trim()).limit(1);if(t)throw t;if(a&&a.length>0){z(`Folder "${l.newFolder.trim()}" already exists in the database.`),J(!1);return}const{error:r}=await b.from("packages").insert({package_name:`__folder_placeholder_${Date.now()}`,folder1:l.newFolder.trim(),description:`This is a placeholder entry to establish the folder "${l.newFolder.trim()}". This entry can be safely deleted once other packages use this folder.`,last_updated:new Date().toISOString()});if(r)throw r;const s=[...T,l.newFolder.trim()].sort(),g={...y,[l.newFolder.trim()]:[]};B(p=>({...p,newFolder:""})),je(`Folder "${l.newFolder.trim()}" has been created successfully.`),ee.setState({allAvailableFolders:s,allAvailableCategories:g})}catch(a){console.error("Error creating folder:",a),z(`Failed to create folder: ${a.message}`)}finally{J(!1)}},ga=async()=>{var a;if(!_){I("You must be an admin to perform this operation.");return}if(!l.selectedFolder){I("Please select a folder.");return}if(!l.newCategory.trim()){I("Please enter a category name.");return}V(!0),I(null),ve(null);try{if((a=y[l.selectedFolder])!=null&&a.includes(l.newCategory.trim())){I(`Category "${l.newCategory.trim()}" already exists in this folder.`),V(!1);return}const{data:t,error:r}=await b.from("packages").select("category1").eq("folder1",l.selectedFolder).eq("category1",l.newCategory.trim()).limit(1);if(r)throw r;if(t&&t.length>0){I(`Category "${l.newCategory.trim()}" already exists in this folder.`),V(!1);return}const{error:s}=await b.from("packages").insert({package_name:`__category_placeholder_${Date.now()}`,folder1:l.selectedFolder,category1:l.newCategory.trim(),description:`This is a placeholder entry to establish the category "${l.newCategory.trim()}" in folder "${l.selectedFolder}". This entry can be safely deleted once other packages use this category.`,last_updated:new Date().toISOString()});if(s)throw s;const g={...y,[l.selectedFolder]:[...y[l.selectedFolder]||[],l.newCategory.trim()].sort()};B(p=>({...p,newCategory:""})),ve(`Category "${l.newCategory.trim()}" has been created successfully in folder "${l.selectedFolder}".`),ee.setState({allAvailableCategories:g})}catch(t){console.error("Error creating category:",t),I(`Failed to create category: ${t.message}`)}finally{V(!1)}},ha=async()=>{if(!_){k("You must be an admin to perform this operation.");return}if(w.length===0){k("No packages match the current filter criteria.");return}if(!(n.updateOptions.folder!==null||n.updateOptions.category!==null||n.updateOptions.addTags.length>0||n.updateOptions.removeTags.length>0)){k("Please specify at least one update option.");return}Fe(!0),k(null),Se(null),he(null);try{const t=w.map(g=>g.id);let r=0,s=0;for(const g of t)try{const{data:p,error:Z}=await b.from("packages").select("*").eq("id",g).single();if(Z)throw Z;if(!p)continue;const P={};if(n.updateOptions.folder!==null&&(P.folder1=n.updateOptions.folder),n.updateOptions.category!==null&&(P.category1=n.updateOptions.category),n.updateOptions.addTags.length>0||n.updateOptions.removeTags.length>0){const A=p.tags||[],xa=n.updateOptions.addTags.filter(ue=>!A.includes(ue)),pa=A.filter(ue=>!n.updateOptions.removeTags.includes(ue));P.tags=[...pa,...xa]}if(Object.keys(P).length>0){const{error:A}=await b.from("packages").update(P).eq("id",g);if(A)throw A;r++}}catch(p){console.error("Error updating package:",p),s++}he({status:s>0?r>0?"warning":"error":"success",message:`Operation completed with ${r} packages updated successfully${s>0?` and ${s} errors`:""}.`,affectedPackages:r}),Se(`Successfully updated ${r} packages.`),s>0&&k(`Failed to update ${s} packages.`),await Ee()}catch(t){console.error("Error executing bulk operation:",t),k(`Failed to execute operation: ${t.message}`),he({status:"error",message:`Operation failed: ${t.message}`,affectedPackages:0})}finally{Fe(!1)}},ua=()=>{if(w.length===0)return;const a=JSON.stringify(w,null,2),t="data:application/json;charset=utf-8,"+encodeURIComponent(a),r=`cadd-vault-packages-${new Date().toISOString()}.json`,s=document.createElement("a");s.setAttribute("href",t),s.setAttribute("download",r),s.click()};return Ye?e.jsx(ae,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"80vh"},children:e.jsx(F,{})}):Be?_?e.jsxs(ae,{sx:{py:4},children:[e.jsx(c,{variant:"h4",component:"h1",gutterBottom:!0,sx:{fontWeight:"bold"},children:"Database Administration"}),e.jsx(c,{variant:"subtitle1",color:"text.secondary",gutterBottom:!0,children:"Manage database entries and structure."}),e.jsx(u,{sx:{borderBottom:1,borderColor:"divider",mb:2},children:e.jsxs(ya,{value:$,onChange:la,"aria-label":"admin operations tabs",children:[e.jsx(xe,{label:"Bulk Updates",id:"admin-tab-0","aria-controls":"admin-tabpanel-0"}),e.jsx(xe,{label:"Folder & Category Management",id:"admin-tab-1","aria-controls":"admin-tabpanel-1"}),e.jsx(xe,{label:"Tag Management",id:"admin-tab-2","aria-controls":"admin-tabpanel-2"})]})}),e.jsx("div",{role:"tabpanel",hidden:$!==0,id:"admin-tabpanel-0","aria-labelledby":"admin-tab-0",children:$===0&&e.jsxs(i,{container:!0,spacing:3,children:[e.jsx(i,{item:!0,xs:12,children:e.jsxs(q,{elevation:3,sx:{p:3,mt:2},children:[e.jsx(c,{variant:"h6",gutterBottom:!0,children:"Operation Settings"}),e.jsxs(D,{fullWidth:!0,sx:{mb:3},children:[e.jsx(M,{children:"Operation Type"}),e.jsx(U,{value:n.operation,onChange:Qe,label:"Operation Type",children:e.jsx(v,{value:"update",children:"Update Packages"})})]}),e.jsxs(u,{sx:{mb:4},children:[e.jsxs(c,{variant:"subtitle1",sx:{mb:2,display:"flex",alignItems:"center"},children:[e.jsx(ba,{sx:{mr:1}}),"Filter Criteria"]}),e.jsx(h,{severity:"info",sx:{mb:2},children:"Define which packages will be affected by this operation."}),e.jsxs(i,{container:!0,spacing:2,children:[e.jsx(i,{item:!0,xs:12,sm:6,children:e.jsxs(D,{fullWidth:!0,children:[e.jsx(M,{children:"Folder"}),e.jsxs(U,{value:n.filterOptions.folder||"null",onChange:Xe,label:"Folder",children:[e.jsx(v,{value:"null",children:"Any Folder"}),T.map(a=>e.jsx(v,{value:a,children:a},a))]})]})}),e.jsx(i,{item:!0,xs:12,sm:6,children:e.jsxs(D,{fullWidth:!0,disabled:!n.filterOptions.folder,children:[e.jsx(M,{children:"Category"}),e.jsxs(U,{value:n.filterOptions.category||"null",onChange:Ze,label:"Category",children:[e.jsx(v,{value:"null",children:"Any Category"}),Ge.map(a=>e.jsx(v,{value:a,children:a},a))]})]})}),e.jsx(i,{item:!0,xs:12,children:e.jsx(te,{multiple:!0,id:"filter-tags",options:S,value:n.filterOptions.tags,onChange:ea,renderInput:a=>e.jsx(W,{...a,label:"Has Tags",placeholder:"Select tags to filter by",helperText:"Only packages having ALL selected tags will be affected"}),renderTags:(a,t)=>a.map((r,s)=>e.jsx(O,{variant:"outlined",label:r,...t({index:s}),sx:{bgcolor:j(f.palette.primary.main,.1),borderColor:j(f.palette.primary.main,.3)}}))})})]})]}),e.jsx(E,{variant:"outlined",color:"primary",onClick:Ee,disabled:X,sx:{mb:4},children:X?e.jsx(F,{size:24}):"Preview Matching Packages"}),e.jsx(Ne,{sx:{mb:4}}),e.jsxs(u,{sx:{mb:4},children:[e.jsxs(c,{variant:"subtitle1",sx:{mb:2,display:"flex",alignItems:"center"},children:[e.jsx(He,{sx:{mr:1}}),"Update Options"]}),e.jsx(h,{severity:"warning",sx:{mb:2},children:"Specify the changes to apply to all matching packages."}),e.jsxs(i,{container:!0,spacing:2,children:[e.jsx(i,{item:!0,xs:12,sm:6,children:e.jsxs(D,{fullWidth:!0,children:[e.jsx(M,{children:"Change Folder To"}),e.jsxs(U,{value:n.updateOptions.folder||"null",onChange:aa,label:"Change Folder To",children:[e.jsx(v,{value:"null",children:"No Change"}),T.map(a=>e.jsx(v,{value:a,children:a},a))]})]})}),e.jsx(i,{item:!0,xs:12,sm:6,children:e.jsxs(D,{fullWidth:!0,children:[e.jsx(M,{children:"Change Category To"}),e.jsxs(U,{value:n.updateOptions.category||"null",onChange:ta,label:"Change Category To",children:[e.jsx(v,{value:"null",children:"No Change"}),Object.values(y).flat().filter((a,t,r)=>r.indexOf(a)===t).sort().map(a=>e.jsx(v,{value:a,children:a},a))]})]})}),e.jsx(i,{item:!0,xs:12,sm:6,children:e.jsx(te,{multiple:!0,id:"add-tags",options:S.filter(a=>!n.updateOptions.addTags.includes(a)),value:n.updateOptions.addTags,onChange:ra,renderInput:a=>e.jsx(W,{...a,label:"Add Tags",placeholder:"Select tags to add",helperText:"These tags will be added to all matching packages"}),renderTags:(a,t)=>a.map((r,s)=>e.jsx(O,{variant:"outlined",label:r,...t({index:s}),sx:{bgcolor:j(f.palette.success.main,.1),borderColor:j(f.palette.success.main,.3)}}))})}),e.jsx(i,{item:!0,xs:12,sm:6,children:e.jsx(te,{multiple:!0,id:"remove-tags",options:S.filter(a=>!n.updateOptions.removeTags.includes(a)),value:n.updateOptions.removeTags,onChange:sa,renderInput:a=>e.jsx(W,{...a,label:"Remove Tags",placeholder:"Select tags to remove",helperText:"These tags will be removed from all matching packages"}),renderTags:(a,t)=>a.map((r,s)=>e.jsx(O,{variant:"outlined",label:r,...t({index:s}),sx:{bgcolor:j(f.palette.error.main,.1),borderColor:j(f.palette.error.main,.3)}}))})})]})]}),Oe&&e.jsx(h,{severity:"error",sx:{mb:2},children:Oe}),ke&&e.jsx(h,{severity:"success",sx:{mb:2},children:ke}),R&&e.jsxs(h,{severity:R.status,sx:{mb:2},children:[R.message,R.details&&e.jsx(c,{variant:"body2",mt:1,children:R.details})]}),e.jsx(E,{variant:"contained",color:"primary",disabled:ge||w.length===0,onClick:ha,sx:{mr:2},children:ge?e.jsx(F,{size:24}):"Execute Operation"}),e.jsx(E,{variant:"outlined",color:"secondary",onClick:()=>C({operation:"update",filterOptions:{folder:null,category:null,tags:[]},updateOptions:{folder:null,category:null,addTags:[],removeTags:[]}}),disabled:ge,children:"Reset Form"})]})}),Ve&&e.jsx(i,{item:!0,xs:12,children:e.jsxs(q,{elevation:3,sx:{p:3,mt:2},children:[e.jsxs(u,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(c,{variant:"h6",children:X?"Loading Matching Packages...":`Matching Packages (${w.length})`}),w.length>0&&e.jsx(We,{title:"Download as JSON",children:e.jsx(ze,{onClick:ua,color:"primary",children:e.jsx(Le,{})})})]}),X?e.jsx(u,{sx:{display:"flex",justifyContent:"center",p:4},children:e.jsx(F,{})}):w.length===0?e.jsx(h,{severity:"info",children:"No packages match the selected filter criteria."}):e.jsx(De,{sx:{maxHeight:400},children:e.jsxs(Me,{stickyHeader:!0,children:[e.jsx(Ue,{children:e.jsxs(re,{children:[e.jsx(x,{sx:{fontWeight:"bold"},children:"Package Name"}),e.jsx(x,{sx:{fontWeight:"bold"},children:"Folder"}),e.jsx(x,{sx:{fontWeight:"bold"},children:"Category"}),e.jsx(x,{sx:{fontWeight:"bold"},children:"Tags"})]})}),e.jsx(_e,{children:w.map(a=>{var t,r,s;return e.jsxs(re,{hover:!0,children:[e.jsx(x,{children:a.package_name}),e.jsx(x,{children:a.folder1||"—"}),e.jsx(x,{children:a.category1||"—"}),e.jsx(x,{children:e.jsxs(u,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:[(t=a.tags)==null?void 0:t.slice(0,5).map(g=>e.jsx(O,{label:g,size:"small",sx:{fontSize:"0.75rem",height:22}},g)),(((r=a.tags)==null?void 0:r.length)||0)>5&&e.jsx(O,{label:`+${(((s=a.tags)==null?void 0:s.length)||0)-5} more`,size:"small",variant:"outlined",sx:{fontSize:"0.75rem",height:22}}),(!a.tags||a.tags.length===0)&&e.jsx(c,{variant:"body2",color:"text.secondary",children:"No tags"})]})})]},a.id)})})]})})]})})]})}),e.jsx("div",{role:"tabpanel",hidden:$!==2,id:"admin-tabpanel-2","aria-labelledby":"admin-tab-2",children:$===2&&e.jsx(i,{container:!0,spacing:3,children:e.jsx(i,{item:!0,xs:12,children:e.jsxs(q,{elevation:3,sx:{p:3},children:[e.jsxs(c,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center"},children:[e.jsx(qe,{sx:{mr:1}}),"Tag Management"]}),e.jsx(h,{severity:"info",sx:{mb:3},children:"Find and correct tags with typos. Changes will be applied to all packages that have the selected tag."}),Ce&&e.jsx(h,{severity:"error",sx:{mb:2},children:Ce}),we&&e.jsx(h,{severity:"success",sx:{mb:2},children:we}),e.jsxs(i,{container:!0,spacing:2,sx:{mb:3},children:[e.jsx(i,{item:!0,xs:12,sm:6,children:e.jsx(te,{options:S,value:d.oldTag,onChange:(a,t)=>ia(a,t),renderInput:a=>e.jsx(W,{...a,label:"Tag to Replace",name:"oldTag",fullWidth:!0,helperText:"Select the tag that has a typo or needs to be renamed"})})}),e.jsx(i,{item:!0,xs:12,sm:6,children:e.jsx(W,{label:"New Tag Name",name:"newTag",value:d.newTag,onChange:na,fullWidth:!0,helperText:"Enter the corrected tag name"})})]}),e.jsxs(u,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(E,{variant:"outlined",color:"primary",onClick:Ke,disabled:de||!d.oldTag,children:de?e.jsx(F,{size:24}):"Preview Affected Packages"}),!Q&&d.oldTag&&e.jsx(c,{variant:"body2",sx:{alignSelf:"center",fontStyle:"italic"},children:"Click to see which packages will be affected"})]}),e.jsxs(u,{sx:{display:"flex",gap:2},children:[e.jsx(E,{variant:"contained",color:"primary",onClick:oa,disabled:le||!d.oldTag||!d.newTag||oe===0,sx:{mr:2},children:le?e.jsx(F,{size:24}):"Update Tag"}),e.jsx(E,{variant:"outlined",color:"secondary",onClick:()=>{Y({oldTag:"",newTag:""}),m(null),ie(null),ce(!1),K([]),G(0)},disabled:le,children:"Reset Form"})]}),oe>0&&!Q&&e.jsx(u,{sx:{mt:3},children:e.jsxs(c,{variant:"subtitle2",children:["Tags updated in ",oe," packages"]})}),e.jsx(Ne,{sx:{my:3}}),e.jsxs(c,{variant:"subtitle1",sx:{mb:2},children:["Available Tags (",S.length,")"]}),e.jsx(u,{sx:{maxHeight:200,overflowY:"auto",border:1,borderColor:"divider",borderRadius:1,p:1},children:S.length>0?e.jsx(u,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:S.map(a=>e.jsx(O,{label:a,size:"small",sx:{bgcolor:j(f.palette.primary.main,.1)}},a))}):e.jsx(c,{variant:"body2",color:"text.secondary",children:"No tags available"})}),Q&&e.jsxs(u,{sx:{mt:3},children:[e.jsxs(c,{variant:"subtitle1",sx:{mb:2,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("span",{children:['Packages With Tag "',d.oldTag,'" (',N.length,")"]}),N.length>0&&e.jsx(We,{title:"Download as JSON",children:e.jsx(ze,{size:"small",onClick:()=>{const a=JSON.stringify(N,null,2),t="data:application/json;charset=utf-8,"+encodeURIComponent(a),r=`packages-with-tag-${d.oldTag}-${new Date().toISOString()}.json`,s=document.createElement("a");s.setAttribute("href",t),s.setAttribute("download",r),s.click()},children:e.jsx(Le,{})})})]}),de?e.jsx(u,{sx:{display:"flex",justifyContent:"center",p:3},children:e.jsx(F,{})}):N.length===0?e.jsx(h,{severity:"info",children:"No packages found with this tag."}):e.jsx(De,{sx:{maxHeight:400},children:e.jsxs(Me,{stickyHeader:!0,size:"small",children:[e.jsx(Ue,{children:e.jsxs(re,{children:[e.jsx(x,{children:"Package Name"}),e.jsx(x,{children:"Folder"}),e.jsx(x,{children:"Category"}),e.jsx(x,{children:"Tags"})]})}),e.jsx(_e,{children:N.map(a=>e.jsxs(re,{hover:!0,children:[e.jsx(x,{children:a.package_name}),e.jsx(x,{children:a.folder1||"None"}),e.jsx(x,{children:a.category1||"None"}),e.jsx(x,{children:e.jsxs(u,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:[a.tags&&a.tags.map(t=>e.jsx(O,{label:t,size:"small",sx:{bgcolor:t===d.oldTag?j(f.palette.warning.main,.2):j(f.palette.primary.main,.1),fontWeight:t===d.oldTag?"bold":"normal",height:22}},`${a.id}-${t}`)),(!a.tags||a.tags.length===0)&&e.jsx(c,{variant:"body2",color:"text.secondary",children:"No tags"})]})})]},a.id))})]})})]})]})})})}),e.jsx("div",{role:"tabpanel",hidden:$!==1,id:"admin-tabpanel-1","aria-labelledby":"admin-tab-1",children:$===1&&e.jsxs(i,{container:!0,spacing:3,children:[e.jsx(i,{item:!0,xs:12,md:6,children:e.jsxs(q,{elevation:3,sx:{p:3},children:[e.jsxs(c,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center"},children:[e.jsx(qe,{sx:{mr:1}}),"Create New Folder"]}),e.jsx(h,{severity:"info",sx:{mb:3},children:"Add a new top-level folder to organize packages. Folders are the main classification groups."}),me&&e.jsx(h,{severity:"error",sx:{mb:2},children:me}),fe&&e.jsx(h,{severity:"success",sx:{mb:2},children:fe}),e.jsxs(i,{container:!0,spacing:2,children:[e.jsx(i,{item:!0,xs:12,children:e.jsx(W,{fullWidth:!0,label:"New Folder Name",name:"newFolder",value:l.newFolder,onChange:$e,placeholder:"Enter folder name",helperText:"This will create a new folder in the database"})}),e.jsx(i,{item:!0,xs:12,children:e.jsx(E,{variant:"contained",color:"primary",onClick:ca,disabled:se||!l.newFolder.trim(),startIcon:se?e.jsx(F,{size:20}):e.jsx(Re,{}),fullWidth:!0,children:se?"Creating...":"Create Folder"})})]}),e.jsxs(c,{variant:"subtitle2",sx:{mt:3,mb:1},children:["Existing Folders (",T.length,")"]}),e.jsx(u,{sx:{maxHeight:200,overflowY:"auto",border:1,borderColor:"divider",borderRadius:1,p:1},children:T.length>0?e.jsx(u,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:T.map(a=>e.jsx(O,{label:a,variant:"outlined",size:"small",sx:{bgcolor:j(f.palette.primary.main,.05)}},a))}):e.jsx(c,{variant:"body2",color:"text.secondary",children:"No folders defined yet."})})]})}),e.jsx(i,{item:!0,xs:12,md:6,children:e.jsxs(q,{elevation:3,sx:{p:3},children:[e.jsxs(c,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center"},children:[e.jsx(He,{sx:{mr:1}}),"Create New Category"]}),e.jsx(h,{severity:"info",sx:{mb:3},children:"Add a new category within an existing folder. Categories are subgroups of folders."}),ye&&e.jsx(h,{severity:"error",sx:{mb:2},children:ye}),be&&e.jsx(h,{severity:"success",sx:{mb:2},children:be}),e.jsxs(i,{container:!0,spacing:2,children:[e.jsx(i,{item:!0,xs:12,children:e.jsxs(D,{fullWidth:!0,children:[e.jsx(M,{children:"Select Folder"}),e.jsx(U,{value:l.selectedFolder,onChange:da,label:"Select Folder",disabled:H||T.length===0,children:T.map(a=>e.jsx(v,{value:a,children:a},a))})]})}),e.jsx(i,{item:!0,xs:12,children:e.jsx(W,{fullWidth:!0,label:"New Category Name",name:"newCategory",value:l.newCategory,onChange:$e,placeholder:"Enter category name",helperText:"This will create a new category within the selected folder",disabled:!l.selectedFolder||H})}),e.jsx(i,{item:!0,xs:12,children:e.jsx(E,{variant:"contained",color:"primary",onClick:ga,disabled:H||!l.selectedFolder||!l.newCategory.trim(),startIcon:H?e.jsx(F,{size:20}):e.jsx(Re,{}),fullWidth:!0,children:H?"Creating...":"Create Category"})})]}),l.selectedFolder&&e.jsxs(e.Fragment,{children:[e.jsxs(c,{variant:"subtitle2",sx:{mt:3,mb:1},children:['Existing Categories in "',l.selectedFolder,'" (',(y[l.selectedFolder]||[]).length,")"]}),e.jsx(u,{sx:{maxHeight:200,overflowY:"auto",border:1,borderColor:"divider",borderRadius:1,p:1},children:((Ie=y[l.selectedFolder])==null?void 0:Ie.length)>0?e.jsx(u,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:y[l.selectedFolder].map(a=>e.jsx(O,{label:a,variant:"outlined",size:"small",sx:{bgcolor:j(f.palette.secondary.main,.05)}},a))}):e.jsx(c,{variant:"body2",color:"text.secondary",children:"No categories defined in this folder yet."})})]})]})})]})})]}):e.jsx(ae,{sx:{py:4},children:e.jsx(h,{severity:"error",children:"Access Denied. This page is for administrators only."})}):e.jsx(ae,{sx:{py:4},children:e.jsx(h,{severity:"error",children:"You must be logged in to access this page."})})};export{Ta as default};
