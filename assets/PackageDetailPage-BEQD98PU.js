import{g as J,a as K,r as h,d as ee,_ as te,j as e,s as re,b as H,f as ae,i as oe,T as o,O as ie,c as D,P as ne,Q as se,R as le,o as ce,t as i,v as de,U as pe,V as B,H as g,m as l,W as u,X as xe,Y as me,Z as ge,N as he,n as I}from"./index-4SPLIEu2.js";import{R as fe,C as O,L as ue}from"./RatingInput-COccL990.js";import{E as be,D as ye,a as je,b as ke,c as ve,d as Ce}from"./Edit-CI4Mb3RN.js";import{G as _}from"./Grid-D_GsxMrC.js";import{A as _e,L as we}from"./Language-CqN3gXn7.js";import"./Delete-Br31ATFd.js";import"./queryKeys-D9VGViN5.js";function De(r){return J("MuiDialogContentText",r)}K("MuiDialogContentText",["root"]);const We=["children","className"],Ie=r=>{const{classes:d}=r,p=oe({root:["root"]},De,d);return H({},d,p)},Se=re(o,{shouldForwardProp:r=>ie(r)||r==="classes",name:"MuiDialogContentText",slot:"Root",overridesResolver:(r,d)=>d.root})({}),ze=h.forwardRef(function(d,y){const p=ee({props:d,name:"MuiDialogContentText"}),{className:j}=p,c=te(p,We),k=Ie(c);return e.jsx(Se,H({component:"p",variant:"body1",color:"text.secondary",ref:y,ownerState:c,className:ae(k.root,j)},p,{classes:k}))}),Me=D(e.jsx("path",{d:"m12 2-5.5 9h11zm0 3.84L13.93 9h-3.87zM17.5 13c-2.49 0-4.5 2.01-4.5 4.5s2.01 4.5 4.5 4.5 4.5-2.01 4.5-4.5-2.01-4.5-4.5-4.5m0 7c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5M3 21.5h8v-8H3zm2-6h4v4H5z"}),"CategoryOutlined"),Pe=D(e.jsx("path",{d:"m9.17 6 2 2H20v10H4V6zM10 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8z"}),"FolderOutlined"),Re=D(e.jsx("path",{d:"m5.2494 8.0688 2.83-2.8269 14.1343 14.15-2.83 2.8269zm4.2363-4.2415 2.828-2.8289 5.6577 5.656-2.828 2.8289zM.9989 12.3147l2.8284-2.8285 5.6569 5.6569-2.8285 2.8284zM1 21h12v2H1z"}),"Gavel"),Te=D([e.jsx("path",{d:"M21 5c-1.11-.35-2.33-.5-3.5-.5-1.95 0-4.05.4-5.5 1.5-1.45-1.1-3.55-1.5-5.5-1.5S2.45 4.9 1 6v14.65c0 .25.25.5.5.5.1 0 .15-.05.25-.05C3.1 20.45 5.05 20 6.5 20c1.95 0 4.05.4 5.5 1.5 1.35-.85 3.8-1.5 5.5-1.5 1.65 0 3.35.3 4.75 1.05.1.05.15.05.25.05.25 0 .5-.25.5-.5V6c-.6-.45-1.25-.75-2-1m0 13.5c-1.1-.35-2.3-.5-3.5-.5-1.7 0-4.15.65-5.5 1.5V8c1.35-.85 3.8-1.5 5.5-1.5 1.2 0 2.4.15 3.5.5z"},"0"),e.jsx("path",{d:"M17.5 10.5c.88 0 1.73.09 2.5.26V9.24c-.79-.15-1.64-.24-2.5-.24-1.7 0-3.24.29-4.5.83v1.66c1.13-.64 2.7-.99 4.5-.99M13 12.49v1.66c1.13-.64 2.7-.99 4.5-.99.88 0 1.73.09 2.5.26V11.9c-.79-.15-1.64-.24-2.5-.24-1.7 0-3.24.3-4.5.83m4.5 1.84c-1.7 0-3.24.29-4.5.83v1.66c1.13-.64 2.7-.99 4.5-.99.88 0 1.73.09 2.5.26v-1.52c-.79-.16-1.64-.24-2.5-.24"},"1")],"MenuBook"),S={borderRadius:4,textTransform:"none",px:1.5,minWidth:"auto",borderColor:r=>l(r.palette.primary.main,.3),color:"primary.main",transition:r=>r.transitions.create(["all"],{duration:"0.2s"}),"&::before":{content:'""',top:-1,left:-1,right:-1,bottom:-1,borderRadius:4,padding:"1px",background:r=>r.palette.mode==="dark"?`linear-gradient(135deg, ${l(r.palette.primary.main,0)}, ${l(r.palette.primary.main,.3)})`:`linear-gradient(135deg, ${l(r.palette.primary.main,0)}, ${l(r.palette.primary.main,.2)})`,WebkitMask:"linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0)",WebkitMaskComposite:"xor",maskComposite:"exclude"},"&:hover":{borderColor:"primary.main",color:r=>r.palette.mode==="dark"?r.palette.primary.light:r.palette.primary.main,bgcolor:r=>l(r.palette.primary.main,r.palette.mode==="dark"?.15:.04),"&::before":{background:r=>r.palette.mode==="dark"?`linear-gradient(135deg, ${l(r.palette.primary.main,.2)}, ${l(r.palette.primary.main,.4)})`:`linear-gradient(135deg, ${l(r.palette.primary.main,.1)}, ${l(r.palette.primary.main,.3)})`},transform:"translateY(-1px)",boxShadow:r=>`0 4px 12px ${l(r.palette.primary.main,.2)}`}},w={...S,width:"100%",justifyContent:"center",mt:"auto",mb:0},b={position:"relative",transition:"all 0.2s ease-in-out",color:"text.primary",textDecoration:"none","&:hover":{color:"primary.main",transform:"translateY(-1px)",textDecoration:"none"},"&::after":{content:'""',position:"absolute",width:"100%",transform:"scaleX(0)",height:"1.5px",bottom:"-1px",left:0,backgroundColor:"primary.main",transformOrigin:"bottom left",transition:"transform 0.25s ease-out"},"&:hover::after":{transform:"scaleX(1)"}},Be=()=>{const r=ne(),{packageId:d}=se(),y=le(),{isAdmin:p,currentUser:j}=ce(),c=d?decodeURIComponent(d):void 0,k=(j==null?void 0:j.id)||null,[t,G]=h.useState(null),[U,z]=h.useState(!0),[M,C]=h.useState(null),[X,v]=h.useState(!1),P=h.useRef(!0),Y=()=>{c&&y(`/edit-package/${encodeURIComponent(c)}`)},q=()=>{v(!0)},Q=async()=>{if(!c){C("Package ID is missing for deletion."),v(!1);return}try{const{error:a}=await I.from("packages").delete().eq("id",c);if(a)throw a;v(!1),y("/")}catch(a){console.error("Error deleting package:",a),C(`Failed to delete package: ${(a==null?void 0:a.message)||"Unknown error"}`),v(!1)}},R=()=>{v(!1)},Z=a=>{if(!a)return"N/A";try{const n=a instanceof Date?a:new Date(a);if(isNaN(n.getTime()))return"N/A";const x=Math.floor((new Date().getTime()-n.getTime())/1e3);let s=x/31536e3;return s>1?Math.floor(s)+" years ago":(s=x/2592e3,s>1?Math.floor(s)+" months ago":(s=x/86400,s>1?Math.floor(s)+" days ago":(s=x/3600,s>1?Math.floor(s)+" hours ago":(s=x/60,s>1?Math.floor(s)+" minutes ago":Math.floor(x)+" seconds ago"))))}catch{return"N/A"}};return h.useEffect(()=>()=>{P.current=!1},[]),h.useEffect(()=>{(async()=>{var n,x,s,T,$,N,E,L,V;if(!(!c||!P.current)){z(!0),C(null);try{const{data:m,error:A}=await I.from("packages").select(`
						*,
						package_tags!left(
							tags!inner(name)
						),
						package_folder_categories!left(
							folder_categories!inner(
								folders!inner(name),
								categories!inner(name)
							)
						)
					`).eq("id",c).single();if(A)throw A;if(m){const W={...m,tags:((n=m.package_tags)==null?void 0:n.map(f=>{var F;return(F=f.tags)==null?void 0:F.name}))||[],folder:(($=(T=(s=(x=m.package_folder_categories)==null?void 0:x[0])==null?void 0:s.folder_categories)==null?void 0:T.folders)==null?void 0:$.name)||"",category:((V=(L=(E=(N=m.package_folder_categories)==null?void 0:N[0])==null?void 0:E.folder_categories)==null?void 0:L.categories)==null?void 0:V.name)||""};if(k){const{data:f}=await I.rpc("get_user_rating",{package_uuid:c});f&&f.length>0&&(W.user_rating=f[0].rating,W.user_rating_id=f[0].rating_id)}G(W)}}catch(m){console.error("Error fetching package:",m),C(`Failed to fetch package data: ${m.message}`)}finally{z(!1)}}})()},[c,k]),U?e.jsx(i,{display:"flex",justifyContent:"center",alignItems:"center",height:"50vh",children:e.jsx(de,{})}):M?e.jsx(o,{color:"error",align:"center",children:M}):t?e.jsxs(pe,{elevation:3,sx:{p:3,m:2,position:"relative",height:"100%",display:"flex",flexDirection:"column",transition:a=>a.transitions.create(["box-shadow","transform","background"],{duration:a.transitions.duration.short}),background:a=>a.palette.mode==="dark"?"linear-gradient(135deg, rgba(30,30,30,0.8) 0%, rgba(23,23,23,0.8) 100%)":"linear-gradient(135deg, rgba(255,255,255,0.8) 0%, rgba(249,250,251,0.8) 100%)",backdropFilter:"blur(8px)",border:0,overflow:"hidden",borderRadius:2},children:[p&&e.jsxs(B,{direction:"row",spacing:1,sx:{position:"absolute",top:16,right:16},children:[e.jsx(g,{variant:"outlined",startIcon:e.jsx(be,{fontSize:"small"}),onClick:Y,sx:S,children:"Edit"}),e.jsx(g,{variant:"outlined",startIcon:e.jsx(ye,{fontSize:"small"}),onClick:q,sx:{...S,borderColor:r.palette.error.main,color:r.palette.error.main,"&:hover":{borderColor:r.palette.error.dark,bgcolor:l(r.palette.error.main,.1)}},children:"Delete"})]}),c&&e.jsx(i,{sx:{position:"absolute",top:20,right:p?t!=null&&t.package_name&&t.package_name.length>15?300:210:16,zIndex:1},children:e.jsx(fe,{packageId:c})}),e.jsx(o,{variant:"h4",gutterBottom:!0,component:"div",sx:{pr:p?"100px":0,fontWeight:600,fontSize:"2rem",color:a=>(a.palette.mode==="dark",a.palette.text.primary)},children:t.package_name||"Unnamed Package"}),e.jsx(i,{mb:3,children:e.jsx(o,{variant:"body1",paragraph:!0,sx:{whiteSpace:"pre-wrap",lineHeight:1.5,color:"text.secondary"},children:t.description||"No description available."})}),e.jsxs(_,{container:!0,spacing:4,mb:3,children:[e.jsx(_,{item:!0,xs:12,md:4,children:e.jsxs(i,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[e.jsx(o,{variant:"h6",gutterBottom:!0,sx:{fontWeight:600,fontSize:"1.25rem",color:a=>(a.palette.mode==="dark",a.palette.text.primary)},children:"Code"}),e.jsxs(i,{mb:2,children:[e.jsxs(o,{variant:"subtitle1",fontWeight:"bold",sx:{display:"flex",alignItems:"center",color:a=>(a.palette.mode==="dark",a.palette.text.primary)},children:[e.jsx(O,{sx:{mr:1,color:r.palette.primary.main}}),"Repository"]}),t.repository?e.jsx(u,{href:t.repository,target:"_blank",rel:"noopener noreferrer",sx:b,children:t.repository}):t.repo_link?e.jsx(u,{href:t.repo_link,target:"_blank",rel:"noopener noreferrer",sx:b,children:t.repo_link}):e.jsx(o,{variant:"body2",children:"N/A"})]}),typeof t.github_stars=="number"&&e.jsxs(i,{mb:2,children:[e.jsxs(o,{variant:"subtitle1",fontWeight:"bold",sx:{display:"flex",alignItems:"center",color:r.palette.text.primary},children:[e.jsx(xe,{style:{marginRight:"8px",color:r.palette.warning.main}}),"Github Stars"]}),e.jsx(o,{variant:"body2",children:t.github_stars})]}),t.last_commit&&e.jsxs(i,{mb:2,children:[e.jsxs(o,{variant:"subtitle1",fontWeight:"bold",sx:{display:"flex",alignItems:"center",color:r.palette.text.primary},children:[e.jsx(me,{style:{marginRight:"8px",color:r.palette.info.main}}),"Last Commit"]}),e.jsx(o,{variant:"body2",children:Z(t.last_commit)})]}),e.jsxs(i,{mb:2,children:[e.jsxs(o,{variant:"subtitle1",fontWeight:"bold",sx:{display:"flex",alignItems:"center",color:r.palette.text.primary},children:[e.jsx(Re,{sx:{mr:1,color:r.palette.info.main}}),"License"]}),e.jsx(o,{variant:"body2",children:t.license||"N/A"})]}),e.jsx(i,{sx:{flexGrow:1}}),(t.repo_link||t.repository||t.github_owner&&t.github_repo)&&e.jsx(g,{href:t.repository||(t.github_owner&&t.github_repo?`https://github.com/${t.github_owner}/${t.github_repo}`:t.repo_link)||"",target:"_blank",rel:"noopener noreferrer",variant:"outlined",startIcon:e.jsx(O,{fontSize:"small"}),sx:w,children:"View Repository"})]})}),e.jsx(_,{item:!0,xs:12,md:4,children:e.jsxs(i,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[e.jsx(o,{variant:"h6",gutterBottom:!0,sx:{fontWeight:600,fontSize:"1.25rem",color:a=>(a.palette.mode==="dark",a.palette.text.primary)},children:"Publication"}),t.publication&&e.jsxs(i,{mb:2,children:[e.jsxs(o,{variant:"subtitle1",fontWeight:"bold",sx:{display:"flex",alignItems:"center",color:r.palette.text.primary},children:[e.jsx(Te,{sx:{mr:1,color:r.palette.success.main}}),"Publication / DOI"]}),t.publication.startsWith("http")||t.publication.startsWith("www")?e.jsx(u,{href:t.publication,target:"_blank",rel:"noopener noreferrer",sx:b,children:"View Publication"}):e.jsx(u,{href:`https://doi.org/${t.publication}`,target:"_blank",rel:"noopener noreferrer",sx:b,children:t.publication})]}),typeof t.citations=="number"&&t.citations>0&&e.jsxs(i,{mb:2,children:[e.jsxs(o,{variant:"subtitle1",fontWeight:"bold",sx:{display:"flex",alignItems:"center",color:r.palette.text.primary},children:[e.jsx(ge,{style:{marginRight:"8px",color:r.palette.success.main}}),"Citations"]}),e.jsx(o,{variant:"body2",children:t.citations})]}),e.jsx(i,{sx:{flexGrow:1}}),t.publication&&e.jsx(g,{href:t.publication.startsWith("http")||t.publication.startsWith("www")?t.publication:`https://doi.org/${t.publication}`,target:"_blank",rel:"noopener noreferrer",variant:"outlined",startIcon:e.jsx(_e,{fontSize:"small"}),sx:w,children:"View Publication"})]})}),e.jsx(_,{item:!0,xs:12,md:4,children:e.jsxs(i,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[e.jsx(o,{variant:"h6",gutterBottom:!0,sx:{fontWeight:600,fontSize:"1.25rem",color:a=>(a.palette.mode==="dark",a.palette.text.primary)},children:"Other"}),t.folder&&e.jsxs(i,{mb:2,children:[e.jsxs(o,{variant:"subtitle1",fontWeight:"bold",sx:{display:"flex",alignItems:"center",color:r.palette.text.primary},children:[e.jsx(Pe,{sx:{mr:1,color:r.palette.primary.main}}),"Folder"]}),e.jsx(o,{variant:"body2",children:t.folder})]}),t.category&&e.jsxs(i,{mb:2,children:[e.jsxs(o,{variant:"subtitle1",fontWeight:"bold",sx:{display:"flex",alignItems:"center",color:r.palette.text.primary},children:[e.jsx(Me,{sx:{mr:1,color:r.palette.secondary.main}}),"Category"]}),e.jsx(o,{variant:"body2",children:t.category})]}),t.webserver&&e.jsxs(i,{mb:2,children:[e.jsx(o,{variant:"subtitle1",fontWeight:"bold",sx:{color:r.palette.text.primary},children:"Webserver/Homepage"}),e.jsx(u,{href:t.webserver,target:"_blank",rel:"noopener noreferrer",sx:b,children:t.webserver})]}),t.link&&e.jsxs(i,{mb:2,children:[e.jsx(o,{variant:"subtitle1",fontWeight:"bold",sx:{color:r.palette.text.primary},children:"Link"}),e.jsx(u,{href:t.link,target:"_blank",rel:"noopener noreferrer",sx:b,children:t.link})]}),t.version&&e.jsxs(i,{mb:2,children:[e.jsx(o,{variant:"subtitle1",fontWeight:"bold",sx:{color:r.palette.text.primary},children:"Version"}),e.jsx(o,{variant:"body2",children:t.version})]}),t.name&&t.name!==t.package_name&&e.jsxs(i,{mb:2,children:[e.jsx(o,{variant:"subtitle1",fontWeight:"bold",sx:{color:r.palette.text.primary},children:"Package Name"}),e.jsx(o,{variant:"body2",children:t.name})]}),e.jsx(i,{sx:{flexGrow:1}}),e.jsxs(B,{direction:"column",spacing:1,width:"100%",children:[t.webserver&&e.jsx(g,{href:t.webserver,target:"_blank",rel:"noopener noreferrer",variant:"outlined",startIcon:e.jsx(we,{fontSize:"small"}),sx:w,children:"Visit Webserver"}),t.link&&e.jsx(g,{href:t.link,target:"_blank",rel:"noopener noreferrer",variant:"outlined",startIcon:e.jsx(ue,{fontSize:"small"}),sx:w,children:"Visit Link"})]})]})})]}),t.tags&&t.tags.length>0&&e.jsxs(i,{children:[e.jsx(i,{sx:{mt:3,mb:3},children:e.jsx(i,{sx:{width:"100%",height:"1px",bgcolor:a=>l(a.palette.text.primary,.1)}})}),e.jsxs(i,{mb:2,children:[e.jsx(o,{variant:"h6",gutterBottom:!0,sx:{fontWeight:600,fontSize:"1.25rem",color:a=>(a.palette.mode==="dark",a.palette.text.primary)},children:"Tags"}),e.jsx(i,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:t.tags.map(a=>e.jsx(he,{label:a,size:"medium",sx:{height:"28px",borderRadius:4,bgcolor:n=>n.palette.mode==="dark"?l(n.palette.primary.main,.12):l(n.palette.primary.light,.12),color:n=>n.palette.mode==="dark"?n.palette.primary.light:n.palette.primary.main,fontWeight:500,fontSize:"0.8rem",padding:"0 4px","&:hover":{bgcolor:n=>n.palette.mode==="dark"?l(n.palette.primary.main,.18):l(n.palette.primary.light,.18)},cursor:"default"}},a))})]})]}),e.jsxs(je,{open:X,onClose:R,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(ke,{id:"alert-dialog-title",children:"Confirm Deletion"}),e.jsx(ve,{children:e.jsxs(ze,{id:"alert-dialog-description",children:['Are you sure you want to delete the package "',(t==null?void 0:t.package_name)||c,'"? This action cannot be undone.']})}),e.jsxs(Ce,{children:[e.jsx(g,{onClick:R,color:"primary",children:"Cancel"}),e.jsx(g,{onClick:Q,color:"error",autoFocus:!0,children:"Delete"})]})]})]}):e.jsx(o,{align:"center",children:"Package data is not available."})};export{Be as default};
