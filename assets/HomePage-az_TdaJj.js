const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/PackageCard-C38subE4.js","assets/index-4SPLIEu2.js","assets/index-B7rZpWz0.css","assets/RatingInput-COccL990.js","assets/Delete-Br31ATFd.js","assets/queryKeys-D9VGViN5.js","assets/PackageMetrics-DYvfKO-1.js","assets/Language-CqN3gXn7.js","assets/CardContent-DQV7ClQE.js","assets/PackageList-DZZlkcms.js"])))=>i.map(i=>d[i]);
import{g as X,a as Y,_ as H,u as Pa,b as z,c as F,j as o,r as L,d as Z,e as za,s as G,f as Q,h as O,i as aa,B as fa,k as q,l as Ra,m as J,n as P,o as ja,p as ta,q as ia,C as Ma,t as A,A as La,T as V,v as oa,F as Ia,S as wa,M as E,I as Ta,w as va}from"./index-4SPLIEu2.js";import{u as xa,q as ma}from"./queryKeys-D9VGViN5.js";import{g as Na}from"./getValidReactChildren-Bf9pMxGW.js";import{G as na}from"./Grid-D_GsxMrC.js";function Oa(a){return X("MuiPagination",a)}Y("MuiPagination",["root","ul","outlined","text"]);const Wa=["boundaryCount","componentName","count","defaultPage","disabled","hideNextButton","hidePrevButton","onChange","page","showFirstButton","showLastButton","siblingCount"];function Aa(a={}){const{boundaryCount:e=1,componentName:t="usePagination",count:s=1,defaultPage:p=1,disabled:c=!1,hideNextButton:v=!1,hidePrevButton:d=!1,onChange:b,page:u,showFirstButton:C=!1,showLastButton:R=!1,siblingCount:B=1}=a,l=H(a,Wa),[g,$]=Pa({controlled:u,default:p,name:t,state:"page"}),k=(r,f)=>{u||$(f),b&&b(r,f)},x=(r,f)=>{const T=f-r+1;return Array.from({length:T},(N,W)=>r+W)},i=x(1,Math.min(e,s)),h=x(Math.max(s-e+1,e+1),s),j=Math.max(Math.min(g-B,s-e-B*2-1),e+2),y=Math.min(Math.max(g+B,e+B*2+2),h.length>0?h[0]-2:s-1),I=[...C?["first"]:[],...d?[]:["previous"],...i,...j>e+2?["start-ellipsis"]:e+1<s-e?[e+1]:[],...x(j,y),...y<s-e-1?["end-ellipsis"]:s-e>e?[s-e]:[],...h,...v?[]:["next"],...R?["last"]:[]],M=r=>{switch(r){case"first":return 1;case"previous":return g-1;case"next":return g+1;case"last":return s;default:return null}},n=I.map(r=>typeof r=="number"?{onClick:f=>{k(f,r)},type:"page",page:r,selected:r===g,disabled:c,"aria-current":r===g?"true":void 0}:{onClick:f=>{k(f,M(r))},type:r,page:M(r),selected:!1,disabled:c||r.indexOf("ellipsis")===-1&&(r==="next"||r==="last"?g>=s:g<=1)});return z({items:n},l)}function Va(a){return X("MuiPaginationItem",a)}const w=Y("MuiPaginationItem",["root","page","sizeSmall","sizeLarge","text","textPrimary","textSecondary","outlined","outlinedPrimary","outlinedSecondary","rounded","ellipsis","firstLast","previousNext","focusVisible","disabled","selected","icon","colorPrimary","colorSecondary"]),la=F(o.jsx("path",{d:"M18.41 16.59L13.82 12l4.59-4.59L17 6l-6 6 6 6zM6 6h2v12H6z"}),"FirstPage"),ca=F(o.jsx("path",{d:"M5.59 7.41L10.18 12l-4.59 4.59L7 18l6-6-6-6zM16 6h2v12h-2z"}),"LastPage"),da=F(o.jsx("path",{d:"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"}),"NavigateBefore"),pa=F(o.jsx("path",{d:"M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"}),"NavigateNext"),Fa=["className","color","component","components","disabled","page","selected","shape","size","slots","type","variant"],ba=(a,e)=>{const{ownerState:t}=a;return[e.root,e[t.variant],e[`size${O(t.size)}`],t.variant==="text"&&e[`text${O(t.color)}`],t.variant==="outlined"&&e[`outlined${O(t.color)}`],t.shape==="rounded"&&e.rounded,t.type==="page"&&e.page,(t.type==="start-ellipsis"||t.type==="end-ellipsis")&&e.ellipsis,(t.type==="previous"||t.type==="next")&&e.previousNext,(t.type==="first"||t.type==="last")&&e.firstLast]},Da=a=>{const{classes:e,color:t,disabled:s,selected:p,size:c,shape:v,type:d,variant:b}=a,u={root:["root",`size${O(c)}`,b,v,t!=="standard"&&`color${O(t)}`,t!=="standard"&&`${b}${O(t)}`,s&&"disabled",p&&"selected",{page:"page",first:"firstLast",last:"firstLast","start-ellipsis":"ellipsis","end-ellipsis":"ellipsis",previous:"previousNext",next:"previousNext"}[d]],icon:["icon"]};return aa(u,Va,e)},Ga=G("div",{name:"MuiPaginationItem",slot:"Root",overridesResolver:ba})(({theme:a,ownerState:e})=>z({},a.typography.body2,{borderRadius:32/2,textAlign:"center",boxSizing:"border-box",minWidth:32,padding:"0 6px",margin:"0 3px",color:(a.vars||a).palette.text.primary,height:"auto",[`&.${w.disabled}`]:{opacity:(a.vars||a).palette.action.disabledOpacity}},e.size==="small"&&{minWidth:26,borderRadius:26/2,margin:"0 1px",padding:"0 4px"},e.size==="large"&&{minWidth:40,borderRadius:40/2,padding:"0 10px",fontSize:a.typography.pxToRem(15)})),Sa=G(fa,{name:"MuiPaginationItem",slot:"Root",overridesResolver:ba})(({theme:a,ownerState:e})=>z({},a.typography.body2,{borderRadius:32/2,textAlign:"center",boxSizing:"border-box",minWidth:32,height:32,padding:"0 6px",margin:"0 3px",color:(a.vars||a).palette.text.primary,[`&.${w.focusVisible}`]:{backgroundColor:(a.vars||a).palette.action.focus},[`&.${w.disabled}`]:{opacity:(a.vars||a).palette.action.disabledOpacity},transition:a.transitions.create(["color","background-color"],{duration:a.transitions.duration.short}),"&:hover":{backgroundColor:(a.vars||a).palette.action.hover,"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${w.selected}`]:{backgroundColor:(a.vars||a).palette.action.selected,"&:hover":{backgroundColor:a.vars?`rgba(${a.vars.palette.action.selectedChannel} / calc(${a.vars.palette.action.selectedOpacity} + ${a.vars.palette.action.hoverOpacity}))`:q.alpha(a.palette.action.selected,a.palette.action.selectedOpacity+a.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:(a.vars||a).palette.action.selected}},[`&.${w.focusVisible}`]:{backgroundColor:a.vars?`rgba(${a.vars.palette.action.selectedChannel} / calc(${a.vars.palette.action.selectedOpacity} + ${a.vars.palette.action.focusOpacity}))`:q.alpha(a.palette.action.selected,a.palette.action.selectedOpacity+a.palette.action.focusOpacity)},[`&.${w.disabled}`]:{opacity:1,color:(a.vars||a).palette.action.disabled,backgroundColor:(a.vars||a).palette.action.selected}}},e.size==="small"&&{minWidth:26,height:26,borderRadius:26/2,margin:"0 1px",padding:"0 4px"},e.size==="large"&&{minWidth:40,height:40,borderRadius:40/2,padding:"0 10px",fontSize:a.typography.pxToRem(15)},e.shape==="rounded"&&{borderRadius:(a.vars||a).shape.borderRadius}),({theme:a,ownerState:e})=>z({},e.variant==="text"&&{[`&.${w.selected}`]:z({},e.color!=="standard"&&{color:(a.vars||a).palette[e.color].contrastText,backgroundColor:(a.vars||a).palette[e.color].main,"&:hover":{backgroundColor:(a.vars||a).palette[e.color].dark,"@media (hover: none)":{backgroundColor:(a.vars||a).palette[e.color].main}},[`&.${w.focusVisible}`]:{backgroundColor:(a.vars||a).palette[e.color].dark}},{[`&.${w.disabled}`]:{color:(a.vars||a).palette.action.disabled}})},e.variant==="outlined"&&{border:a.vars?`1px solid rgba(${a.vars.palette.common.onBackgroundChannel} / 0.23)`:`1px solid ${a.palette.mode==="light"?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)"}`,[`&.${w.selected}`]:z({},e.color!=="standard"&&{color:(a.vars||a).palette[e.color].main,border:`1px solid ${a.vars?`rgba(${a.vars.palette[e.color].mainChannel} / 0.5)`:q.alpha(a.palette[e.color].main,.5)}`,backgroundColor:a.vars?`rgba(${a.vars.palette[e.color].mainChannel} / ${a.vars.palette.action.activatedOpacity})`:q.alpha(a.palette[e.color].main,a.palette.action.activatedOpacity),"&:hover":{backgroundColor:a.vars?`rgba(${a.vars.palette[e.color].mainChannel} / calc(${a.vars.palette.action.activatedOpacity} + ${a.vars.palette.action.focusOpacity}))`:q.alpha(a.palette[e.color].main,a.palette.action.activatedOpacity+a.palette.action.focusOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${w.focusVisible}`]:{backgroundColor:a.vars?`rgba(${a.vars.palette[e.color].mainChannel} / calc(${a.vars.palette.action.activatedOpacity} + ${a.vars.palette.action.focusOpacity}))`:q.alpha(a.palette[e.color].main,a.palette.action.activatedOpacity+a.palette.action.focusOpacity)}},{[`&.${w.disabled}`]:{borderColor:(a.vars||a).palette.action.disabledBackground,color:(a.vars||a).palette.action.disabled}})})),qa=G("div",{name:"MuiPaginationItem",slot:"Icon",overridesResolver:(a,e)=>e.icon})(({theme:a,ownerState:e})=>z({fontSize:a.typography.pxToRem(20),margin:"0 -8px"},e.size==="small"&&{fontSize:a.typography.pxToRem(18)},e.size==="large"&&{fontSize:a.typography.pxToRem(22)})),Ea=L.forwardRef(function(e,t){const s=Z({props:e,name:"MuiPaginationItem"}),{className:p,color:c="standard",component:v,components:d={},disabled:b=!1,page:u,selected:C=!1,shape:R="circular",size:B="medium",slots:l={},type:g="page",variant:$="text"}=s,k=H(s,Fa),x=z({},s,{color:c,disabled:b,selected:C,shape:R,size:B,type:g,variant:$}),i=za(),h=Da(x),y=(i?{previous:l.next||d.next||pa,next:l.previous||d.previous||da,last:l.first||d.first||la,first:l.last||d.last||ca}:{previous:l.previous||d.previous||da,next:l.next||d.next||pa,first:l.first||d.first||la,last:l.last||d.last||ca})[g];return g==="start-ellipsis"||g==="end-ellipsis"?o.jsx(Ga,{ref:t,ownerState:x,className:Q(h.root,p),children:"â€¦"}):o.jsxs(Sa,z({ref:t,ownerState:x,component:v,disabled:b,className:Q(h.root,p)},k,{children:[g==="page"&&u,y?o.jsx(qa,{as:y,ownerState:x,className:h.icon}):null]}))}),Ua=["boundaryCount","className","color","count","defaultPage","disabled","getItemAriaLabel","hideNextButton","hidePrevButton","onChange","page","renderItem","shape","showFirstButton","showLastButton","siblingCount","size","variant"],Ha=a=>{const{classes:e,variant:t}=a;return aa({root:["root",t],ul:["ul"]},Oa,e)},Ka=G("nav",{name:"MuiPagination",slot:"Root",overridesResolver:(a,e)=>{const{ownerState:t}=a;return[e.root,e[t.variant]]}})({}),Qa=G("ul",{name:"MuiPagination",slot:"Ul",overridesResolver:(a,e)=>e.ul})({display:"flex",flexWrap:"wrap",alignItems:"center",padding:0,margin:0,listStyle:"none"});function Ja(a,e,t){return a==="page"?`${t?"":"Go to "}page ${e}`:`Go to ${a} page`}const Xa=L.forwardRef(function(e,t){const s=Z({props:e,name:"MuiPagination"}),{boundaryCount:p=1,className:c,color:v="standard",count:d=1,defaultPage:b=1,disabled:u=!1,getItemAriaLabel:C=Ja,hideNextButton:R=!1,hidePrevButton:B=!1,renderItem:l=n=>o.jsx(Ea,z({},n)),shape:g="circular",showFirstButton:$=!1,showLastButton:k=!1,siblingCount:x=1,size:i="medium",variant:h="text"}=s,j=H(s,Ua),{items:y}=Aa(z({},s,{componentName:"Pagination"})),I=z({},s,{boundaryCount:p,color:v,count:d,defaultPage:b,disabled:u,getItemAriaLabel:C,hideNextButton:R,hidePrevButton:B,renderItem:l,shape:g,showFirstButton:$,showLastButton:k,siblingCount:x,size:i,variant:h}),M=Ha(I);return o.jsx(Ka,z({"aria-label":"pagination navigation",className:Q(M.root,c),ownerState:I,ref:t},j,{children:o.jsx(Qa,{className:M.ul,ownerState:I,children:y.map((n,r)=>o.jsx("li",{children:l(z({},n,{color:v,"aria-label":C(n.type,n.page,n.selected),shape:g,size:i,variant:h}))},r))})}))});function Ya(a){return X("MuiToggleButton",a)}const U=Y("MuiToggleButton",["root","disabled","selected","standard","primary","secondary","sizeSmall","sizeMedium","sizeLarge","fullWidth"]),ha=L.createContext({}),ya=L.createContext(void 0);function Za(a,e){return e===void 0||a===void 0?!1:Array.isArray(e)?e.indexOf(a)>=0:a===e}const ae=["value"],ee=["children","className","color","disabled","disableFocusRipple","fullWidth","onChange","onClick","selected","size","value"],te=a=>{const{classes:e,fullWidth:t,selected:s,disabled:p,size:c,color:v}=a,d={root:["root",s&&"selected",p&&"disabled",t&&"fullWidth",`size${O(c)}`,v]};return aa(d,Ya,e)},oe=G(fa,{name:"MuiToggleButton",slot:"Root",overridesResolver:(a,e)=>{const{ownerState:t}=a;return[e.root,e[`size${O(t.size)}`]]}})(({theme:a,ownerState:e})=>{let t=e.color==="standard"?a.palette.text.primary:a.palette[e.color].main,s;return a.vars&&(t=e.color==="standard"?a.vars.palette.text.primary:a.vars.palette[e.color].main,s=e.color==="standard"?a.vars.palette.text.primaryChannel:a.vars.palette[e.color].mainChannel),z({},a.typography.button,{borderRadius:(a.vars||a).shape.borderRadius,padding:11,border:`1px solid ${(a.vars||a).palette.divider}`,color:(a.vars||a).palette.action.active},e.fullWidth&&{width:"100%"},{[`&.${U.disabled}`]:{color:(a.vars||a).palette.action.disabled,border:`1px solid ${(a.vars||a).palette.action.disabledBackground}`},"&:hover":{textDecoration:"none",backgroundColor:a.vars?`rgba(${a.vars.palette.text.primaryChannel} / ${a.vars.palette.action.hoverOpacity})`:J(a.palette.text.primary,a.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${U.selected}`]:{color:t,backgroundColor:a.vars?`rgba(${s} / ${a.vars.palette.action.selectedOpacity})`:J(t,a.palette.action.selectedOpacity),"&:hover":{backgroundColor:a.vars?`rgba(${s} / calc(${a.vars.palette.action.selectedOpacity} + ${a.vars.palette.action.hoverOpacity}))`:J(t,a.palette.action.selectedOpacity+a.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:a.vars?`rgba(${s} / ${a.vars.palette.action.selectedOpacity})`:J(t,a.palette.action.selectedOpacity)}}}},e.size==="small"&&{padding:7,fontSize:a.typography.pxToRem(13)},e.size==="large"&&{padding:15,fontSize:a.typography.pxToRem(15)})}),ua=L.forwardRef(function(e,t){const s=L.useContext(ha),{value:p}=s,c=H(s,ae),v=L.useContext(ya),d=Ra(z({},c,{selected:Za(e.value,p)}),e),b=Z({props:d,name:"MuiToggleButton"}),{children:u,className:C,color:R="standard",disabled:B=!1,disableFocusRipple:l=!1,fullWidth:g=!1,onChange:$,onClick:k,selected:x,size:i="medium",value:h}=b,j=H(b,ee),y=z({},b,{color:R,disabled:B,disableFocusRipple:l,fullWidth:g,size:i}),I=te(y),M=r=>{k&&(k(r,h),r.defaultPrevented)||$&&$(r,h)},n=v||"";return o.jsx(oe,z({className:Q(c.className,I.root,C,n),disabled:B,focusRipple:!l,ref:t,onClick:M,onChange:$,value:h,ownerState:y,"aria-pressed":x},j,{children:u}))});function se(a){return X("MuiToggleButtonGroup",a)}const _=Y("MuiToggleButtonGroup",["root","selected","horizontal","vertical","disabled","grouped","groupedHorizontal","groupedVertical","fullWidth","firstButton","lastButton","middleButton"]),re=["children","className","color","disabled","exclusive","fullWidth","onChange","orientation","size","value"],ie=a=>{const{classes:e,orientation:t,fullWidth:s,disabled:p}=a,c={root:["root",t==="vertical"&&"vertical",s&&"fullWidth"],grouped:["grouped",`grouped${O(t)}`,p&&"disabled"],firstButton:["firstButton"],lastButton:["lastButton"],middleButton:["middleButton"]};return aa(c,se,e)},ne=G("div",{name:"MuiToggleButtonGroup",slot:"Root",overridesResolver:(a,e)=>{const{ownerState:t}=a;return[{[`& .${_.grouped}`]:e.grouped},{[`& .${_.grouped}`]:e[`grouped${O(t.orientation)}`]},{[`& .${_.firstButton}`]:e.firstButton},{[`& .${_.lastButton}`]:e.lastButton},{[`& .${_.middleButton}`]:e.middleButton},e.root,t.orientation==="vertical"&&e.vertical,t.fullWidth&&e.fullWidth]}})(({ownerState:a,theme:e})=>z({display:"inline-flex",borderRadius:(e.vars||e).shape.borderRadius},a.orientation==="vertical"&&{flexDirection:"column"},a.fullWidth&&{width:"100%"},{[`& .${_.grouped}`]:z({},a.orientation==="horizontal"?{[`&.${_.selected} + .${_.grouped}.${_.selected}`]:{borderLeft:0,marginLeft:0}}:{[`&.${_.selected} + .${_.grouped}.${_.selected}`]:{borderTop:0,marginTop:0}})},a.orientation==="horizontal"?{[`& .${_.firstButton},& .${_.middleButton}`]:{borderTopRightRadius:0,borderBottomRightRadius:0},[`& .${_.lastButton},& .${_.middleButton}`]:{marginLeft:-1,borderLeft:"1px solid transparent",borderTopLeftRadius:0,borderBottomLeftRadius:0}}:{[`& .${_.firstButton},& .${_.middleButton}`]:{borderBottomLeftRadius:0,borderBottomRightRadius:0},[`& .${_.lastButton},& .${_.middleButton}`]:{marginTop:-1,borderTop:"1px solid transparent",borderTopLeftRadius:0,borderTopRightRadius:0}},a.orientation==="horizontal"?{[`& .${_.lastButton}.${U.disabled},& .${_.middleButton}.${U.disabled}`]:{borderLeft:"1px solid transparent"}}:{[`& .${_.lastButton}.${U.disabled},& .${_.middleButton}.${U.disabled}`]:{borderTop:"1px solid transparent"}})),le=L.forwardRef(function(e,t){const s=Z({props:e,name:"MuiToggleButtonGroup"}),{children:p,className:c,color:v="standard",disabled:d=!1,exclusive:b=!1,fullWidth:u=!1,onChange:C,orientation:R="horizontal",size:B="medium",value:l}=s,g=H(s,re),$=z({},s,{disabled:d,fullWidth:u,orientation:R,size:B}),k=ie($),x=L.useCallback((M,n)=>{if(!C)return;const r=l&&l.indexOf(n);let f;l&&r>=0?(f=l.slice(),f.splice(r,1)):f=l?l.concat(n):[n],C(M,f)},[C,l]),i=L.useCallback((M,n)=>{C&&C(M,l===n?null:n)},[C,l]),h=L.useMemo(()=>({className:k.grouped,onChange:b?i:x,value:l,size:B,fullWidth:u,color:v,disabled:d}),[k.grouped,b,i,x,l,B,u,v,d]),j=Na(p),y=j.length,I=M=>{const n=M===0,r=M===y-1;return n&&r?"":n?k.firstButton:r?k.lastButton:k.middleButton};return o.jsx(ne,z({role:"group",className:Q(k.root,c),ref:t,ownerState:$},g,{children:o.jsx(ha.Provider,{value:h,children:j.map((M,n)=>o.jsx(ya.Provider,{value:I(n),children:M},n))})}))}),ce=F(o.jsx("path",{d:"m20 12-1.41-1.41L13 16.17V4h-2v12.17l-5.58-5.59L4 12l8 8z"}),"ArrowDownward"),de=F(o.jsx("path",{d:"m4 12 1.41 1.41L11 7.83V20h2V7.83l5.58 5.59L20 12l-8-8z"}),"ArrowUpward"),pe=F(o.jsx("path",{d:"M3 14h4v-4H3zm0 5h4v-4H3zM3 9h4V5H3zm5 5h13v-4H8zm0 5h13v-4H8zM8 5v4h13V5z"}),"ViewList"),ue=F(o.jsx("path",{d:"M14.67 5v6.5H9.33V5zm1 6.5H21V5h-5.33zm-1 7.5v-6.5H9.33V19zm1-6.5V19H21v-6.5zm-7.34 0H3V19h5.33zm0-1V5H3v6.5z"}),"ViewModule"),sa={async getPackages(a={}){const{searchTerm:e,selectedTags:t=[],minStars:s,hasGithub:p,hasWebserver:c,hasPublication:v,minCitations:d,minRating:b,folder:u,category:C,selectedLicenses:R=[],sortBy:B,sortDirection:l="desc",page:g=1,pageSize:$=50,includeUserRatings:k=!1,currentUserId:x}=a;let i=P.from("packages").select(`
        *,
        package_tags!left(
          tag_id,
          tags!inner(id, name)
        ),
        package_folder_categories!left(
          folder_category_id,
          folder_categories!inner(
            id,
            folder_id,
            category_id,
            folders!inner(id, name),
            categories!inner(id, name)
          )
        )
      `,{count:"exact"});if(e&&e.trim()&&(i=i.or(`package_name.ilike.%${e}%,description.ilike.%${e}%`)),t.length>0){const{data:n}=await P.from("tags").select("id, name").in("name",t);if(n&&n.length>0){const r=n.map(f=>f.id);for(const f of r){const{data:T}=await P.from("package_tags").select("package_id").eq("tag_id",f);if(T&&T.length>0){const N=T.map(W=>W.package_id);i=i.in("id",N)}else i=i.eq("id","00000000-0000-0000-0000-000000000000")}}}if(u||C){let n=P.from("folder_categories").select("id");if(u){const{data:f}=await P.from("folders").select("id").eq("name",u).single();f&&(n=n.eq("folder_id",f.id))}if(C){const{data:f}=await P.from("categories").select("id").eq("name",C).single();f&&(n=n.eq("category_id",f.id))}const{data:r}=await n;if(r&&r.length>0){const f=r.map(N=>N.id),{data:T}=await P.from("package_folder_categories").select("package_id").in("folder_category_id",f);if(T&&T.length>0){const N=T.map(W=>W.package_id);i=i.in("id",N)}else i=i.eq("id","00000000-0000-0000-0000-000000000000")}}if(s!=null&&(i=i.gte("github_stars",s)),p&&(i=i.not("repo_link","is",null)),c&&(i=i.not("webserver","is",null)),v&&(i=i.not("publication","is",null)),d!=null&&(i=i.gte("citations",d)),b!=null&&(i=i.gte("average_rating",b)),R.length>0&&(i=i.in("license",R)),B){const n=l==="asc";i=i.order(B,{ascending:n})}if(g&&$){const n=(g-1)*$,r=n+$-1;i=i.range(n,r)}const{data:h,error:j,count:y}=await i;if(j)throw j;let I;if(k&&x&&h){const n=h.map(r=>r.id);if(n.length>0){const{data:r}=await P.from("ratings").select("package_id, rating, id").eq("user_id",x).in("package_id",n);r&&(I=new Map(r.map(f=>[f.package_id,{rating:f.rating,rating_id:f.id}])))}}return{packages:(h||[]).map(ga),totalCount:y||0,userRatings:I}},async getPackageById(a){const{data:e,error:t}=await P.from("packages").select(`
        *,
        package_folder_categories!left (
          folder_categories (
            folders (name),
            categories (name)
          )
        ),
        package_tags!left (
          tags (name)
        )
      `).eq("id",a).single();if(t)throw t;if(!e)throw new Error("Package not found");return ga(e)},async createPackage(a){const{tags:e,folder:t,category:s,...p}=a,{data:c,error:v}=await P.from("packages").insert(p).select().single();if(v)throw v;return e&&e.length>0&&await P.rpc("update_package_tags",{package_uuid:c.id,new_tags:e}),t&&s&&await P.rpc("update_package_folder_category",{package_uuid:c.id,folder_name:t,category_name:s}),sa.getPackageById(c.id)},async updatePackage(a,e){const{tags:t,folder:s,category:p,...c}=e,{error:v}=await P.from("packages").update(c).eq("id",a);if(v)throw v;return t!==void 0&&await P.rpc("update_package_tags",{package_uuid:a,new_tags:t}),(s!==void 0||p!==void 0)&&await P.rpc("update_package_folder_category",{package_uuid:a,folder_name:s||null,category_name:p||null}),sa.getPackageById(a)},async deletePackage(a){const{error:e}=await P.from("packages").delete().eq("id",a);if(e)throw e}};function ga(a){var e,t,s,p,c,v,d,b,u;return{...a,folder:((p=(s=(t=(e=a.package_folder_categories)==null?void 0:e[0])==null?void 0:t.folder_categories)==null?void 0:s.folders)==null?void 0:p.name)||"",category:((b=(d=(v=(c=a.package_folder_categories)==null?void 0:c[0])==null?void 0:v.folder_categories)==null?void 0:d.categories)==null?void 0:b.name)||"",tags:((u=a.package_tags)==null?void 0:u.map(C=>{var R;return(R=C.tags)==null?void 0:R.name}).filter(Boolean))||[]}}function ge(a={}){return xa({queryKey:ma.packages.list(a),queryFn:()=>sa.getPackages(a),staleTime:1e3*60*5,gcTime:1e3*60*30})}const fe={async getFilterMetadata(){var R,B,l,g,$,k;const[a,e,t,s,p,c]=await Promise.all([P.from("tags").select("name").order("name"),P.from("packages").select("license").not("license","is",null),P.from("folder_categories").select(`
        folders!inner(name),
        categories!inner(name)
      `).order("folders(name), categories(name)"),P.from("packages").select("github_stars").not("github_stars","is",null).order("github_stars",{ascending:!1}).limit(1),P.from("packages").select("citations").not("citations","is",null).order("citations",{ascending:!1}).limit(1),P.from("packages").select("id",{count:"exact",head:!0})]);if(a.error)throw a.error;if(e.error)throw e.error;if(t.error)throw t.error;if(s.error)throw s.error;if(p.error)throw p.error;if(c.error)throw c.error;const v=((R=a.data)==null?void 0:R.map(x=>x.name))||[],d=Array.from(new Set((B=e.data)==null?void 0:B.map(x=>x.license).filter(Boolean))).sort(),b=t.data||[],u={};b.forEach(x=>{var j,y;const i=(j=x.folders)==null?void 0:j.name,h=(y=x.categories)==null?void 0:y.name;i&&h&&(u[i]||(u[i]=[]),u[i].includes(h)||u[i].push(h))}),Object.keys(u).forEach(x=>{u[x].sort()});const C=Object.keys(u).sort();return{allAvailableTags:v,allAvailableLicenses:d,allAvailableFolders:C,allAvailableCategories:u,datasetMaxStars:((g=(l=s.data)==null?void 0:l[0])==null?void 0:g.github_stars)||0,datasetMaxCitations:((k=($=p.data)==null?void 0:$[0])==null?void 0:k.citations)||0,totalPackageCount:c.count||0}}};function ve(){return xa({queryKey:ma.metadata.all(),queryFn:fe.getFilterMetadata,staleTime:1e3*60*30,gcTime:1e3*60*60})}const xe=L.lazy(()=>va(()=>import("./PackageCard-C38subE4.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8]))),me=L.lazy(()=>va(()=>import("./PackageList-DZZlkcms.js"),__vite__mapDeps([9,1,2,3,4,5,6,7]))),ke=()=>{const{currentUser:a}=ja(),e=(a==null?void 0:a.id)||null,{searchTerm:t,selectedTags:s,minStars:p,hasGithub:c,hasWebserver:v,hasPublication:d,minCitations:b,minRating:u,folder:C,category:R,selectedLicenses:B,sortBy:l,sortDirection:g,viewMode:$,currentPage:k}=ta(ia(m=>({searchTerm:m.searchTerm,selectedTags:m.selectedTags,minStars:m.minStars,hasGithub:m.hasGithub,hasWebserver:m.hasWebserver,hasPublication:m.hasPublication,minCitations:m.minCitations,minRating:m.minRating,folder:m.folder,category:m.category,selectedLicenses:m.selectedLicenses,sortBy:m.sortBy,sortDirection:m.sortDirection,viewMode:m.viewMode,currentPage:m.currentPage}))),{setSort:x,setViewMode:i,setCurrentPage:h}=ta(ia(m=>({setSort:m.setSort,setViewMode:m.setViewMode,setCurrentPage:m.setCurrentPage}))),j=24,{data:y,isLoading:I,error:M}=ve(),n={searchTerm:t,selectedTags:s,minStars:p,hasGithub:c,hasWebserver:v,hasPublication:d,minCitations:b,minRating:u,folder:C,category:R,selectedLicenses:B,sortBy:l,sortDirection:g,page:k,pageSize:j,includeUserRatings:!!e,currentUserId:e},{data:r,isLoading:f,error:T}=ge(n);L.useEffect(()=>{y&&ta.setState({allAvailableTags:y.allAvailableTags,allAvailableLicenses:y.allAvailableLicenses,allAvailableFolders:y.allAvailableFolders,allAvailableCategories:y.allAvailableCategories,datasetMaxStars:y.datasetMaxStars,datasetMaxCitations:y.datasetMaxCitations})},[y]);const N=(r==null?void 0:r.packages)||[],W=(r==null?void 0:r.totalCount)||0,K=I||f,S=M||T,ea=I?"metadata":f?"packages":"none",Ca=(m,D)=>{h(D),window.scrollTo(0,0)},ka=m=>{const D=m.target.value;h(1),x(D===""?null:D,g)},_a=()=>{h(1),x(l,g==="asc"?"desc":"asc")},Ba=(m,D)=>{D!==null&&i(D)},$a=o.jsx(A,{display:"flex",justifyContent:"center",py:4,children:o.jsx(oa,{})}),ra=Math.ceil(W/j);return o.jsxs(Ma,{maxWidth:"lg",sx:{pt:2,px:{xs:1,sm:2},pb:0},children:[S&&!K&&o.jsx(A,{py:4,children:o.jsxs(La,{severity:"error",sx:{mb:2},children:[o.jsx(V,{variant:"body1",fontWeight:"medium",children:(S==null?void 0:S.message)||"An error occurred"}),o.jsx(V,{variant:"body2",sx:{mt:1},children:"Please try again or refresh the page. If the problem persists, contact support."})]})}),K&&ea==="metadata"&&o.jsxs(A,{display:"flex",flexDirection:"column",alignItems:"center",py:6,gap:2,children:[o.jsx(oa,{}),o.jsx(V,{variant:"body1",color:"text.secondary",align:"center",children:"Loading filter options..."}),o.jsx(V,{variant:"body2",color:"text.secondary",align:"center",sx:{maxWidth:600},children:"Loading filter options for the best browsing experience."})]}),ea!=="metadata"&&o.jsxs(A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,flexWrap:"wrap",gap:1},children:[o.jsx(A,{sx:{display:"flex",alignItems:"center",gap:2},children:K&&ea==="packages"?o.jsxs(A,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[o.jsx(oa,{size:24}),o.jsx(V,{variant:"h4",component:"h1",sx:{color:"text.secondary",fontWeight:500,letterSpacing:"-0.01em"},children:"Loading packages..."})]}):o.jsxs(V,{variant:"h4",component:"h1",sx:{mb:{xs:1,sm:0},color:"text.primary",fontWeight:500,letterSpacing:"-0.01em"},children:[W," Entries Found"]})}),o.jsxs(A,{sx:{display:"flex",alignItems:"center",gap:1,flexWrap:"wrap"},children:[o.jsx(V,{variant:"body2",sx:{mr:1,minWidth:55,color:"text.secondary"},children:"Sort by:"}),o.jsx(Ia,{size:"small",variant:"outlined",sx:{minWidth:150},children:o.jsxs(wa,{id:"sort-by-select",name:"sortBy",value:l??"",displayEmpty:!0,onChange:ka,MenuProps:{PaperProps:{sx:{mt:1,borderRadius:2,minWidth:180}}},children:[o.jsx(E,{value:"package_name",children:"Name"}),o.jsx(E,{value:"average_rating",children:"Rating"}),o.jsx(E,{value:"ratings_count",children:"Number of Ratings"}),o.jsx(E,{value:"github_stars",children:"GitHub Stars"}),o.jsx(E,{value:"citations",children:"Citations"}),o.jsx(E,{value:"last_commit",children:"Last Commit"})]})}),o.jsx(Ta,{onClick:_a,size:"small","aria-label":"toggle sort direction",sx:{border:"1px solid",borderColor:"divider",ml:1,background:m=>m.palette.mode==="dark"?"rgba(255,255,255,0.08)":"rgba(0,0,0,0.04)","&:hover":{background:m=>m.palette.action.hover}},children:g==="asc"?o.jsx(de,{fontSize:"small"}):o.jsx(ce,{fontSize:"small"})}),o.jsxs(le,{value:$,exclusive:!0,onChange:Ba,"aria-label":"view mode",size:"small",sx:{ml:{sm:2},background:"transparent",borderRadius:2},children:[o.jsx(ua,{value:"card","aria-label":"card view",sx:{borderRadius:1,px:1.5},children:o.jsx(ue,{})}),o.jsx(ua,{value:"list","aria-label":"list view",sx:{borderRadius:1,px:1.5},children:o.jsx(pe,{})})]})]})]}),!K&&!S&&o.jsx(L.Suspense,{fallback:$a,children:$==="card"?o.jsxs(L.Fragment,{children:[o.jsx(na,{container:!0,spacing:2,sx:{p:0},children:N.map(m=>o.jsx(na,{item:!0,xs:12,sm:6,md:4,lg:3,children:o.jsx(xe,{pkg:m})},m.id))}),ra>1&&o.jsx(A,{sx:{display:"flex",justifyContent:"center",mt:4,mb:2},children:o.jsx(Xa,{count:ra,page:k,onChange:Ca,color:"primary"})})]}):o.jsx(me,{packages:N})}),!K&&!S&&N.length===0&&W===0&&o.jsxs(A,{sx:{textAlign:"center",mt:4,py:4},children:[o.jsx(V,{variant:"h6",color:"text.secondary",children:"No packages found matching your criteria."}),o.jsx(V,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"Try adjusting your filters or search terms."})]})]})};export{ke as default};
