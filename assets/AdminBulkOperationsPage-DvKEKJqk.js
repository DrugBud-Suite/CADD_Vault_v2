import{c as me,j as e,n as fa,O as ja,r as o,o as ee,p as ya,a2 as A,C as ae,t as T,A as g,T as c,q as h,G as i,R as q,F as D,a4 as M,S as U,M as b,a5 as te,N as F,m as j,a3 as W,H as $,au as We,aq as ze,I as De,al as Me,am as Ue,an as _e,ao as se,ap as x,ar as He}from"./index-3_hS9l67.js";import{DataService as xe}from"./dataService-DojXjL3Z.js";import{T as ba,a as pe}from"./Tabs-Bye9hgIW.js";import{F as va,C as Re}from"./FolderOutlined-Bx9gsriB.js";const Le=me(e.jsx("path",{d:"M13 7h-2v4H7v2h4v4h2v-4h4v-2h-4zm-1-5C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8"}),"AddCircleOutline"),qe=me(e.jsx("path",{d:"M19 9h-4V3H9v6H5l7 7zM5 18v2h14v-2z"}),"FileDownload"),Be=me(e.jsx("path",{d:"M20 6h-8l-2-2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2m0 12H4V6h5.17l2 2H20zm-6.92-3.96L12.39 17 15 15.47 17.61 17l-.69-2.96 2.3-1.99-3.03-.26L15 9l-1.19 2.79-3.03.26z"}),"FolderSpecialOutlined"),Oa=()=>{var Ne;const{currentUser:Ye,loading:Je,isAdmin:_}=fa(),m=ja(),[E,Ve]=o.useState(0),[n,v]=o.useState({operation:"update",filterOptions:{folder:null,category:null,tags:[]},updateOptions:{folder:null,category:null,addTags:[],removeTags:[]}}),[r,B]=o.useState({newFolder:"",selectedFolder:"",newCategory:""}),[d,Y]=o.useState({oldTag:"",newTag:""}),[re,J]=o.useState(!1),[H,V]=o.useState(!1),[fe,z]=o.useState(null),[je,ye]=o.useState(null),[be,I]=o.useState(null),[ve,Ce]=o.useState(null),[le,ne]=o.useState(!1),[we,p]=o.useState(null),[Te,ie]=o.useState(null),[oe,G]=o.useState(0),[N,K]=o.useState([]),[de,Fe]=o.useState(!1),[Q,ce]=o.useState(!1),[ge,Oe]=o.useState(!1),[ke,O]=o.useState(null),[Se,Pe]=o.useState(null),[R,he]=o.useState(null),[C,Ae]=o.useState([]),[X,$e]=o.useState(!1),[Ge,L]=o.useState(!1),{allAvailableTags:k,allAvailableFolders:w,allAvailableCategories:y}=ee(ya(a=>({allAvailableTags:a.allAvailableTags,allAvailableFolders:a.allAvailableFolders,allAvailableCategories:a.allAvailableCategories}))),Ke=n.filterOptions.folder&&y[n.filterOptions.folder]?y[n.filterOptions.folder]:[],Ee=o.useCallback(async()=>{$e(!0),L(!0),O(null);try{let a=A.from("packages").select("*");n.filterOptions.folder&&(a=a.eq("folder1",n.filterOptions.folder)),n.filterOptions.folder&&n.filterOptions.category&&(a=a.eq("category1",n.filterOptions.category)),a=xe.applyTagFilters(a,n.filterOptions.tags,"AND");const{data:t,error:s}=await a;if(s)throw s;Ae(t||[])}catch(a){console.error("Error fetching matching packages:",a),O(`Failed to load matching packages: ${a.message}`),Ae([])}finally{$e(!1)}},[n.filterOptions]),Qe=o.useCallback(async()=>{if(!d.oldTag.trim()){p("Please select a tag to preview affected packages.");return}Fe(!0),ce(!0),p(null);try{const a=await xe.fetchPackagesWithTag(d.oldTag.trim());K(a),G(a.length),a.length===0&&p(`No packages found with tag "${d.oldTag.trim()}".`)}catch(a){console.error("Error fetching packages with tag:",a),p(`Failed to load packages with tag: ${a.message}`),K([])}finally{Fe(!1)}},[d.oldTag]),Xe=a=>{v(t=>({...t,operation:a.target.value})),L(!1)},Ze=a=>{const t=a.target.value==="null"?null:a.target.value;v(s=>({...s,filterOptions:{...s.filterOptions,folder:t,category:null}})),L(!1)},ea=a=>{const t=a.target.value==="null"?null:a.target.value;v(s=>({...s,filterOptions:{...s.filterOptions,category:t}})),L(!1)},aa=(a,t)=>{v(s=>({...s,filterOptions:{...s.filterOptions,tags:t}})),L(!1)},ta=a=>{const t=a.target.value==="null"?null:a.target.value;v(s=>({...s,updateOptions:{...s.updateOptions,folder:t,category:null}}))},sa=a=>{const t=a.target.value==="null"?null:a.target.value;v(s=>({...s,updateOptions:{...s.updateOptions,category:t}}))},ra=(a,t)=>{v(s=>({...s,updateOptions:{...s.updateOptions,addTags:t}}))},la=(a,t)=>{v(s=>({...s,updateOptions:{...s.updateOptions,removeTags:t}}))},na=(a,t)=>{Ve(t)},Ie=a=>{const{name:t,value:s}=a.target;B(l=>({...l,[t]:s}))},ia=a=>{const{name:t,value:s}=a.target;Y(l=>({...l,[t]:s}))},oa=(a,t)=>{t&&(Y(s=>({...s,oldTag:t})),ce(!1),K([]))},da=async()=>{if(!_){p("You must be an admin to perform this operation.");return}if(!d.oldTag.trim()){p("Please select a tag to replace.");return}if(!d.newTag.trim()){p("Please enter a new tag name.");return}ne(!0),p(null),ie(null),G(0);try{let a=[];if(Q&&N.length>0?a=N:a=await xe.fetchPackagesWithTag(d.oldTag.trim()),a.length===0){p(`No packages found with tag "${d.oldTag.trim()}".`),ne(!1);return}let t=0,s=0;for(const u of a)try{const Z=(u.tags||[]).map(P=>P===d.oldTag.trim()?d.newTag.trim():P),{error:S}=await A.from("packages").update({tags:Z}).eq("id",u.id);if(S)throw S;t++}catch(f){console.error("Error updating package tags:",f),s++}G(t),ie(`Successfully updated tag "${d.oldTag.trim()}" to "${d.newTag.trim()}" in ${t} packages.`),s>0&&p(`Failed to update tags in ${s} packages.`),Y({oldTag:"",newTag:""});const l=[...k];if(l.includes(d.newTag.trim())||l.push(d.newTag.trim()),t===a.length){const u=l.indexOf(d.oldTag.trim());u!==-1&&l.splice(u,1)}ee.setState({allAvailableTags:l.sort()})}catch(a){console.error("Error updating tags:",a),p(`Failed to update tags: ${a.message}`)}finally{ne(!1)}},ca=a=>{B(t=>({...t,selectedFolder:a.target.value}))},ga=async()=>{if(!_){z("You must be an admin to perform this operation.");return}if(!r.newFolder.trim()){z("Please enter a folder name.");return}J(!0),z(null),ye(null);try{if(w.includes(r.newFolder.trim())){z(`Folder "${r.newFolder.trim()}" already exists.`),J(!1);return}const{data:a,error:t}=await A.from("packages").select("folder1").eq("folder1",r.newFolder.trim()).limit(1);if(t)throw t;if(a&&a.length>0){z(`Folder "${r.newFolder.trim()}" already exists in the database.`),J(!1);return}const{error:s}=await A.from("packages").insert({package_name:`__folder_placeholder_${Date.now()}`,folder1:r.newFolder.trim(),description:`This is a placeholder entry to establish the folder "${r.newFolder.trim()}". This entry can be safely deleted once other packages use this folder.`,last_updated:new Date().toISOString()});if(s)throw s;const l=[...w,r.newFolder.trim()].sort(),u={...y,[r.newFolder.trim()]:[]};B(f=>({...f,newFolder:""})),ye(`Folder "${r.newFolder.trim()}" has been created successfully.`),ee.setState({allAvailableFolders:l,allAvailableCategories:u})}catch(a){console.error("Error creating folder:",a),z(`Failed to create folder: ${a.message}`)}finally{J(!1)}},ha=async()=>{var a;if(!_){I("You must be an admin to perform this operation.");return}if(!r.selectedFolder){I("Please select a folder.");return}if(!r.newCategory.trim()){I("Please enter a category name.");return}V(!0),I(null),Ce(null);try{if((a=y[r.selectedFolder])!=null&&a.includes(r.newCategory.trim())){I(`Category "${r.newCategory.trim()}" already exists in this folder.`),V(!1);return}const{data:t,error:s}=await A.from("packages").select("category1").eq("folder1",r.selectedFolder).eq("category1",r.newCategory.trim()).limit(1);if(s)throw s;if(t&&t.length>0){I(`Category "${r.newCategory.trim()}" already exists in this folder.`),V(!1);return}const{error:l}=await A.from("packages").insert({package_name:`__category_placeholder_${Date.now()}`,folder1:r.selectedFolder,category1:r.newCategory.trim(),description:`This is a placeholder entry to establish the category "${r.newCategory.trim()}" in folder "${r.selectedFolder}". This entry can be safely deleted once other packages use this category.`,last_updated:new Date().toISOString()});if(l)throw l;const u={...y,[r.selectedFolder]:[...y[r.selectedFolder]||[],r.newCategory.trim()].sort()};B(f=>({...f,newCategory:""})),Ce(`Category "${r.newCategory.trim()}" has been created successfully in folder "${r.selectedFolder}".`),ee.setState({allAvailableCategories:u})}catch(t){console.error("Error creating category:",t),I(`Failed to create category: ${t.message}`)}finally{V(!1)}},ua=async()=>{if(!_){O("You must be an admin to perform this operation.");return}if(C.length===0){O("No packages match the current filter criteria.");return}if(!(n.updateOptions.folder!==null||n.updateOptions.category!==null||n.updateOptions.addTags.length>0||n.updateOptions.removeTags.length>0)){O("Please specify at least one update option.");return}Oe(!0),O(null),Pe(null),he(null);try{const t=C.map(u=>u.id);let s=0,l=0;for(const u of t)try{const{data:f,error:Z}=await A.from("packages").select("*").eq("id",u).single();if(Z)throw Z;if(!f)continue;const S={};if(n.updateOptions.folder!==null&&(S.folder1=n.updateOptions.folder),n.updateOptions.category!==null&&(S.category1=n.updateOptions.category),n.updateOptions.addTags.length>0||n.updateOptions.removeTags.length>0){const P=f.tags||[],pa=n.updateOptions.addTags.filter(ue=>!P.includes(ue)),ma=P.filter(ue=>!n.updateOptions.removeTags.includes(ue));S.tags=[...ma,...pa]}if(Object.keys(S).length>0){const{error:P}=await A.from("packages").update(S).eq("id",u);if(P)throw P;s++}}catch(f){console.error("Error updating package:",f),l++}he({status:l>0?s>0?"warning":"error":"success",message:`Operation completed with ${s} packages updated successfully${l>0?` and ${l} errors`:""}.`,affectedPackages:s}),Pe(`Successfully updated ${s} packages.`),l>0&&O(`Failed to update ${l} packages.`),await Ee()}catch(t){console.error("Error executing bulk operation:",t),O(`Failed to execute operation: ${t.message}`),he({status:"error",message:`Operation failed: ${t.message}`,affectedPackages:0})}finally{Oe(!1)}},xa=()=>{if(C.length===0)return;const a=JSON.stringify(C,null,2),t="data:application/json;charset=utf-8,"+encodeURIComponent(a),s=`cadd-vault-packages-${new Date().toISOString()}.json`,l=document.createElement("a");l.setAttribute("href",t),l.setAttribute("download",s),l.click()};return Je?e.jsx(ae,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"80vh"},children:e.jsx(T,{})}):Ye?_?e.jsxs(ae,{sx:{py:4},children:[e.jsx(c,{variant:"h4",component:"h1",gutterBottom:!0,sx:{fontWeight:"bold"},children:"Database Administration"}),e.jsx(c,{variant:"subtitle1",color:"text.secondary",gutterBottom:!0,children:"Manage database entries and structure."}),e.jsx(h,{sx:{borderBottom:1,borderColor:"divider",mb:2},children:e.jsxs(ba,{value:E,onChange:na,"aria-label":"admin operations tabs",children:[e.jsx(pe,{label:"Bulk Updates",id:"admin-tab-0","aria-controls":"admin-tabpanel-0"}),e.jsx(pe,{label:"Folder & Category Management",id:"admin-tab-1","aria-controls":"admin-tabpanel-1"}),e.jsx(pe,{label:"Tag Management",id:"admin-tab-2","aria-controls":"admin-tabpanel-2"})]})}),e.jsx("div",{role:"tabpanel",hidden:E!==0,id:"admin-tabpanel-0","aria-labelledby":"admin-tab-0",children:E===0&&e.jsxs(i,{container:!0,spacing:3,children:[e.jsx(i,{item:!0,xs:12,children:e.jsxs(q,{elevation:3,sx:{p:3,mt:2},children:[e.jsx(c,{variant:"h6",gutterBottom:!0,children:"Operation Settings"}),e.jsxs(D,{fullWidth:!0,sx:{mb:3},children:[e.jsx(M,{children:"Operation Type"}),e.jsx(U,{value:n.operation,onChange:Xe,label:"Operation Type",children:e.jsx(b,{value:"update",children:"Update Packages"})})]}),e.jsxs(h,{sx:{mb:4},children:[e.jsxs(c,{variant:"subtitle1",sx:{mb:2,display:"flex",alignItems:"center"},children:[e.jsx(va,{sx:{mr:1}}),"Filter Criteria"]}),e.jsx(g,{severity:"info",sx:{mb:2},children:"Define which packages will be affected by this operation."}),e.jsxs(i,{container:!0,spacing:2,children:[e.jsx(i,{item:!0,xs:12,sm:6,children:e.jsxs(D,{fullWidth:!0,children:[e.jsx(M,{children:"Folder"}),e.jsxs(U,{value:n.filterOptions.folder||"null",onChange:Ze,label:"Folder",children:[e.jsx(b,{value:"null",children:"Any Folder"}),w.map(a=>e.jsx(b,{value:a,children:a},a))]})]})}),e.jsx(i,{item:!0,xs:12,sm:6,children:e.jsxs(D,{fullWidth:!0,disabled:!n.filterOptions.folder,children:[e.jsx(M,{children:"Category"}),e.jsxs(U,{value:n.filterOptions.category||"null",onChange:ea,label:"Category",children:[e.jsx(b,{value:"null",children:"Any Category"}),Ke.map(a=>e.jsx(b,{value:a,children:a},a))]})]})}),e.jsx(i,{item:!0,xs:12,children:e.jsx(te,{multiple:!0,id:"filter-tags",options:k,value:n.filterOptions.tags,onChange:aa,renderInput:a=>e.jsx(W,{...a,label:"Has Tags",placeholder:"Select tags to filter by",helperText:"Only packages having ALL selected tags will be affected"}),renderTags:(a,t)=>a.map((s,l)=>e.jsx(F,{variant:"outlined",label:s,...t({index:l}),sx:{bgcolor:j(m.palette.primary.main,.1),borderColor:j(m.palette.primary.main,.3)}}))})})]})]}),e.jsx($,{variant:"outlined",color:"primary",onClick:Ee,disabled:X,sx:{mb:4},children:X?e.jsx(T,{size:24}):"Preview Matching Packages"}),e.jsx(We,{sx:{mb:4}}),e.jsxs(h,{sx:{mb:4},children:[e.jsxs(c,{variant:"subtitle1",sx:{mb:2,display:"flex",alignItems:"center"},children:[e.jsx(Re,{sx:{mr:1}}),"Update Options"]}),e.jsx(g,{severity:"warning",sx:{mb:2},children:"Specify the changes to apply to all matching packages."}),e.jsxs(i,{container:!0,spacing:2,children:[e.jsx(i,{item:!0,xs:12,sm:6,children:e.jsxs(D,{fullWidth:!0,children:[e.jsx(M,{children:"Change Folder To"}),e.jsxs(U,{value:n.updateOptions.folder||"null",onChange:ta,label:"Change Folder To",children:[e.jsx(b,{value:"null",children:"No Change"}),w.map(a=>e.jsx(b,{value:a,children:a},a))]})]})}),e.jsx(i,{item:!0,xs:12,sm:6,children:e.jsxs(D,{fullWidth:!0,children:[e.jsx(M,{children:"Change Category To"}),e.jsxs(U,{value:n.updateOptions.category||"null",onChange:sa,label:"Change Category To",children:[e.jsx(b,{value:"null",children:"No Change"}),Object.values(y).flat().filter((a,t,s)=>s.indexOf(a)===t).sort().map(a=>e.jsx(b,{value:a,children:a},a))]})]})}),e.jsx(i,{item:!0,xs:12,sm:6,children:e.jsx(te,{multiple:!0,id:"add-tags",options:k.filter(a=>!n.updateOptions.addTags.includes(a)),value:n.updateOptions.addTags,onChange:ra,renderInput:a=>e.jsx(W,{...a,label:"Add Tags",placeholder:"Select tags to add",helperText:"These tags will be added to all matching packages"}),renderTags:(a,t)=>a.map((s,l)=>e.jsx(F,{variant:"outlined",label:s,...t({index:l}),sx:{bgcolor:j(m.palette.success.main,.1),borderColor:j(m.palette.success.main,.3)}}))})}),e.jsx(i,{item:!0,xs:12,sm:6,children:e.jsx(te,{multiple:!0,id:"remove-tags",options:k.filter(a=>!n.updateOptions.removeTags.includes(a)),value:n.updateOptions.removeTags,onChange:la,renderInput:a=>e.jsx(W,{...a,label:"Remove Tags",placeholder:"Select tags to remove",helperText:"These tags will be removed from all matching packages"}),renderTags:(a,t)=>a.map((s,l)=>e.jsx(F,{variant:"outlined",label:s,...t({index:l}),sx:{bgcolor:j(m.palette.error.main,.1),borderColor:j(m.palette.error.main,.3)}}))})})]})]}),ke&&e.jsx(g,{severity:"error",sx:{mb:2},children:ke}),Se&&e.jsx(g,{severity:"success",sx:{mb:2},children:Se}),R&&e.jsxs(g,{severity:R.status,sx:{mb:2},children:[R.message,R.details&&e.jsx(c,{variant:"body2",mt:1,children:R.details})]}),e.jsx($,{variant:"contained",color:"primary",disabled:ge||C.length===0,onClick:ua,sx:{mr:2},children:ge?e.jsx(T,{size:24}):"Execute Operation"}),e.jsx($,{variant:"outlined",color:"secondary",onClick:()=>v({operation:"update",filterOptions:{folder:null,category:null,tags:[]},updateOptions:{folder:null,category:null,addTags:[],removeTags:[]}}),disabled:ge,children:"Reset Form"})]})}),Ge&&e.jsx(i,{item:!0,xs:12,children:e.jsxs(q,{elevation:3,sx:{p:3,mt:2},children:[e.jsxs(h,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(c,{variant:"h6",children:X?"Loading Matching Packages...":`Matching Packages (${C.length})`}),C.length>0&&e.jsx(ze,{title:"Download as JSON",children:e.jsx(De,{onClick:xa,color:"primary",children:e.jsx(qe,{})})})]}),X?e.jsx(h,{sx:{display:"flex",justifyContent:"center",p:4},children:e.jsx(T,{})}):C.length===0?e.jsx(g,{severity:"info",children:"No packages match the selected filter criteria."}):e.jsx(Me,{sx:{maxHeight:400},children:e.jsxs(Ue,{stickyHeader:!0,children:[e.jsx(_e,{children:e.jsxs(se,{children:[e.jsx(x,{sx:{fontWeight:"bold"},children:"Package Name"}),e.jsx(x,{sx:{fontWeight:"bold"},children:"Folder"}),e.jsx(x,{sx:{fontWeight:"bold"},children:"Category"}),e.jsx(x,{sx:{fontWeight:"bold"},children:"Tags"})]})}),e.jsx(He,{children:C.map(a=>{var t,s,l;return e.jsxs(se,{hover:!0,children:[e.jsx(x,{children:a.package_name}),e.jsx(x,{children:a.folder1||"—"}),e.jsx(x,{children:a.category1||"—"}),e.jsx(x,{children:e.jsxs(h,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:[(t=a.tags)==null?void 0:t.slice(0,5).map(u=>e.jsx(F,{label:u,size:"small",sx:{fontSize:"0.75rem",height:22}},u)),(((s=a.tags)==null?void 0:s.length)||0)>5&&e.jsx(F,{label:`+${(((l=a.tags)==null?void 0:l.length)||0)-5} more`,size:"small",variant:"outlined",sx:{fontSize:"0.75rem",height:22}}),(!a.tags||a.tags.length===0)&&e.jsx(c,{variant:"body2",color:"text.secondary",children:"No tags"})]})})]},a.id)})})]})})]})})]})}),e.jsx("div",{role:"tabpanel",hidden:E!==2,id:"admin-tabpanel-2","aria-labelledby":"admin-tab-2",children:E===2&&e.jsx(i,{container:!0,spacing:3,children:e.jsx(i,{item:!0,xs:12,children:e.jsxs(q,{elevation:3,sx:{p:3},children:[e.jsxs(c,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center"},children:[e.jsx(Be,{sx:{mr:1}}),"Tag Management"]}),e.jsx(g,{severity:"info",sx:{mb:3},children:"Find and correct tags with typos. Changes will be applied to all packages that have the selected tag."}),we&&e.jsx(g,{severity:"error",sx:{mb:2},children:we}),Te&&e.jsx(g,{severity:"success",sx:{mb:2},children:Te}),e.jsxs(i,{container:!0,spacing:2,sx:{mb:3},children:[e.jsx(i,{item:!0,xs:12,sm:6,children:e.jsx(te,{options:k,value:d.oldTag,onChange:(a,t)=>oa(a,t),renderInput:a=>e.jsx(W,{...a,label:"Tag to Replace",name:"oldTag",fullWidth:!0,helperText:"Select the tag that has a typo or needs to be renamed"})})}),e.jsx(i,{item:!0,xs:12,sm:6,children:e.jsx(W,{label:"New Tag Name",name:"newTag",value:d.newTag,onChange:ia,fullWidth:!0,helperText:"Enter the corrected tag name"})})]}),e.jsxs(h,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx($,{variant:"outlined",color:"primary",onClick:Qe,disabled:de||!d.oldTag,children:de?e.jsx(T,{size:24}):"Preview Affected Packages"}),!Q&&d.oldTag&&e.jsx(c,{variant:"body2",sx:{alignSelf:"center",fontStyle:"italic"},children:"Click to see which packages will be affected"})]}),e.jsxs(h,{sx:{display:"flex",gap:2},children:[e.jsx($,{variant:"contained",color:"primary",onClick:da,disabled:le||!d.oldTag||!d.newTag||oe===0,sx:{mr:2},children:le?e.jsx(T,{size:24}):"Update Tag"}),e.jsx($,{variant:"outlined",color:"secondary",onClick:()=>{Y({oldTag:"",newTag:""}),p(null),ie(null),ce(!1),K([]),G(0)},disabled:le,children:"Reset Form"})]}),oe>0&&!Q&&e.jsx(h,{sx:{mt:3},children:e.jsxs(c,{variant:"subtitle2",children:["Tags updated in ",oe," packages"]})}),e.jsx(We,{sx:{my:3}}),e.jsxs(c,{variant:"subtitle1",sx:{mb:2},children:["Available Tags (",k.length,")"]}),e.jsx(h,{sx:{maxHeight:200,overflowY:"auto",border:1,borderColor:"divider",borderRadius:1,p:1},children:k.length>0?e.jsx(h,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:k.map(a=>e.jsx(F,{label:a,size:"small",sx:{bgcolor:j(m.palette.primary.main,.1)}},a))}):e.jsx(c,{variant:"body2",color:"text.secondary",children:"No tags available"})}),Q&&e.jsxs(h,{sx:{mt:3},children:[e.jsxs(c,{variant:"subtitle1",sx:{mb:2,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("span",{children:['Packages With Tag "',d.oldTag,'" (',N.length,")"]}),N.length>0&&e.jsx(ze,{title:"Download as JSON",children:e.jsx(De,{size:"small",onClick:()=>{const a=JSON.stringify(N,null,2),t="data:application/json;charset=utf-8,"+encodeURIComponent(a),s=`packages-with-tag-${d.oldTag}-${new Date().toISOString()}.json`,l=document.createElement("a");l.setAttribute("href",t),l.setAttribute("download",s),l.click()},children:e.jsx(qe,{})})})]}),de?e.jsx(h,{sx:{display:"flex",justifyContent:"center",p:3},children:e.jsx(T,{})}):N.length===0?e.jsx(g,{severity:"info",children:"No packages found with this tag."}):e.jsx(Me,{sx:{maxHeight:400},children:e.jsxs(Ue,{stickyHeader:!0,size:"small",children:[e.jsx(_e,{children:e.jsxs(se,{children:[e.jsx(x,{children:"Package Name"}),e.jsx(x,{children:"Folder"}),e.jsx(x,{children:"Category"}),e.jsx(x,{children:"Tags"})]})}),e.jsx(He,{children:N.map(a=>e.jsxs(se,{hover:!0,children:[e.jsx(x,{children:a.package_name}),e.jsx(x,{children:a.folder1||"None"}),e.jsx(x,{children:a.category1||"None"}),e.jsx(x,{children:e.jsxs(h,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:[a.tags&&a.tags.map(t=>e.jsx(F,{label:t,size:"small",sx:{bgcolor:t===d.oldTag?j(m.palette.warning.main,.2):j(m.palette.primary.main,.1),fontWeight:t===d.oldTag?"bold":"normal",height:22}},`${a.id}-${t}`)),(!a.tags||a.tags.length===0)&&e.jsx(c,{variant:"body2",color:"text.secondary",children:"No tags"})]})})]},a.id))})]})})]})]})})})}),e.jsx("div",{role:"tabpanel",hidden:E!==1,id:"admin-tabpanel-1","aria-labelledby":"admin-tab-1",children:E===1&&e.jsxs(i,{container:!0,spacing:3,children:[e.jsx(i,{item:!0,xs:12,md:6,children:e.jsxs(q,{elevation:3,sx:{p:3},children:[e.jsxs(c,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center"},children:[e.jsx(Be,{sx:{mr:1}}),"Create New Folder"]}),e.jsx(g,{severity:"info",sx:{mb:3},children:"Add a new top-level folder to organize packages. Folders are the main classification groups."}),fe&&e.jsx(g,{severity:"error",sx:{mb:2},children:fe}),je&&e.jsx(g,{severity:"success",sx:{mb:2},children:je}),e.jsxs(i,{container:!0,spacing:2,children:[e.jsx(i,{item:!0,xs:12,children:e.jsx(W,{fullWidth:!0,label:"New Folder Name",name:"newFolder",value:r.newFolder,onChange:Ie,placeholder:"Enter folder name",helperText:"This will create a new folder in the database"})}),e.jsx(i,{item:!0,xs:12,children:e.jsx($,{variant:"contained",color:"primary",onClick:ga,disabled:re||!r.newFolder.trim(),startIcon:re?e.jsx(T,{size:20}):e.jsx(Le,{}),fullWidth:!0,children:re?"Creating...":"Create Folder"})})]}),e.jsxs(c,{variant:"subtitle2",sx:{mt:3,mb:1},children:["Existing Folders (",w.length,")"]}),e.jsx(h,{sx:{maxHeight:200,overflowY:"auto",border:1,borderColor:"divider",borderRadius:1,p:1},children:w.length>0?e.jsx(h,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:w.map(a=>e.jsx(F,{label:a,variant:"outlined",size:"small",sx:{bgcolor:j(m.palette.primary.main,.05)}},a))}):e.jsx(c,{variant:"body2",color:"text.secondary",children:"No folders defined yet."})})]})}),e.jsx(i,{item:!0,xs:12,md:6,children:e.jsxs(q,{elevation:3,sx:{p:3},children:[e.jsxs(c,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center"},children:[e.jsx(Re,{sx:{mr:1}}),"Create New Category"]}),e.jsx(g,{severity:"info",sx:{mb:3},children:"Add a new category within an existing folder. Categories are subgroups of folders."}),be&&e.jsx(g,{severity:"error",sx:{mb:2},children:be}),ve&&e.jsx(g,{severity:"success",sx:{mb:2},children:ve}),e.jsxs(i,{container:!0,spacing:2,children:[e.jsx(i,{item:!0,xs:12,children:e.jsxs(D,{fullWidth:!0,children:[e.jsx(M,{children:"Select Folder"}),e.jsx(U,{value:r.selectedFolder,onChange:ca,label:"Select Folder",disabled:H||w.length===0,children:w.map(a=>e.jsx(b,{value:a,children:a},a))})]})}),e.jsx(i,{item:!0,xs:12,children:e.jsx(W,{fullWidth:!0,label:"New Category Name",name:"newCategory",value:r.newCategory,onChange:Ie,placeholder:"Enter category name",helperText:"This will create a new category within the selected folder",disabled:!r.selectedFolder||H})}),e.jsx(i,{item:!0,xs:12,children:e.jsx($,{variant:"contained",color:"primary",onClick:ha,disabled:H||!r.selectedFolder||!r.newCategory.trim(),startIcon:H?e.jsx(T,{size:20}):e.jsx(Le,{}),fullWidth:!0,children:H?"Creating...":"Create Category"})})]}),r.selectedFolder&&e.jsxs(e.Fragment,{children:[e.jsxs(c,{variant:"subtitle2",sx:{mt:3,mb:1},children:['Existing Categories in "',r.selectedFolder,'" (',(y[r.selectedFolder]||[]).length,")"]}),e.jsx(h,{sx:{maxHeight:200,overflowY:"auto",border:1,borderColor:"divider",borderRadius:1,p:1},children:((Ne=y[r.selectedFolder])==null?void 0:Ne.length)>0?e.jsx(h,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:y[r.selectedFolder].map(a=>e.jsx(F,{label:a,variant:"outlined",size:"small",sx:{bgcolor:j(m.palette.secondary.main,.05)}},a))}):e.jsx(c,{variant:"body2",color:"text.secondary",children:"No categories defined in this folder yet."})})]})]})})]})})]}):e.jsx(ae,{sx:{py:4},children:e.jsx(g,{severity:"error",children:"Access Denied. This page is for administrators only."})}):e.jsx(ae,{sx:{py:4},children:e.jsx(g,{severity:"error",children:"You must be logged in to access this page."})})};export{Oa as default};
