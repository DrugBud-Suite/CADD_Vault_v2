import{y as O,z as W,D as B,E as L,R as N,o as F,r as i,n as S,j as e,t as Y,v as $,C as f,A as E,T as b,U as H,N as J,ay as c,I as w}from"./index-B7UqGdPd.js";import{D as V}from"./Delete-DDjKKTff.js";import{T as G,a as K,b as Q,c as C,d as s,e as U,E as X}from"./EditSuggestionModal-BY0lV8WH.js";import"./Grid-Bq28EWbL.js";var l={},q;function Z(){if(q)return l;q=1;var d=O();Object.defineProperty(l,"__esModule",{value:!0}),l.default=void 0;var a=d(W()),o=B();return l.default=(0,a.default)((0,o.jsx)("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.9959.9959 0 0 0-1.41 0l-1.83 1.83 3.75 3.75z"}),"Edit"),l}var ee=Z();const te=L(ee),ie=()=>{const d=N(),{currentUser:a,loading:o,isAdmin:u}=F(),r=(a==null?void 0:a.id)||null,[j,h]=i.useState([]),[T,y]=i.useState(!0),[_,g]=i.useState(null),[v,x]=i.useState(null),[k,p]=i.useState(!1),m=i.useCallback(async()=>{if(r){y(!0),g(null);try{const{data:t,error:n}=await S.from("package_suggestions").select("*").eq("suggested_by_user_id",r).order("created_at",{ascending:!1});if(n)throw n;h(t||[])}catch(t){console.error("Error fetching suggestions:",t.message),g(`Failed to load your suggestions: ${t.message}`),h([])}finally{y(!1)}}},[r]);i.useEffect(()=>{!o&&!a?d("/login"):r&&m()},[r,o,d,m]);const D=async t=>{if(window.confirm("Are you sure you want to delete this pending suggestion? This action cannot be undone.")&&r)try{const{error:n}=await S.from("package_suggestions").delete().eq("id",t).eq("status","pending").eq("suggested_by_user_id",r);if(n)throw n;h(P=>P.filter(z=>z.id!==t))}catch(n){g(`Failed to delete suggestion: ${n.message}`)}},M=t=>{t.status==="pending"&&t.suggested_by_user_id===r||u?(x(t),p(!0)):alert("You can only edit your own suggestions that are still pending.")},I=()=>{x(null),p(!1)},R=()=>{m(),p(!1),x(null)},A=t=>{switch(t){case"pending":return"warning";case"approved":return"success";case"rejected":return"error";case"added":return"info";default:return"default"}};return o||T?e.jsx(Y,{display:"flex",justifyContent:"center",alignItems:"center",height:"50vh",children:e.jsx($,{})}):_?e.jsx(f,{maxWidth:"md",sx:{mt:4},children:e.jsx(E,{severity:"error",children:_})}):a?e.jsxs(f,{maxWidth:"lg",sx:{mt:4,mb:4},children:[e.jsx(b,{variant:"h4",gutterBottom:!0,component:"h1",sx:{mb:3,color:t=>(t.palette.mode==="dark",t.palette.text.primary)},children:"My Package Suggestions"}),j.length===0?e.jsx(b,{children:"You haven't submitted any package suggestions yet."}):e.jsx(G,{component:H,elevation:2,children:e.jsxs(K,{sx:{minWidth:650},"aria-label":"my suggestions table",children:[e.jsx(Q,{children:e.jsxs(C,{children:[e.jsx(s,{children:"Package Name"}),e.jsx(s,{children:"Status"}),e.jsx(s,{children:"Submitted"}),e.jsx(s,{children:"Reason"}),e.jsx(s,{children:"Admin Notes"}),e.jsx(s,{align:"right",children:"Actions"})]})}),e.jsx(U,{children:j.map(t=>e.jsxs(C,{hover:!0,children:[e.jsx(s,{component:"th",scope:"row",children:t.package_name}),e.jsx(s,{children:e.jsx(J,{label:t.status,color:A(t.status),size:"small"})}),e.jsx(s,{children:new Date(t.created_at).toLocaleDateString()}),e.jsx(s,{sx:{maxWidth:200,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.jsx(c,{title:t.suggestion_reason||"",children:e.jsx("span",{children:t.suggestion_reason||"-"})})}),e.jsx(s,{sx:{maxWidth:200,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.jsx(c,{title:t.admin_notes||"",children:e.jsx("span",{children:t.admin_notes||"-"})})}),e.jsxs(s,{align:"right",children:[(t.status==="pending"&&t.suggested_by_user_id===r||u)&&e.jsx(c,{title:"Edit Suggestion",children:e.jsx(w,{size:"small",onClick:()=>M(t),sx:{color:"primary.main"},children:e.jsx(te,{})})}),t.status==="pending"&&t.suggested_by_user_id===r&&e.jsx(c,{title:"Delete Suggestion",children:e.jsx(w,{size:"small",onClick:()=>D(t.id),sx:{ml:1,color:"error.main"},children:e.jsx(V,{})})})]})]},t.id))})]})}),v&&e.jsx(X,{open:k,onClose:I,suggestion:v,onSaveSuccess:R,isAdmin:!!u})]}):e.jsx(f,{maxWidth:"md",sx:{mt:4},children:e.jsx(E,{severity:"info",children:"Please log in to view your suggestions."})})};export{ie as default};
