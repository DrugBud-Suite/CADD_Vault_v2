import{c as k,j as n,a as Ee,g as He,r as d,d as _e,_ as pe,ax as fe,u as Ie,e as we,ay as Be,a7 as Oe,b as p,s as Z,f as Q,h as he,i as Pe,az as Te,aA as qe,aB as $e,x as me,y as ve,z as ye,D as xe,R as Ue,p as le,al as Ne,I as De,q as ce,T as oe,at as ke,t as K}from"./index-ByaDLX4Y.js";const We=k(n.jsx("path",{d:"M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"}),"Star"),Xe=k(n.jsx("path",{d:"M22 9.24l-7.19-.62L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21 12 17.27 18.18 21l-1.63-7.03L22 9.24zM12 15.4l-3.76 2.27 1-4.28-3.32-2.88 4.38-.38L12 6.1l1.71 4.04 4.38.38-3.32 2.88 1 4.28L12 15.4z"}),"StarBorder");function Ye(e){return He("MuiRating",e)}const X=Ee("MuiRating",["root","sizeSmall","sizeMedium","sizeLarge","readOnly","disabled","focusVisible","visuallyHidden","pristine","label","labelEmptyValueActive","icon","iconEmpty","iconFilled","iconHover","iconFocus","iconActive","decimal"]),Ge=["value"],Je=["className","defaultValue","disabled","emptyIcon","emptyLabelText","getLabelText","highlightSelectedOnly","icon","IconContainerComponent","max","name","onChange","onChangeActive","onMouseLeave","onMouseMove","precision","readOnly","size","value"];function Ke(e){const t=e.toString().split(".")[1];return t?t.length:0}function ae(e,t){if(e==null)return e;const a=Math.round(e/t)*t;return Number(a.toFixed(Ke(t)))}const Qe=e=>{const{classes:t,size:a,readOnly:s,disabled:z,emptyValueFocused:R,focusVisible:h}=e,b={root:["root",`size${he(a)}`,z&&"disabled",h&&"focusVisible",s&&"readOnly"],label:["label","pristine"],labelEmptyValue:[R&&"labelEmptyValueActive"],icon:["icon"],iconEmpty:["iconEmpty"],iconFilled:["iconFilled"],iconHover:["iconHover"],iconFocus:["iconFocus"],iconActive:["iconActive"],decimal:["decimal"],visuallyHidden:["visuallyHidden"]};return Pe(b,Ye,t)},Ze=Z("span",{name:"MuiRating",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:a}=e;return[{[`& .${X.visuallyHidden}`]:t.visuallyHidden},t.root,t[`size${he(a.size)}`],a.readOnly&&t.readOnly]}})(({theme:e,ownerState:t})=>p({display:"inline-flex",position:"relative",fontSize:e.typography.pxToRem(24),color:"#faaf00",cursor:"pointer",textAlign:"left",width:"min-content",WebkitTapHighlightColor:"transparent",[`&.${X.disabled}`]:{opacity:(e.vars||e).palette.action.disabledOpacity,pointerEvents:"none"},[`&.${X.focusVisible} .${X.iconActive}`]:{outline:"1px solid #999"},[`& .${X.visuallyHidden}`]:Te},t.size==="small"&&{fontSize:e.typography.pxToRem(18)},t.size==="large"&&{fontSize:e.typography.pxToRem(30)},t.readOnly&&{pointerEvents:"none"})),Re=Z("label",{name:"MuiRating",slot:"Label",overridesResolver:({ownerState:e},t)=>[t.label,e.emptyValueFocused&&t.labelEmptyValueActive]})(({ownerState:e})=>p({cursor:"inherit"},e.emptyValueFocused&&{top:0,bottom:0,position:"absolute",outline:"1px solid #999",width:"100%"})),et=Z("span",{name:"MuiRating",slot:"Icon",overridesResolver:(e,t)=>{const{ownerState:a}=e;return[t.icon,a.iconEmpty&&t.iconEmpty,a.iconFilled&&t.iconFilled,a.iconHover&&t.iconHover,a.iconFocus&&t.iconFocus,a.iconActive&&t.iconActive]}})(({theme:e,ownerState:t})=>p({display:"flex",transition:e.transitions.create("transform",{duration:e.transitions.duration.shortest}),pointerEvents:"none"},t.iconActive&&{transform:"scale(1.2)"},t.iconEmpty&&{color:(e.vars||e).palette.action.disabled})),tt=Z("span",{name:"MuiRating",slot:"Decimal",shouldForwardProp:e=>qe(e)&&e!=="iconActive",overridesResolver:(e,t)=>{const{iconActive:a}=e;return[t.decimal,a&&t.iconActive]}})(({iconActive:e})=>p({position:"relative"},e&&{transform:"scale(1.2)"}));function nt(e){const t=pe(e,Ge);return n.jsx("span",p({},t))}function ue(e){const{classes:t,disabled:a,emptyIcon:s,focus:z,getLabelText:R,highlightSelectedOnly:h,hover:b,icon:S,IconContainerComponent:y,isActive:I,itemValue:u,labelProps:x,name:C,onBlur:P,onChange:j,onClick:L,onFocus:f,readOnly:T,ownerState:r,ratingValue:m,ratingValueRounded:q}=e,A=h?u===m:u<=m,w=u<=b,F=u<=z,$=u===q,B=fe(),o=n.jsx(et,{as:y,value:u,className:Q(t.icon,A?t.iconFilled:t.iconEmpty,w&&t.iconHover,F&&t.iconFocus,I&&t.iconActive),ownerState:p({},r,{iconEmpty:!A,iconFilled:A,iconHover:w,iconFocus:F,iconActive:I}),children:s&&!A?s:S});return T?n.jsx("span",p({},x,{children:o})):n.jsxs(d.Fragment,{children:[n.jsxs(Re,p({ownerState:p({},r,{emptyValueFocused:void 0}),htmlFor:B},x,{children:[o,n.jsx("span",{className:t.visuallyHidden,children:R(u)})]})),n.jsx("input",{className:t.visuallyHidden,onFocus:f,onBlur:P,onChange:j,onClick:L,disabled:a,value:u,id:B,type:"radio",name:C,checked:$})]})}const ot=n.jsx(We,{fontSize:"inherit"}),at=n.jsx(Xe,{fontSize:"inherit"});function it(e){return`${e} Star${e!==1?"s":""}`}const st=d.forwardRef(function(t,a){const s=_e({name:"MuiRating",props:t}),{className:z,defaultValue:R=null,disabled:h=!1,emptyIcon:b=at,emptyLabelText:S="Empty",getLabelText:y=it,highlightSelectedOnly:I=!1,icon:u=ot,IconContainerComponent:x=nt,max:C=5,name:P,onChange:j,onChangeActive:L,onMouseLeave:f,onMouseMove:T,precision:r=1,readOnly:m=!1,size:q="medium",value:A}=s,w=pe(s,Je),F=fe(P),[$,B]=Ie({controlled:A,default:R,name:"Rating"}),o=ae($,r),g=we(),[{hover:l,focus:V},E]=d.useState({hover:-1,focus:-1});let H=o;l!==-1&&(H=l),V!==-1&&(H=V);const{isFocusVisibleRef:U,onBlur:ee,onFocus:be,ref:Se}=Be(),[Ce,te]=d.useState(!1),ie=d.useRef(),je=Oe(Se,ie,a),Fe=i=>{T&&T(i);const c=ie.current,{right:v,left:J,width:N}=c.getBoundingClientRect();let D;g?D=(v-i.clientX)/N:D=(i.clientX-J)/N;let M=ae(C*D+r/2,r);M=$e(M,r,C),E(O=>O.hover===M&&O.focus===M?O:{hover:M,focus:M}),te(!1),L&&l!==M&&L(i,M)},Me=i=>{f&&f(i);const c=-1;E({hover:c,focus:c}),L&&l!==c&&L(i,c)},se=i=>{let c=i.target.value===""?null:parseFloat(i.target.value);l!==-1&&(c=l),B(c),j&&j(i,c)},ze=i=>{i.clientX===0&&i.clientY===0||(E({hover:-1,focus:-1}),B(null),j&&parseFloat(i.target.value)===o&&j(i,null))},Le=i=>{be(i),U.current===!0&&te(!0);const c=parseFloat(i.target.value);E(v=>({hover:v.hover,focus:c}))},Ae=i=>{if(l!==-1)return;ee(i),U.current===!1&&te(!1);const c=-1;E(v=>({hover:v.hover,focus:c}))},[Ve,re]=d.useState(!1),W=p({},s,{defaultValue:R,disabled:h,emptyIcon:b,emptyLabelText:S,emptyValueFocused:Ve,focusVisible:Ce,getLabelText:y,icon:u,IconContainerComponent:x,max:C,precision:r,readOnly:m,size:q}),_=Qe(W);return n.jsxs(Ze,p({ref:je,onMouseMove:Fe,onMouseLeave:Me,className:Q(_.root,z,m&&"MuiRating-readOnly"),ownerState:W,role:m?"img":null,"aria-label":m?y(H):null},w,{children:[Array.from(new Array(C)).map((i,c)=>{const v=c+1,J={classes:_,disabled:h,emptyIcon:b,focus:V,getLabelText:y,highlightSelectedOnly:I,hover:l,icon:u,IconContainerComponent:x,name:F,onBlur:Ae,onChange:se,onClick:ze,onFocus:Le,ratingValue:H,ratingValueRounded:o,readOnly:m,ownerState:W},N=v===Math.ceil(H)&&(l!==-1||V!==-1);if(r<1){const D=Array.from(new Array(1/r));return n.jsx(tt,{className:Q(_.decimal,N&&_.iconActive),ownerState:W,iconActive:N,children:D.map((M,O)=>{const ne=ae(v-1+(O+1)*r,r);return n.jsx(ue,p({},J,{isActive:!1,itemValue:ne,labelProps:{style:D.length-1===O?{}:{width:ne===H?`${(O+1)*r*100}%`:"0%",overflow:"hidden",position:"absolute"}}}),ne)})},v)}return n.jsx(ue,p({},J,{isActive:N,itemValue:v}),v)}),!m&&!h&&n.jsxs(Re,{className:Q(_.label,_.labelEmptyValue),ownerState:W,children:[n.jsx("input",{className:_.visuallyHidden,value:"",id:`${F}-empty`,type:"radio",name:F,checked:o==null,onFocus:()=>re(!0),onBlur:()=>re(!1),onChange:se}),n.jsx("span",{className:_.visuallyHidden,children:S})]})]}))}),ft=k(n.jsx("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m-5 14H7v-2h7zm3-4H7v-2h10zm0-4H7V7h10z"}),"Article"),ht=k(n.jsx("path",{d:"M9.4 16.6 4.8 12l4.6-4.6L8 6l-6 6 6 6zm5.2 0 4.6-4.6-4.6-4.6L16 6l6 6-6 6z"}),"Code"),mt=k(n.jsx("path",{d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2m6.93 6h-2.95c-.32-1.25-.78-2.45-1.38-3.56 1.84.63 3.37 1.91 4.33 3.56M12 4.04c.83 1.2 1.48 2.53 1.91 3.96h-3.82c.43-1.43 1.08-2.76 1.91-3.96M4.26 14C4.1 13.36 4 12.69 4 12s.1-1.36.26-2h3.38c-.08.66-.14 1.32-.14 2 0 .68.06 1.34.14 2zm.82 2h2.95c.32 1.25.78 2.45 1.38 3.56-1.84-.63-3.37-1.9-4.33-3.56m2.95-8H5.08c.96-1.66 2.49-2.93 4.33-3.56C8.81 5.55 8.35 6.75 8.03 8M12 19.96c-.83-1.2-1.48-2.53-1.91-3.96h3.82c-.43 1.43-1.08 2.76-1.91 3.96M14.34 14H9.66c-.09-.66-.16-1.32-.16-2 0-.68.07-1.35.16-2h4.68c.09.65.16 1.32.16 2 0 .68-.07 1.34-.16 2m.25 5.56c.6-1.11 1.06-2.31 1.38-3.56h2.95c-.96 1.65-2.49 2.93-4.33 3.56M16.36 14c.08-.66.14-1.32.14-2 0-.68-.06-1.34-.14-2h3.38c.16.64.26 1.31.26 2s-.1 1.36-.26 2z"}),"Language"),vt=k(n.jsx("path",{d:"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1M8 13h8v-2H8zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5"}),"Link");var Y={},de;function rt(){if(de)return Y;de=1;var e=me();Object.defineProperty(Y,"__esModule",{value:!0}),Y.default=void 0;var t=e(ve()),a=ye();return Y.default=(0,t.default)((0,a.jsx)("path",{d:"M12 17.27 18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"}),"Star"),Y}var lt=rt();const ct=xe(lt);var G={},ge;function ut(){if(ge)return G;ge=1;var e=me();Object.defineProperty(G,"__esModule",{value:!0}),G.default=void 0;var t=e(ve()),a=ye();return G.default=(0,t.default)((0,a.jsx)("path",{d:"m22 9.24-7.19-.62L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21 12 17.27 18.18 21l-1.63-7.03zM12 15.4l-3.76 2.27 1-4.28-3.32-2.88 4.38-.38L12 6.1l1.71 4.04 4.38.38-3.32 2.88 1 4.28z"}),"StarBorder"),G}var dt=ut();const gt=xe(dt),yt=({packageId:e,initialAverageRating:t,initialRatingsCount:a})=>{const{currentUser:s}=Ue(),[z,R]=d.useState(t),[h,b]=d.useState(a),[S,y]=d.useState(null),[I,u]=d.useState(!1),[x,C]=d.useState(!1),[P,j]=d.useState(null),[L,f]=d.useState(null),T=async()=>{if(s){u(!0);try{const{data:o,error:g}=await K.from("ratings").select("rating").eq("user_id",s.id).eq("package_id",e).limit(1);g?console.error("Error fetching user rating:",g):o&&o.length>0?(y(o[0].rating),f(o[0].rating)):(y(null),f(null))}catch(o){console.error("Unexpected error fetching user rating:",o)}finally{u(!1)}}},r=async()=>{try{const{data:o,error:g}=await K.from("packages").select("average_rating, ratings_count").eq("id",e).single();g?console.error("Error fetching aggregated rating:",g):o&&(R(o.average_rating??0),b(o.ratings_count??0))}catch(o){console.error("Unexpected error fetching aggregated rating:",o)}};d.useEffect(()=>{s?T():(y(null),f(null)),r()},[s,e]);const m=o=>{if(!s){console.log("User must be logged in to rate.");return}j(o.currentTarget),f(S)},q=()=>{j(null)},A=async(o,g)=>{if(!(!s||g===null)){C(!0),f(g);try{const{data:l,error:V}=await K.from("ratings").select("id").eq("user_id",s.id).eq("package_id",e).single();if(V&&V.code!=="PGRST116")throw V;const{error:E}=await K.from("ratings").upsert({id:l==null?void 0:l.id,user_id:s.id,package_id:e,rating:g,created_at:l?void 0:new Date().toISOString()});if(E)console.error("Error submitting rating:",E),f(S);else{const H=h*z+g,U=h+(S===null?1:0),ee=U>0?H/U:0;y(g),R(ee),b(U),r(),q()}}catch(l){console.error("Unexpected error submitting rating:",l),f(S)}finally{C(!1)}}},w=!!P,F=w?`rating-popover-${e}`:void 0,$=z??0,B=h??0;return n.jsxs(le,{sx:{display:"flex",alignItems:"center",gap:.5},children:[n.jsx(Ne,{title:s?"Rate this package":"Login to rate",children:n.jsxs("span",{children:[" ",n.jsx(De,{size:"small",onClick:m,"aria-describedby":F,disabled:I||x||!s,sx:{p:.5},children:I||x?n.jsx(ce,{size:20}):n.jsx(ct,{fontSize:"inherit",sx:{color:$>0?"warning.main":"action.disabled"}})})]})}),n.jsx(oe,{variant:"body2",sx:{fontWeight:"medium"},children:$.toFixed(1)}),n.jsxs(oe,{variant:"body2",color:"text.secondary",children:["(",B,")"]}),n.jsx(ke,{id:F,open:w,anchorEl:P,onClose:q,anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"},children:n.jsxs(le,{sx:{p:2,display:"flex",flexDirection:"column",alignItems:"center"},children:[n.jsx(oe,{variant:"subtitle2",gutterBottom:!0,sx:{color:o=>o.palette.text.primary},children:"Your Rating"}),n.jsx(st,{name:`rating-${e}`,value:L,onChange:A,precision:1,emptyIcon:n.jsx(gt,{fontSize:"inherit"}),disabled:x}),x&&n.jsx(ce,{size:20,sx:{mt:1}})]})})]})};export{ft as A,ht as C,mt as L,yt as R,vt as a};
