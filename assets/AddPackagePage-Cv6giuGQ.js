import{P as E,Q as L,r as d,j as e,p as S,q as x,T as f,R as I,Z as l,$ as R,a0 as W,K as D,G as F,t as w}from"./index-DJGmrbOz.js";import{G as s}from"./Grid-B0LgO5dT.js";const N=()=>{const p=E(),{isAdmin:u,loading:m}=L(),[a,k]=d.useState({package_name:"",description:"",publication:"",webserver:"",repo_link:"",link:"",license:"",tags:[]}),[h,v]=d.useState(!1),[b,g]=d.useState(null),[A,P]=d.useState([]),[j,y]=d.useState(!1);d.useEffect(()=>{!m&&!u&&(console.warn("Access denied: User is not an admin."),p("/"))},[u,m,p]),d.useEffect(()=>{u&&(async()=>{if(u){y(!0);try{const{data:t,error:n}=await w.from("packages").select("tags");if(n)throw n;const i=new Set;t.forEach(c=>{c.tags&&Array.isArray(c.tags)&&c.tags.forEach(T=>i.add(T))}),P(Array.from(i).sort())}catch(t){console.error("Error fetching existing tags:",t.message),g("Failed to load existing tags.")}finally{y(!1)}}})()},[u]);const o=r=>{const{name:t,value:n}=r.target;k(i=>({...i,[t]:n}))},_=(r,t)=>{k(n=>({...n,tags:t}))},C=async r=>{if(r.preventDefault(),g(null),!a.package_name){g("Package Name (package_name) is required.");return}v(!0);try{const t={package_name:a.package_name||"",description:a.description||"",publication:a.publication||"",webserver:a.webserver||"",repo_link:a.repo_link||"",link:a.link||"",license:a.license||"",tags:a.tags||[]},{data:n,error:i}=await w.from("packages").insert([t]).select();if(i)throw i;const c=n==null?void 0:n[0];c?(console.log("Package added successfully:",c),p(`/package/${encodeURIComponent(c.id)}`)):(g("Failed to retrieve the newly added package data."),console.error("Insert successful but no data returned."))}catch(t){console.error("Error adding package: ",t.message),g(`Failed to add package: ${t.message}`)}finally{v(!1)}};return m?e.jsx(S,{display:"flex",justifyContent:"center",alignItems:"center",height:"50vh",children:e.jsx(x,{})}):u?e.jsxs(I,{elevation:3,sx:{p:3,m:2},children:[e.jsx(f,{variant:"h4",gutterBottom:!0,component:"div",children:"Add New Package"}),e.jsx("form",{onSubmit:C,children:e.jsxs(s,{container:!0,spacing:3,children:[e.jsx(s,{item:!0,xs:12,children:e.jsx(l,{id:"package_name",label:"Package Name (package_name)",name:"package_name",value:a.package_name,onChange:o,required:!0,fullWidth:!0,variant:"outlined"})}),e.jsx(s,{item:!0,xs:12,children:e.jsx(l,{id:"description",label:"Description",name:"description",value:a.description,onChange:o,multiline:!0,rows:4,fullWidth:!0,variant:"outlined"})}),e.jsx(s,{item:!0,xs:12,sm:6,children:e.jsx(l,{id:"publication",label:"Publication URL",name:"publication",value:a.publication,onChange:o,fullWidth:!0,variant:"outlined",type:"url"})}),e.jsx(s,{item:!0,xs:12,sm:6,children:e.jsx(l,{id:"webserver",label:"Webserver/Homepage URL",name:"webserver",value:a.webserver,onChange:o,fullWidth:!0,variant:"outlined",type:"url"})}),e.jsx(s,{item:!0,xs:12,sm:6,children:e.jsx(l,{id:"repo_link",label:"Code Repository Link (GitHub or other)",name:"repo_link",value:a.repo_link,onChange:o,fullWidth:!0,variant:"outlined",type:"url",helperText:"Enter the URL for the code repository"})}),e.jsx(s,{item:!0,xs:12,sm:6,children:e.jsx(l,{id:"link",label:"General Link",name:"link",value:a.link,onChange:o,fullWidth:!0,variant:"outlined",type:"url",helperText:"Any other relevant link (not publication or webserver)"})}),e.jsx(s,{item:!0,xs:12,sm:6,children:e.jsx(l,{id:"license",label:"License",name:"license",value:a.license,onChange:o,fullWidth:!0,variant:"outlined"})}),e.jsx(s,{item:!0,xs:12,children:e.jsx(R,{multiple:!0,id:"tags-filled",options:A,loading:j,value:a.tags||[],onChange:_,freeSolo:!0,renderTags:(r,t)=>r.map((n,i)=>e.jsx(D,{variant:"outlined",label:n,...t({index:i})})),renderInput:r=>e.jsx(l,{...r,id:"tags-input",name:"tags",variant:"outlined",label:"Tags",placeholder:"Add or select tags",InputProps:{...r.InputProps,endAdornment:e.jsxs(W.Fragment,{children:[j?e.jsx(x,{color:"inherit",size:20}):null,r.InputProps.endAdornment]})}})})}),e.jsxs(s,{item:!0,xs:12,children:[b&&e.jsx(f,{color:"error",sx:{mb:2},children:b}),e.jsx(F,{type:"submit",variant:"contained",color:"primary",disabled:h,startIcon:h?e.jsx(x,{size:20}):null,children:h?"Adding...":"Add Package"})]})]})})]}):e.jsx(f,{color:"error",align:"center",children:"Access Denied. You must be an admin to add packages."})};export{N as default};
